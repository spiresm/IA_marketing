<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Partager un Workflow - iMarketing</title>

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
Â  Â  <link rel="stylesheet" href="style.css" />
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

Â  Â  <style>
Â  Â  Â  Â  /* Styles conservÃ©s de votre original pour les formulaires Tips/Prompts */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-blue: #0077b6;
Â  Â  Â  Â  Â  Â  --dark-blue: #005f8a;
Â  Â  Â  Â  Â  Â  --background-grey: #f0f2f5;
Â  Â  Â  Â  Â  Â  --card-shadow: 0 8px 20px rgba(0,0,0,0.05);
Â  Â  Â  Â  Â  Â  --success-bg: #d4edda;
Â  Â  Â  Â  Â  Â  --success-text: #155724;
Â  Â  Â  Â  Â  Â  --border-color: #ddd;
Â  Â  Â  Â  Â  Â  --grey-text: #555;
Â  Â  Â  Â  }
Â  Â  Â  Â  main {Â 
Â  Â  Â  Â  Â  Â  padding: 40px 20px;Â 
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  justify-content: center;Â 
Â  Â  Â  Â  Â  Â  align-items: flex-start;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .container {Â 
Â  Â  Â  Â  Â  Â  max-width: 960px;
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  margin: 0 auto;Â 
Â  Â  Â  Â  Â  Â  background: #fff;Â 
Â  Â  Â  Â  Â  Â  border-radius: 12px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: var(--card-shadow);Â 
Â  Â  Â  Â  Â  Â  padding: 30px;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;Â 
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .retour-lien {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  background-color: var(--primary-blue);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .retour-lien:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--dark-blue);
Â  Â  Â  Â  }

Â  Â  Â  Â  .form-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-group {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  .full-width {
Â  Â  Â  Â  Â  Â  grid-column: 1 / -1;
Â  Â  Â  Â  }

Â  Â  Â  Â  label {Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  input, select, textarea {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 10px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  font-size: 1em;Â 
Â  Â  Â  Â  Â  Â  background: #f9fafb;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;Â 
Â  Â  Â  Â  Â  Â  color: #333;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  input:focus, select:focus, textarea:focus {Â 
Â  Â  Â  Â  Â  Â  border-color: var(--primary-blue);Â 
Â  Â  Â  Â  Â  Â  outline: none;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 2px rgba(0, 119, 182, 0.2);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  textarea { resize: vertical; }
Â  Â  Â  Â  #description { min-height: 120px; }
Â  Â  Â  Â  #promptText { min-height: 150px; } /* Correction ID pour promptText */
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* .post-it-highlight { /* Ceci est supprimÃ© car le post-it est retirÃ© */
Â  Â  Â  Â  /* background-color: #FFFF00;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  border: 1px solid #E6E600;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
Â  Â  Â  Â  Â  Â  font-style: italic;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  } */
Â  Â  Â  Â Â 
Â  Â  Â  Â  .checkbox-group {Â 
Â  Â  Â  Â  Â  Â  height: 120px;
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  padding: 10px 15px;Â 
Â  Â  Â  Â  Â  Â  background-color: #f9fafb;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .checkbox-item { display: flex; align-items: center; margin-bottom: 8px; }
Â  Â  Â  Â  .checkbox-item input[type="checkbox"] { width: auto; margin: 0 10px 0 0; }
Â  Â  Â  Â  .checkbox-item label { font-weight: 400; margin: 0; cursor: pointer; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .url-input-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .url-input-group input { margin-bottom: 0; } /* Ajuster la marge */
Â  Â  Â  Â  .url-action-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 5px; }
Â  Â  Â  Â  .add-url-button, .remove-url-button { padding: 8px 12px; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; color: white; }
Â  Â  Â  Â  .add-url-button { background-color: #28a745; }
Â  Â  Â  Â  .remove-url-button { background-color: #dc3545; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #drop-zone { border: 2px dashed var(--primary-blue); padding: 20px; text-align: center; color: #777; border-radius: 10px; cursor: pointer; height: 100%; display: flex; align-items: center; justify-content: center; box-sizing: border-box; }
Â  Â  Â  Â  #drop-zone.dragover { background: #e0f7ff; }Â 

Â  Â  Â  Â  .file-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
Â  Â  Â  Â  .file-preview-item { position: relative; width: 100px; height: 100px; border: 1px solid #ddd; border-radius: 5px; display: flex; justify-content: center; align-items: center; background-color: #f9f9f9; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .file-preview-item img.image-preview { max-width: 100%; max-height: 100%; object-fit: contain; display: block; }
Â  Â  Â  Â  .file-preview-item .file-icon { font-size: 40px; color: var(--primary-blue); }

Â  Â  Â  Â  .file-name-overlay { position: absolute; bottom: 0; left: 0; right: 0; background-color: rgba(0,0,0,0.6); color: white; font-size: 0.7em; padding: 3px 5px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
Â  Â  Â  Â  .remove-file-button { position: absolute; top: 5px; right: 5px; background-color: rgba(255,0,0,0.7); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 14px; display: flex; justify-content: center; align-items: center; cursor: pointer; padding: 0; line-height: 1; transition: background-color 0.2s ease; }
Â  Â  Â  Â  .remove-file-button:hover { background-color: red; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  button[type="submit"] { width: 100%; padding: 12px; background: var(--primary-blue); color: #fff; border: none; border-radius: 8px; margin-top: 25px; font-size: 1em; cursor: pointer; transition: background 0.2s; }
Â  Â  Â  Â  button[type="submit"]:hover { background: var(--dark-blue); }
Â  Â  Â  Â  button[type="submit"]:disabled { background-color: #cccccc; cursor: not-allowed; }

Â  Â  Â  Â  /* Loader interne au formulaire */
Â  Â  Â  Â  .loader {
Â  Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  border: 4px solid var(--border-color);
Â  Â  Â  Â  Â  Â  border-top: 4px solid var(--primary-blue);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  animation: spin 0.8s linear infinite;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin { 100% { transform: rotate(360deg); } }

Â  Â  Â  Â  /* Confirmation de soumission */
Â  Â  Â  Â  .confirmation {
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background: var(--success-bg);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--success-text);
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  color: var(--success-text);
Â  Â  Â  Â  }
Â  Â  Â  Â  .confirmation img {
Â  Â  Â  Â  Â  Â  max-width: 100px;
Â  Â  Â  Â  Â  Â  max-height: 100px;
Â  Â  Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: transform 0.2s ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  .confirmation img:hover {
Â  Â  Â  Â  Â  Â  transform: scale(1.05);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Lightbox pour les images de confirmation */
Â  Â  Â  Â  .lightbox-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.8);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  Â  }
Â  Â  Â  Â  .lightbox-content {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  max-width: 90%;
Â  Â  Â  Â  Â  Â  max-height: 90%;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lightbox-content img {
Â  Â  Â  Â  Â  Â  max-width: 100%;
Â  Â  Â  Â  Â  Â  max-height: 100%;
Â  Â  Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lightbox-close {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 10px;
Â  Â  Â  Â  Â  Â  right: 10px;
Â  Â  Â  Â  Â  Â  color: #fff;
Â  Â  Â  Â  Â  Â  font-size: 30px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  z-index: 1001;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.5);
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 40px;
Â  Â  Â  Â  Â  Â  height: 40px;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px rgba(0,0,0,0.8);
Â  Â  Â  Â  }
Â  Â  Â  Â  .lightbox-close:hover {
Â  Â  Â  Â  Â  Â  color: #f00;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.7);
Â  Â  Â  Â  }

Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  .form-grid {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="header-placeholder"></div>

Â  Â  <main>
Â  Â  Â  Â  <div id="app">
Â  Â  Â  Â  Â  Â  <div class="container">
Â  Â  Â  Â  Â  Â  Â  Â  <a href="/cas-usages.html" class="retour-lien">â† Retour</a>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 style="text-align:center; color:var(--primary-blue);">{{ formTitle }}</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <form @submit.prevent="submitForm" v-if="!isLoadingFormSubmission && !confirmationVisible">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="auteur">Votre nom</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="auteur" v-model="auteur" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled>SÃ©lectionnez un nom</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option v-for="profilNom in profilsAuteurs" :key="profilNom" :value="profilNom">{{ profilNom }}</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p v-if="profilsAuteurs.length === 0 && !isLoadingProfils" style="color: var(--grey-text); font-size: 0.9em; margin-top: 5px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Aucun profil trouvÃ©. Assurez-vous d'avoir crÃ©Ã© des profils dans la section "Ã‰quipe" et que la fonction proxy est configurÃ©e.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p v-if="isLoadingProfils" style="color: var(--primary-blue); font-size: 0.9em; margin-top: 5px;">Chargement des noms de profils...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="titre">Titre du Tip / Workflow</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="titre" v-model="titre" required />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="description">Description</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="description" v-model="description" required></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="commentaireUrl">Commentaire / workflow</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="commentaireUrl" v-model="commentaireUrl" placeholder="Ajoutez un commentaire, une explication du workflow..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="promptText">Prompt (optionnel)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="promptText" v-model="promptText" placeholder="Collez le prompt exact ici..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Plateforme(s) / Outil(s)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="checkbox-group" role="group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="(tool, index) in toolsList" :key="index" class="checkbox-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" :id="'tool-' + index" name="outils[]" :value="tool.name" v-model="outils">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label :for="'tool-' + index">{{ tool.name }}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="checkbox-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="tool-autre" name="outils[]" value="Autre" v-model="outils">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="tool-autre">Autre</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" v-if="outils.includes('Autre')" name="customOutil" v-model="customOutil" placeholder="SpÃ©cifiez l'outil..." style="margin-top: 10px;" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Lien(s) associÃ©(s) - archive chatGPT/Gemini :</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="(url, index) in urls" :key="index" class="url-input-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="url" :name="`url-${index}`" v-model="urls[index]" :placeholder="`Lien ${index + 1}`" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" @click="removeUrlField(index)" class="remove-url-button">X</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="url-action-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" @click="addUrlField" class="add-url-button">Ajouter un lien</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>Image(s) / Document(s) (optionnel)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="drop-zone"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @click="triggerFile"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @dragover.prevent="onDragOver"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @dragleave="onDragLeave"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @drop.prevent="onDrop"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aria-live="polite"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aria-atomic="true"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tabindex="0"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  role="button"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Cliquez ou dÃ©posez des fichiers ici">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DÃ©posez ou cliquez pour ajouter des images ou documents (.txt, .pdf)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" ref="fileInput" accept="image/*, .txt, .pdf" style="display:none" @change="onFileChange" **multiple** />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p v-if="fileUploadError" style="color: red; margin-top: 5px;">{{ fileUploadError }}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-preview-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-for="fileObj in selectedFiles" :key="fileObj.id" class="file-preview-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img v-if="fileObj.type.startsWith('image/')" :src="fileObj.previewUrl" class="image-preview" :alt="fileObj.name" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span v-else class="file-icon">{{ getFileIcon(fileObj.type) }}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="file-name-overlay" :title="fileObj.name">{{ fileObj.name }}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="remove-file-button" @click="removeFile(fileObj.id)" :aria-label="`Supprimer le fichier ${fileObj.name}`">&times;</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group full-width">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div v-if="isLoadingFormSubmission" class="loader"></div> <button v-else type="submit" :disabled="!titre || !auteur || !description || isLoadingFormSubmission">{{ submitButtonText }}</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  <div v-else-if="isLoading" class="loader"></div> <div class="confirmation" v-if="confirmationVisible" role="status" aria-live="assertive">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>{{ confirmationMessage }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <template v-if="confirmationImageUrls && confirmationImageUrls.length > 0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img v-for="(url, index) in confirmationImageUrls" :key="'conf-img-' + index" :src="url" @click="openLightbox(url)" style="margin: 5px;" :alt="`Image de confirmation ${index + 1}`"/>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </template>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <template v-if="confirmationUrls && confirmationUrls.length > 0 && confirmationUrls[0].trim() !== ''">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-top: 15px; margin-bottom: 5px; color: #333;">Lien(s) enregistrÃ©(s):</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li v-for="(url, index) in confirmationUrls" :key="'conf-url-' + index" style="list-style-type: disc; margin-left: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a :href="url" target="_blank" style="color: var(--primary-blue); word-break: break-all;">{{ url }}</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </template>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p v-if="confirmationCommentaireUrl && confirmationCommentaireUrl.trim()" style="white-space: pre-wrap; font-style: italic; font-size: 0.9em; color: var(--grey-text); margin-top: 10px;">{{ confirmationCommentaireUrl }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="white-space: pre-wrap; font-weight: bold;">{{ confirmationTitre }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="white-align: pre-wrap;">{{ confirmationDescription }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p v-if="confirmationPromptText && confirmationPromptText.trim()" style="white-space: pre-wrap; font-family: monospace; background-color: #f0f0f0; padding: 10px; border-radius: 5px;">{{ confirmationPromptText }}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin-top: 15px; color: var(--primary-blue);">Redirection vers les cas d'usages dans 5 secondes...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="lightbox-overlay" v-if="lightboxVisible" @click.self="closeLightbox" role="dialog" aria-modal="true" :aria-label="`AperÃ§u de l'image ${lightboxImageUrl.split('/').pop()}`">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="lightbox-close" @click="closeLightbox" role="button" tabindex="0" aria-label="Fermer l'aperÃ§u de l'image">&times;</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="lightbox-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img :src="lightboxImageUrl" :alt="`Image en grand format : ${lightboxImageUrl.split('/').pop()}`" />
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="footer-placeholder"></div>

Â  Â  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
Â  Â  <script src="tools-data.js"></script>
Â  Â Â 
Â  Â  <script>
Â  Â  Â  Â  // DÃ©finitions des URL pour les fonctions Netlify
Â  Â  Â  Â  const GET_TIPS_URL = "/.netlify/functions/get-tips";Â 
Â  Â  Â  Â  const PUSH_TIP_URL = "/.netlify/functions/push-tip";Â 
Â  Â  Â  Â  const UPDATE_TIP_URL = "/.netlify/functions/update-tip";Â 
Â  Â  Â  Â  const GET_PROFILS_URL = "/.netlify/functions/getProfils"; // Assurez-vous que cette URL est correcte
Â  Â  Â  Â  // UPLOAD_IMAGE_URL n'est plus utilisÃ© car les fichiers sont envoyÃ©s directement via FormData
Â  Â  Â  Â  // const UPLOAD_IMAGE_URL = "/.netlify/functions/uploadImage"; 

Â  Â  Â  Â  // Fonction utilitaire pour charger des composants HTML (Header et Footer)
Â  Â  Â  Â  async function loadComponent(url, placeholderId) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const res = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorDetail = await res.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${res.status} - ${res.statusText}. URL: ${url}. Response: ${errorDetail.substring(0, 200)}...`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(placeholderId).innerHTML = await res.text();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Erreur lors du chargement de ${url}:`, error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(placeholderId).innerHTML = `<p style='color:red;text-align:center;'>Erreur de chargement du composant: ${url}. (${error.message})</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const { ref, createApp, onMounted, onUnmounted, computed } = Vue;

Â  Â  Â  Â  const TipForm = {
Â  Â  Â  Â  Â  Â  setup() {
Â  Â  Â  Â  Â  Â  Â  Â  // PropriÃ©tÃ©s du formulaire
Â  Â  Â  Â  Â  Â  Â  Â  const auteur = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const titre = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const description = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const promptText = ref('');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const outils = ref([]);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const customOutil = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const urls = ref(['']);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const commentaireUrl = ref('');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Gestion des fichiers multiples (REINTRODUIT)
Â  Â  Â  Â  Â  Â  Â  Â  const selectedFiles = ref([]);
Â  Â  Â  Â  Â  Â  Â  Â  let fileIdCounter = 0; // Pour donner un ID unique Ã  chaque fichier
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const fileInput = ref(null);
Â  Â  Â  Â  Â  Â  Â  Â  const fileUploadError = ref('');

Â  Â  Â  Â  Â  Â  Â  Â  const isLoading = ref(false); // Pour le loader initial de la page ou du formulaire
Â  Â  Â  Â  Â  Â  Â  Â  const isLoadingFormSubmission = ref(false); // Loader spÃ©cifique Ã  la soumission
Â  Â  Â  Â  Â  Â  Â  Â  const profilsAuteurs = ref([]);
Â  Â  Â  Â  Â  Â  Â  Â  const isLoadingProfils = ref(true);Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Ã‰tat de la confirmation post-soumission
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationVisible = ref(false);
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationImageUrls = ref([]);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationUrls = ref([]);
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationCommentaireUrl = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationTitre = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationDescription = ref('');
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationPromptText = ref('');

Â  Â  Â  Â  Â  Â  Â  Â  // Ã‰tat de la lightbox
Â  Â  Â  Â  Â  Â  Â  Â  const lightboxVisible = ref(false);
Â  Â  Â  Â  Â  Â  Â  Â  const lightboxImageUrl = ref('');

Â  Â  Â  Â  Â  Â  Â  Â  const toolsList = typeof toolsData !== 'undefined' ? toolsData.sort((a, b) => a.name.localeCompare(b.name)) : [];

Â  Â  Â  Â  Â  Â  Â  Â  // Variables pour l'Ã©dition
Â  Â  Â  Â  Â  Â  Â  Â  const isEditMode = ref(false);
Â  Â  Â  Â  Â  Â  Â  Â  const workflowId = ref(null);
Â  Â  Â  Â  Â  Â  Â  Â  const workflowSha = ref(null);Â 

Â  Â  Â  Â  Â  Â  Â  Â  // PropriÃ©tÃ©s calculÃ©es pour le template
Â  Â  Â  Â  Â  Â  Â  Â  const formTitle = computed(() => isEditMode.value ? 'Ã‰diter un Workflow' : 'Partager un Workflow');
Â  Â  Â  Â  Â  Â  Â  Â  const submitButtonText = computed(() => isLoadingFormSubmission.value ? 'Chargement...' : (isEditMode.value ? 'Mettre Ã  jour le Workflow' : 'Partager le Workflow'));
Â  Â  Â  Â  Â  Â  Â  Â  const confirmationMessage = computed(() => isEditMode.value ? 'âœ… Workflow mis Ã  jour avec succÃ¨s !' : 'âœ… Workflow partagÃ© avec succÃ¨s !');

Â  Â  Â  Â  Â  Â  Â  Â  // Fonctions de gestion des fichiers (REINTRODUIT)
Â  Â  Â  Â  Â  Â  Â  Â  function triggerFile() { fileInput.value?.click(); }
Â  Â  Â  Â  Â  Â  Â  Â  function onDragOver(e) { e.currentTarget.classList.add('dragover'); }
Â  Â  Â  Â  Â  Â  Â  Â  function onDragLeave(e) { e.currentTarget.classList.remove('dragover'); }
Â  Â  Â  Â  Â  Â  Â  Â  function onDrop(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.currentTarget.classList.remove('dragover');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = e.dataTransfer.files;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (files.length) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addFiles(files);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  function onFileChange(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = e.target.files;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (files) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addFiles(files);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = null; // RÃ©initialise l'input pour pouvoir uploader les mÃªmes fichiers Ã  nouveau
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  function addFiles(files) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUploadError.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < files.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const file = files[i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (file.type.startsWith('image/') || file.type === 'text/plain' || file.type === 'application/pdf') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newFileObj = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: fileIdCounter++,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  file: file,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewUrl: null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: file.type
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (file.type.startsWith('image/')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.result && typeof e.target.result === 'string' && e.target.result.startsWith('data:image')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newFileObj.previewUrl = e.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value.push(newFileObj);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn(`RÃ©sultat de lecture d'image non valide pour ${file.name}. IgnorÃ©.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUploadError.value = `Impossible de prÃ©visualiser l'image ${file.name}.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.onerror = (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Erreur lecture fichier ${file.name}:`, error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUploadError.value = `Erreur lors de la lecture du fichier ${file.name}.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value.push(newFileObj);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUploadError.value = `Le fichier "${file.name}" de type "${file.type}" n'est pas pris en charge. Seules les images, les fichiers .txt et .pdf sont autorisÃ©s.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  function removeFile(fileIdToRemove) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value = selectedFiles.value.filter(fileObj => fileObj.id !== fileIdToRemove);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUploadError.value = ''; // Efface l'erreur si un fichier est supprimÃ©
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  function getFileIcon(fileType) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileType.startsWith('image/')) return 'ğŸ–¼ï¸'; // Ou 'IMG' si l'icÃ´ne est petite
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileType === 'text/plain') return 'TXT';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileType === 'application/pdf') return 'PDF';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'ğŸ“„'; // IcÃ´ne par dÃ©faut pour document
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Fonctions de gestion des URLs dynamiques
Â  Â  Â  Â  Â  Â  Â  Â  function addUrlField() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value.push('');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  function removeUrlField(index) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value.splice(index, 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (urls.value.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value.push('');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Fonctions de gestion de la lightbox
Â  Â  Â  Â  Â  Â  Â  Â  function openLightbox(imageUrl) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lightboxImageUrl.value = imageUrl;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lightboxVisible.value = true;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  function closeLightbox() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lightboxVisible.value = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lightboxImageUrl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  function handleKeydown(event) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.key === 'Escape' && lightboxVisible.value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  closeLightbox();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  onMounted(async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await fetchProfils();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mode = urlParams.get('mode');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = urlParams.get('id');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sha = urlParams.get('sha');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("URL Params au montage:", { mode, id, sha });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'edit' && id && sha) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isEditMode.value = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflowId.value = id;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  workflowSha.value = sha;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoading.value = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Mode Ã©dition dÃ©tectÃ©. Chargement du workflow:", id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await fetchWorkflowForEdit(id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoading.value = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mode crÃ©ation par dÃ©faut: initialise les champs
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titre.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auteur.value = profilsAuteurs.value.length === 1 ? profilsAuteurs.value[0] : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promptText.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  commentaireUrl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value = [''];Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outils.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customOutil.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // RÃ©initialise les fichiers sÃ©lectionnÃ©s pour le mode crÃ©ation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileInput.value) fileInput.value.value = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoading.value = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.addEventListener('keydown', handleKeydown);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  onUnmounted(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.removeEventListener('keydown', handleKeydown);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Fonction pour charger les profils d'auteurs
Â  Â  Â  Â  Â  Â  Â  Â  async function fetchProfils() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoadingProfils.value = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(`${GET_PROFILS_URL}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorText = await response.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error lors de la rÃ©cupÃ©ration des profils: ${response.status} - ${errorText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const profilsList = Array.isArray(data) ? data : (data.profils || []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const names = [...new Set(profilsList.map(p => typeof p === 'string' ? p : p.name).filter(Boolean))].sort();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  profilsAuteurs.value = names;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (names.length === 1 && !isEditMode.value) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auteur.value = names[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors du chargement des profils:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Impossible de charger la liste des auteurs. VÃ©rifiez la console pour plus de dÃ©tails.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoadingProfils.value = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Fonction pour rÃ©cupÃ©rer un workflow spÃ©cifique pour l'Ã©dition
Â  Â  Â  Â  Â  Â  Â  Â  async function fetchWorkflowForEdit(id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Tentative de rÃ©cupÃ©ration du workflow pour l'Ã©dition avec ID:", id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(GET_TIPS_URL);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorText = await response.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Erreur HTTP lors de la rÃ©cupÃ©ration de tous les workflows: ${response.status} - ${errorText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allWorkflows = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Workflows reÃ§us du backend:", allWorkflows);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const workflowToEdit = allWorkflows.find(w => w.id === id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (workflowToEdit) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Workflow trouvÃ© pour Ã©dition:", workflowToEdit);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titre.value = workflowToEdit.titre || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auteur.value = workflowToEdit.auteur || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description.value = workflowToEdit.description || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promptText.value = workflowToEdit.promptText || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  commentaireUrl.value = workflowToEdit.commentaireUrl || '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // GÃ©rer les outils (checkboxes et champ custom)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (workflowToEdit.outil) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const toolsArray = workflowToEdit.outil.split(',').map(s => s.trim()).filter(Boolean);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outils.value = toolsArray.filter(o => toolsList.some(tl => tl.name === o));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const customToolFound = toolsArray.find(o => !toolsList.some(tl => tl.name === o));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (customToolFound) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outils.value.push('Autre');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customOutil.value = customToolFound;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outils.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customOutil.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // GÃ©rer les URLs (liens additionnels)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value = (Array.isArray(workflowToEdit.urls) && workflowToEdit.urls.length > 0)Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? workflowToEdit.urls.filter(Boolean)Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : [''];Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // GÃ©rer les images/documents multiples pour l'Ã©dition (REINTRODUIT)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Si le workflow a des fileUrls (venant du backend)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (Array.isArray(workflowToEdit.fileUrls) && workflowToEdit.fileUrls.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value = await Promise.all(workflowToEdit.fileUrls.map(async (url, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Pour la prÃ©visualisation, nous avons juste l'URL. Pas le 'File' original.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // On simule un File objet pour la structure, mais le contenu rÃ©el n'est pas lÃ .
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // La soumission n'aura que les NOUVEAUX fichiers.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileName = url.split('/').pop().split('?')[0]; // Extrait le nom de fichier propre
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let fileType = 'application/octet-stream'; // Type par dÃ©faut
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileName.match(/\.(jpg|jpeg|png|gif|webp)$/i)) fileType = 'image/jpeg';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (fileName.match(/\.txt$/i)) fileType = 'text/plain';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else if (fileName.match(/\.pdf$/i)) fileType = 'application/pdf';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: fileIdCounter++,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  file: null, // Pas de fichier rÃ©el pour les fichiers dÃ©jÃ  uploadÃ©s
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  previewUrl: url, // L'URL existante pour l'affichage
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: fileName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: fileType,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isExisting: true // Marqueur pour les fichiers dÃ©jÃ  existants
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Workflow non trouvÃ© avec l'ID:", id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Workflow non trouvÃ© pour Ã©dition. Redirection vers la liste des workflows.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = "/cas-usages.html";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors du chargement du workflow pour Ã©dition:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Impossible de charger le workflow pour Ã©dition: ${error.message}.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = "/cas-usages.html";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // isLoading.value est gÃ©rÃ© dans onMounted pour le chargement initial
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // getBase64 n'est plus nÃ©cessaire car FormData gÃ¨re directement les fichiers binaires.
Â  Â  Â  Â  Â  Â  Â  Â  // function getBase64(file) { ... }

Â  Â  Â  Â  Â  Â  Â  Â  async function submitForm() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Validation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!titre.value.trim() || !auteur.value || !description.value.trim()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Veuillez remplir les champs obligatoires : Titre, Votre nom, et Description.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (outils.value.includes('Autre') && !customOutil.value.trim()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Veuillez spÃ©cifier le nom de l'outil personnalisÃ©.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoadingFormSubmission.value = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationVisible.value = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // UTILISATION DE FormData pour envoyer tous les champs ET les fichiers
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('titre', titre.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('auteur', auteur.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('description', description.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('promptText', promptText.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('commentaireUrl', commentaireUrl.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('outil', outils.value.includes('Autre') && customOutil.value.trim() ? customOutil.value.trim() : finalOutils.join(', '));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('urls', JSON.stringify(urls.value.filter(url => url.trim() !== ''))); // Les URLs sont toujours JSONifiÃ©es

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ajout des fichiers au FormData
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value.forEach(fileObj => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // N'envoyer que les fichiers NOUVEAUX (ceux avec un objet File rÃ©el)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileObj.file) { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('files', fileObj.file, fileObj.name);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Si en mode Ã©dition, inclure l'ID et le SHA, et les URLs des fichiers existants
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isEditMode.value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('id', workflowId.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('sha', workflowSha.value);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Envoyer les URLs des fichiers qui Ã©taient dÃ©jÃ  lÃ  (non supprimÃ©s)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingFileUrls = selectedFiles.value
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(f => f.isExisting)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(f => f.previewUrl);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formData.append('existingFileUrls', JSON.stringify(existingFileUrls)); // Nouveau champ pour les URLs existantes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
                        
                        // DÃ©terminez l'URL de l'API en fonction du mode (crÃ©ation/Ã©dition)
                        const apiUrl = isEditMode.value ? UPDATE_TIP_URL : PUSH_TIP_URL;
                        const httpMethod = isEditMode.value ? 'PUT' : 'POST';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const apiResponse = await fetch(apiUrl, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: httpMethod,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // PAS de 'Content-Type': 'application/json' AVEC FormData, le navigateur le gÃ¨re.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: formData
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("RÃ©ponse brute de la fonction Netlify:", apiResponse);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!apiResponse.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorText = await apiResponse.text();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`${isEditMode.value ? 'Mise Ã  jour' : 'CrÃ©ation'} Ã©chouÃ©e: ${apiResponse.status} - ${errorText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await apiResponse.json();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("RÃ©sultat de l'API:", result);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mise Ã  jour des variables de confirmation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationImageUrls.value = Array.isArray(result.fileUrls) ? result.fileUrls : []; // Utilise fileUrls du backend
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationUrls.value = result.urls || urls.value.filter(url => url.trim() !== ''); // RÃ©utilise les URLs du formulaire si le backend ne les renvoie pas
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationCommentaireUrl.value = result.commentaireUrl || commentaireUrl.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationTitre.value = titre.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationDescription.value = description.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationPromptText.value = promptText.value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationVisible.value = true;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.location.href = "/cas-usages.html";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 5000);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // RÃ©initialisation des champs aprÃ¨s succÃ¨s (uniquement en mode crÃ©ation)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!isEditMode.value) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  titre.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auteur.value = profilsAuteurs.value.length === 1 ? profilsAuteurs.value[0] : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  promptText.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  commentaireUrl.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls.value = [''];Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outils.value = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  customOutil.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedFiles.value = []; // RÃ©initialise les fichiers sÃ©lectionnÃ©s
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fileInput.value) fileInput.value.value = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Erreur lors de l'opÃ©ration (${isEditMode.value ? 'mise Ã  jour' : 'crÃ©ation'}) du workflow:`, err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Ã‰chec de l'opÃ©ration du workflow: ${err.message || err}. VÃ©rifiez la console.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoadingFormSubmission.value = false;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Exposed properties and methods for the template
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auteur, titre, description, promptText, outils, customOutil,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urls, addUrlField, removeUrlField, commentaireUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileInput, fileUploadError, selectedFiles, // SelectedFiles exposÃ©
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoading, isLoadingFormSubmission, profilsAuteurs, isLoadingProfils, toolsList,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationVisible, confirmationImageUrls, confirmationUrls,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationCommentaireUrl, confirmationTitre, confirmationDescription,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  confirmationPromptText,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lightboxVisible, lightboxImageUrl,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isEditMode, formTitle, submitButtonText, confirmationMessage,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  triggerFile, onDragOver, onDragLeave, onDrop, onFileChange,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  removeFile, getFileIcon, submitForm, openLightbox, closeLightbox
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- Initialisation globale au chargement du DOM ---
Â  Â  Â  Â  document.addEventListener("DOMContentLoaded", async () => {
Â  Â  Â  Â  Â  Â  const bodyElement = document.body;
Â  Â  Â  Â  Â  Â  const mainElement = document.querySelector("main");

Â  Â  Â  Â  Â  Â  bodyElement.style.overflow = 'hidden';

Â  Â  Â  Â  Â  Â  await loadComponent("header.html", "header-placeholder");
Â  Â  Â  Â  Â  Â  // Le footer n'est pas inclus ici car il n'Ã©tait pas dans votre code fourni.
Â  Â  Â  Â  Â  Â  // Si vous avez un footer, dÃ©commentez la ligne suivante et assurez-vous de l'existence du fichier 'footer.html':
Â  Â  Â  Â  Â  Â  // await loadComponent("footer.html", "footer-placeholder");Â 

Â  Â  Â  Â  Â  Â  // Mettre Ã  jour l'Ã©tat actif du menu aprÃ¨s le chargement du header
Â  Â  Â  Â  Â  Â  const currentPath = window.location.pathname.split('/').pop();
Â  Â  Â  Â  Â  Â  document.querySelectorAll('nav a').forEach(link => {
Â  Â  Â  Â  Â  Â  Â  Â  const linkHref = link.getAttribute('href');
Â  Â  Â  Â  Â  Â  Â  Â  const linkFileName = linkHref ? linkHref.split('/').pop() : '';
Â  Â  Â  Â  Â  Â  Â  Â  if (linkFileName === currentPath || (currentPath === "" && linkFileName === "index.html") || linkFileName === "creer-tip.html" || linkFileName === "cas-usages.html") {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  link.classList.add("active");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  link.classList.remove("active");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Monter l'application Vue.js sur l'Ã©lÃ©ment #app
Â  Â  Â  Â  Â  Â  createApp(TipForm).mount('#app');

Â  Â  Â  Â  Â  Â  bodyElement.classList.add("show");
Â  Â  Â  Â  Â  Â  if (mainElement) mainElement.classList.add("show");
Â  Â  Â  Â  Â  Â  bodyElement.style.overflow = '';
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
