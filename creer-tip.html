<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Créer un Tip - Espace IA</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { visibility: hidden; }
    main { display: none; }

    .container {
      max-width: 800px;
      margin: 40px auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }

    h1 {
      text-align: center;
      font-size: 1.8em;
      color: #0077b6;
      margin-bottom: 20px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 20px;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 8px;
      font-size: 1em;
      background-color: #f9f9f9;
    }

    button {
      margin-top: 30px;
      padding: 12px 20px;
      border: none;
      background-color: #0077b6;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #005f8a;
    }

    .success {
      margin-top: 20px;
      color: green;
      font-weight: 600;
      text-align: center;
    }

    .error {
        margin-top: 20px;
        color: red;
        font-weight: 600;
        text-align: center;
    }

    .preview {
      margin-top: 30px;
      padding: 15px 20px;
      background: #e3f2fd;
      border-left: 5px solid #0077b6;
      border-radius: 10px;
    }

    .preview h2 {
      margin: 0 0 10px;
      color: #005f8a;
    }

    .preview p {
      margin: 0 0 10px;
    }

    .preview .meta {
      font-size: 0.9em;
      color: #666;
      font-style: italic;
    }
  </style>
</head>
<body>

  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;
        document.body.style.visibility = "visible";
        document.querySelector("main").style.display = "block";
      });
  </script>

  <main>
    <div class="container">
      <h1>Créer un Tip & Cas d’usage</h1>

      <label for="titre">Titre</label>
      <input type="text" id="titre" placeholder="Ex : Créer un visuel pour réseaux sociaux">

      <label for="description">Description</label>
      <textarea id="description" rows="3" placeholder="Décrivez brièvement l’usage ou le contexte"></textarea>

      <label for="prompt">Prompt</label>
      <textarea id="prompt" rows="4" placeholder="Exemple de prompt utilisable par l’IA"></textarea>

      <label for="outil">Outil IA utilisé</label>
      <select id="outil">
        <option value="">-- Sélectionnez --</option>
        <option>ChatGPT</option>
        <option>Claude</option>
        <option>Midjourney</option>
        <option>Firefly</option>
        <option>Perplexity</option>
        <option>Notion AI</option>
      </select>

      <label for="categorie">Catégorie</label>
      <select id="categorie">
        <option value="">-- Sélectionnez --</option>
        <option>Productivité</option>
        <option>Marketing Digital</option>
        <option>Graphisme</option>
        <option>Communication</option>
        <option>CRM</option>
        <option>Com. Presse & Influenceurs</option>
        <option>Partenariats & Évènements</option>
        <option>Positionnement</option>
        <option>Pôle Créa</option>
      </select>

      <label for="auteur">Auteur du Tip</label>
      <select id="auteur">
        <option value="">-- Sélectionnez un auteur --</option>
        </select>

      <button onclick="validerTip()">Enregistrer le tip</button>
      <div class="success" id="message-success" style="display:none">Tip enregistré avec succès ✅</div>
      <div class="error" id="message-error" style="display:none">Erreur lors de l'enregistrement du tip ❌</div>
      <div id="preview-container"></div>
    </div>
  </main>

  <script>
    // URL de votre API backend pour sauvegarder les tips
    const BACKEND_API_URL = 'http://localhost:3000/save-tip'; // À remplacer par l'URL de votre serveur
    // URL de votre API backend ou fichier pour récupérer les noms des profils
    const TEAM_PROFILES_URL = 'http://localhost:3000/team-profiles'; // À remplacer par l'URL de vos profils

    /**
     * Charge les noms des profils de l'équipe et peuple le sélecteur.
     * Pour une mise à jour automatique, cette fonction devrait être appelée
     * après chaque modification sur la page équipe, via une API ou un webhook.
     */
    async function chargerProfilsEquipe() {
        const auteurSelect = document.getElementById('auteur');
        auteurSelect.innerHTML = '<option value="">-- Sélectionnez un auteur --</option>'; // Réinitialise les options

        try {
            // Dans un vrai scénario, vous feriez un fetch vers votre page équipe ou une API
            // Exemple : const response = await fetch(TEAM_PROFILES_URL);
            // const profils = await response.json();

            // Simule des profils d'équipe pour l'exemple
            const profils = [
                { id: '1', nom: 'Alice Dupont' },
                { id: '2', nom: 'Bob Martin' },
                { id: '3', nom: 'Charlie Leblanc' }
            ];

            profils.forEach(profil => {
                const option = document.createElement('option');
                option.value = profil.nom; // Ou profil.id si vous préférez stocker l'ID
                option.textContent = profil.nom;
                auteurSelect.appendChild(option);
            });
        } catch (error) {
            console.error("Erreur lors du chargement des profils de l'équipe :", error);
            // Gérer l'erreur, par exemple, afficher un message à l'utilisateur
        }
    }

    /**
     * Valide les données du tip et l'envoie à l'API backend pour sauvegarde sur GitHub.
     */
    async function validerTip() {
      const titre = document.getElementById('titre').value.trim();
      const description = document.getElementById('description').value.trim();
      const prompt = document.getElementById('prompt').value.trim();
      const outil = document.getElementById('outil').value;
      const categorie = document.getElementById('categorie').value;
      const auteur = document.getElementById('auteur').value; // Nouveau champ

      const messageSuccess = document.getElementById('message-success');
      const messageError = document.getElementById('message-error');
      messageSuccess.style.display = 'none';
      messageError.style.display = 'none';

      if (titre && description && prompt && outil && categorie && auteur) {
        const nouveauTip = { titre, description, prompt, outil, categorie, auteur };

        try {
          // Envoi du tip à votre serveur backend
          const response = await fetch(BACKEND_API_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(nouveauTip),
          });

          if (response.ok) {
            messageSuccess.style.display = 'block';
            setTimeout(() => {
              messageSuccess.style.display = 'none';
            }, 3000);

            // Afficher le preview du tip sauvegardé
            document.getElementById('preview-container').innerHTML = `
              <div class="preview">
                <h2>${titre}</h2>
                <p>${description}</p>
                <div class="prompt-box">
                  <code>${prompt}</code>
                </div>
                <p class="meta">Outil : ${outil} • Catégorie : ${categorie} • Auteur : ${auteur}</p>
              </div>
            `;

            // Réinitialiser le formulaire
            document.querySelectorAll('input, textarea, select').forEach(e => e.value = '');
            document.getElementById('auteur').value = ''; // Réinitialise l'auteur aussi

          } else {
            const errorData = await response.json();
            messageError.textContent = `Erreur lors de l'enregistrement du tip : ${errorData.message || response.statusText}`;
            messageError.style.display = 'block';
            console.error("Erreur serveur :", errorData);
          }
        } catch (error) {
          messageError.textContent = "Impossible de se connecter au serveur. Vérifiez votre connexion ou l'URL du backend.";
          messageError.style.display = 'block';
          console.error("Erreur réseau ou du backend :", error);
        }
      } else {
        alert("Merci de remplir tous les champs obligatoires.");
      }
    }

    // Charge les profils de l'équipe au chargement de la page
    document.addEventListener('DOMContentLoaded', chargerProfilsEquipe);
  </script>
</body>
</html>
