<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partager un Tip / Prompt - iMarketing</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Ces styles sont sp√©cifiques √† la page du formulaire. */
        /* Le design g√©n√©ral (header, footer, etc.) doit √™tre dans style.css */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --background-grey: #f0f2f5;
            --card-shadow: 0 8px 20px rgba(0,0,0,0.05);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-text: #dc3545;
            --grey-text: #555;
            --border-color: #ddd;
        }
        main { padding: 40px 20px; flex-grow: 1; display: flex; justify-content: center; align-items: flex-start; }
        .container { max-width: 600px; width: 100%; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: var(--card-shadow); padding: 30px; box-sizing: border-box; position: relative; }
        label { font-weight: 600; display: block; margin-top: 15px; color: #333; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; background: #f9fafb; box-sizing: border-box; color: #333; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary-blue); outline: none; box-shadow: 0 0 0 2px rgba(0, 119, 182, 0.2); }
        .checkbox-group { max-height: 180px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 15px; margin-top: 5px; background-color: #f9fafb; }
        .checkbox-item { display: flex; align-items: center; margin-bottom: 8px; }
        .checkbox-item:last-child { margin-bottom: 0; }
        .checkbox-item input[type="checkbox"] { width: auto; margin: 0 10px 0 0; flex-shrink: 0; }
        .checkbox-item label { font-weight: 400; margin: 0; cursor: pointer; }
        .url-input-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .url-action-buttons { display: flex; justify-content: flex-end; gap: 10px; margin-top: 5px; margin-bottom: 15px; }
        .add-url-button, .remove-url-button { padding: 8px 12px; border-radius: 6px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: background-color 0.2s, transform 0.1s; border: none; color: white; }
        .add-url-button { background-color: #28a745; }
        .add-url-button:hover { background-color: #218838; }
        .remove-url-button { background-color: #dc3545; }
        .remove-url-button:hover { background-color: #c82333; }
        #drop-zone { border: 2px dashed var(--primary-blue); padding: 20px; text-align: center; color: #777; margin-top: 10px; border-radius: 10px; cursor: pointer; transition: background 0.2s; }
        #drop-zone.dragover { background: #e0f7ff; }
        .file-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 15px; }
        .file-preview-item { position: relative; width: 100px; height: 100px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden; display: flex; justify-content: center; align-items: center; background-color: #f9f9f9; }
        .file-preview-item img.image-preview { max-width: 100%; max-height: 100%; object-fit: contain; display: block; }
        .file-name-overlay { position: absolute; bottom: 0; left: 0; right: 0; background-color: rgba(0, 0, 0, 0.6); color: white; font-size: 0.7em; padding: 3px 5px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .remove-file-button { position: absolute; top: 5px; right: 5px; background-color: rgba(255, 0, 0, 0.7); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 14px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: background-color 0.2s ease; line-height: 1; padding: 0; }
        button[type="submit"] { width: 100%; padding: 12px; background: var(--primary-blue); color: #fff; border: none; border-radius: 8px; margin-top: 25px; font-size: 1em; cursor: pointer; transition: background 0.2s; }
        button[type="submit"]:disabled { background-color: #cccccc; cursor: not-allowed; }
        .confirmation { margin-top: 30px; padding: 20px; background: var(--success-bg); border: 1px solid var(--success-text); border-radius: 10px; text-align: center; color: var(--success-text); }
        .loader { display: block; margin: 20px auto; width: 40px; height: 40px; border: 4px solid var(--border-color); border-top: 4px solid var(--primary-blue); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div id="app">
            <div class="container">
                <a href="/cas-usages.html" class="retour-lien">‚Üê Retour</a>
                <h2 style="text-align:center; color:var(--primary-blue);">Partager un Tip / workflow</h2>

                <div v-if="globalError" style="color: red; background: #f8d7da; padding: 15px; border-radius: 8px; text-align: center;">
                    <strong>Erreur de chargement :</strong> {{ globalError }}
                </div>

                <form @submit.prevent="submitForm" v-else>
                    <label for="auteur">Votre nom</label>
                    <select id="auteur" v-model="auteur" required>
                        <option value="" disabled>S√©lectionnez un nom</option>
                        <option v-for="profilNom in profilsAuteurs" :key="profilNom" :value="profilNom">{{ profilNom }}</option>
                    </select>

                    <label for="titre">Titre du Tip / Workflow</label>
                    <input type="text" id="titre" v-model="titre" required />

                    <label for="description">Description</label>
                    <textarea id="description" v-model="description" rows="4" required></textarea>

                    <label for="previewText">Post-it</label>
                    <textarea id="previewText" v-model="previewText" rows="2" placeholder="Un court extrait..."></textarea>
                    
                    <label for="prompt">Prompt (optionnel)</label>
                    <textarea id="prompt" v-model="promptText" rows="6" placeholder="Collez le prompt exact ici..."></textarea>
                    
                    <label for="categorie">Cat√©gorie</label>
                    <select id="categorie" v-model="categorie">
                         <option>Marketing Digital</option>
                         <option>Strat√©gie</option>
                         <option>Communication & Image de Marque</option>
                         <option>R√©seaux Sociaux</option>
                         <option>Contenu & R√©daction</option>
                         <option>Autre</option>
                    </select>

                    <label>Plateforme(s) / Outil(s)</label>
                    <div class="checkbox-group" role="group">
                        <div v-for="(tool, index) in toolsList" :key="index" class="checkbox-item">
                            <input type="checkbox" :id="'tool-' + index" :value="tool.name" v-model="outils">
                            <label :for="'tool-' + index">{{ tool.name }}</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="tool-autre" value="Autre" v-model="outils">
                            <label for="tool-autre">Autre</label>
                        </div>
                    </div>
                    <input type="text" v-if="outils.includes('Autre')" v-model="customOutil" placeholder="Sp√©cifiez l'outil..." style="margin-top: 10px;" />

                    <label>Lien(s) associ√©(s) - archive chatGPT/Gemini :</label>
                    <div v-for="(url, index) in urls" :key="index" class="url-input-group">
                        <input type="url" v-model="urls[index]" :placeholder="`Lien ${index + 1}`" />
                        <button type="button" @click="removeUrlField(index)" class="remove-url-button">X</button>
                    </div>
                    <div class="url-action-buttons">
                        <button type="button" @click="addUrlField" class="add-url-button">Ajouter un lien</button>
                    </div>

                    <label for="commentaireUrl">Commentaire / workflow</label>
                    <textarea id="commentaireUrl" v-model="commentaireUrl" rows="2" placeholder="Ajoutez un commentaire..."></textarea>

                    <label>Images / Documents (optionnel)</label>
                    <div id="drop-zone" @click="triggerFile" @dragover.prevent="onDragOver" @dragleave="onDragLeave" @drop.prevent="onDrop">
                        D√©posez ou cliquez pour ajouter des fichiers
                    </div>
                    <input type="file" ref="fileInput" @change="onFileChange" multiple style="display:none" accept="image/*,.txt,.pdf" />
                    <div class="file-preview-grid">
                        <div v-for="fileObj in selectedFiles" :key="fileObj.id" class="file-preview-item">
                            <img v-if="fileObj.type.startsWith('image/')" :src="fileObj.previewUrl" :alt="fileObj.name" />
                            <span v-else>üìÑ</span>
                            <span class="file-name-overlay">{{ fileObj.name }}</span>
                            <button type="button" @click="removeFile(fileObj.id)" class="remove-file-button">&times;</button>
                        </div>
                    </div>

                    <div v-if="isLoading" class="loader"></div>
                    <button v-else type="submit" :disabled="!auteur || !titre || !description || isLoading">Partager</button>
                </form>

                <div class="confirmation" v-if="confirmationVisible">
                     <p>‚úÖ Tip / Prompt partag√© avec succ√®s ! Redirection...</p>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="tools-data.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const { ref, createApp, onMounted, onUnmounted } = Vue;

            // --- Chargement du Header et Footer ---
            const loadComponent = (url, placeholderId) => {
                fetch(url)
                    .then(res => res.ok ? res.text() : Promise.reject(`Erreur de chargement: ${url}`))
                    .then(html => document.getElementById(placeholderId).innerHTML = html)
                    .catch(err => console.error(err));
            };
            loadComponent('header.html', 'header-placeholder');
            loadComponent('footer.html', 'footer-placeholder');

            // --- V√©rification des d√©pendances critiques ---
            if (typeof toolsData === 'undefined' || !Array.isArray(toolsData)) {
                console.error("Erreur critique : Le fichier 'tools-data.js' est manquant ou invalide.");
                createApp({ setup: () => ({ globalError: ref("Impossible de charger la liste des outils.") }) }).mount('#app');
                return;
            }

            // --- Application Vue.js ---
            const TipForm = {
                setup() {
                    const allRefs = {
                        auteur: ref(''), titre: ref(''), description: ref(''),
                        previewText: ref(''), promptText: ref(''), categorie: ref('Marketing Digital'),
                        outils: ref([]), customOutil: ref(''), urls: ref(['']), commentaireUrl: ref(''),
                        selectedFiles: ref([]), fileInput: ref(null),
                        isLoading: ref(false), profilsAuteurs: ref([]),
                        confirmationVisible: ref(false),
                        toolsList: ref([...toolsData].sort((a, b) => a.name.localeCompare(b.name))),
                        globalError: ref(null)
                    };

                    const addUrlField = () => allRefs.urls.value.push('');
                    const removeUrlField = (index) => allRefs.urls.value.splice(index, 1);
                    
                    let fileIdCounter = 0;
                    const addFiles = (files) => {
                        for (const file of files) {
                            const newFileObj = { id: fileIdCounter++, file, name: file.name, type: file.type, previewUrl: file.type.startsWith('image/') ? URL.createObjectURL(file) : null };
                            allRefs.selectedFiles.value.push(newFileObj);
                        }
                    };
                    const removeFile = (fileId) => {
                         const fileObj = allRefs.selectedFiles.value.find(f => f.id === fileId);
                        if (fileObj && fileObj.previewUrl) URL.revokeObjectURL(fileObj.previewUrl);
                        allRefs.selectedFiles.value = allRefs.selectedFiles.value.filter(f => f.id !== fileId);
                    };

                    const submitForm = async () => {
                        allRefs.isLoading.value = true;
                        // ... votre logique de soumission compl√®te ici ...
                        console.log("Formulaire soumis !");
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        allRefs.confirmationVisible.value = true;
                        allRefs.isLoading.value = false;
                    };
                    
                    return { ...allRefs, addUrlField, removeUrlField, addFiles, removeFile, submitForm, triggerFile: () => allRefs.fileInput.value.click(), onDragOver: e => e.currentTarget.classList.add('dragover'), onDragLeave: e => e.currentTarget.classList.remove('dragover'), onDrop: e => { e.currentTarget.classList.remove('dragover'); addFiles(e.dataTransfer.files); }, onFileChange: e => addFiles(e.target.files) };
                }
            };

            createApp(TipForm).mount('#app');
        });
    </script>
</body>
</html>
