<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veille IA Marketing</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        body {
            opacity: 0;
            transition: opacity 0.3s ease-in;
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f0f4f8;
        }
        main {
            display: none; /* Main caché au début, sera affiché par le script */
        }
        .container {
            max-width: 1000px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .filters input,
        .filters select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background: #f9f9f9;
            min-width: 200px;
        }
        .card {
            background: #e3f2fd;
            border-left: 5px solid #0077b6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
        }
        .card h2 {
            margin: 0 0 10px;
            color: #005f8a;
        }
        .tag {
            background: #b3e0ff;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            display: inline-block;
        }
        .source {
            font-size: 0.8rem;
            color: #555;
            margin-top: 0.5rem;
        }
        a {
            color: #007acc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        footer {
            text-align: center;
            margin-top: 4rem;
            font-size: 0.9rem;
            color: #888;
            padding-bottom: 20px; /* Ajouté pour un peu d'espace */
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div class="container">
            <div class="filters">
                <input type="search" id="search" placeholder="Rechercher un article..." oninput="filtrerArticles()">
                <select id="filtre-tag" onchange="filtrerArticles()">
                    <option value="">Tous les tags</option>
                    <option value="Marketing Video">Marketing Video</option>
                    <option value="Comportement des consommateurs">Comportement des consommateurs</option>
                    <option value="Analyse de marché">Analyse de marché</option>
                    <option value="Personnalisation">Personnalisation</option>
                    <option value="Création de contenu">Création de contenu</option>
                </select>
            </div>
            <div id="articles"></div>
        </div>
    </main>

    <footer>Mis à jour automatiquement le 2025-06-09</footer>

    <script>
        const PROXY_URL = "/.netlify/functions/proxy"; // Adaptez si nécessaire

        const articles = [
            {
                titre: "Midjourney lance un outil vidéo",
                date: "2025-06-01",
                tag: "Marketing Video",
                resume: "Midjourney lance un outil d'IA vidéo pour optimiser les campagnes marketing.",
                lien: "https://www.midjourney.com/press/video-tool",
                source: "Midjourney Press Release"
            },
            {
                titre: "OpenAI annonce un nouveau modèle",
                date: "2025-06-01",
                tag: "Comportement des consommateurs",
                resume: "OpenAI présente un nouveau modèle d'IA pour améliorer les prédictions de comportement des consommateurs.",
                lien: "https://www.openai.com/new-model",
                source: "OpenAI Official Announcement"
            },
            {
                titre: "Mistral publie un modèle open-source",
                date: "2025-05-30",
                tag: "Analyse de marché",
                resume: "Mistral publie un nouveau modèle open-source d'IA pour aider les entreprises à comprendre les tendances du marché.",
                lien: "https://www.mistral.ai/news/open-source-model",
                source: "Mistral Blog"
            },
            {
                titre: "Meta open-source un modèle IA",
                date: "2025-05-28",
                tag: "Personnalisation",
                resume: "Meta rend un modèle d'IA open-source pour aider les spécialistes du marketing à personnaliser les expériences utilisateur.",
                lien: "https://about.fb.com/news/ai-model",
                source: "Meta Official Announcement"
            },
            {
                titre: "Runway améliore la génération vidéo",
                date: "2025-05-25",
                tag: "Création de contenu",
                resume: "Runway lance une mise à jour de son outil de génération vidéo basé sur l'IA pour une création de contenu plus efficace.",
                lien: "https://www.runwayml.com/updates/video-generator-update",
                source: "Runway Press Release"
            }
        ];

        function renderArticles(liste) {
            console.log("Veille: Rendu des articles. Nombre:", liste.length);
            const container = document.getElementById('articles');
            container.innerHTML = '';
            if (liste.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Aucun article ne correspond à vos filtres.</p>';
            }
            liste.forEach(article => {
                const el = document.createElement('div');
                el.className = 'card';
                el.innerHTML = `
                    <h2>${article.titre}</h2>
                    <p><strong>${new Date(article.date).toLocaleDateString('fr-BE')}</strong> – <span class="tag">${article.tag}</span></p>
                    <p>${article.resume}</p>
                    <a href="${article.lien}" target="_blank">Lire l’article →</a>
                    <p class="source">Source : ${article.source}</p>
                `;
                container.appendChild(el);
            });
        }

        function filtrerArticles() {
            console.log("Veille: Application des filtres...");
            const search = document.getElementById('search').value.toLowerCase();
            const tag = document.getElementById('filtre-tag').value;
            const filtres = articles.filter(a =>
                (!search || a.titre.toLowerCase().includes(search) || a.resume.toLowerCase().includes(search)) &&
                (!tag || a.tag === tag)
            );
            renderArticles(filtres);
            console.log(`Veille: Filtres appliqués. ${filtres.length} articles trouvés.`);
        }

        // Fonction pour mettre à jour la bulle de notification (identique aux autres pages)
        // La fonction reste présente mais ne sera plus appelée automatiquement
        async function mettreAJourBulleDemandes() {
            const notif = document.getElementById("notif-count");
            if (!notif) {
                console.warn("Veille: L'élément 'notif-count' n'a pas été trouvé dans le header.");
                return;
            }
            try {
                console.log("Veille: Tentative de récupération des demandes pour la bulle...");
                const res = await fetch(`${PROXY_URL}?action=getDemandesIA`);
                if (!res.ok) {
                    console.error(`Veille: Erreur HTTP lors de la récupération des demandes: ${res.status}`);
                    throw new Error(`Erreur HTTP: ${res.status}`);
                }
                const demandes = await res.json();
                console.log("Veille: Demandes récupérées pour la bulle:", demandes);
                notif.textContent = demandes.length;
                notif.style.display = demandes.length > 0 ? "inline-block" : "none";
            } catch (e) {
                console.error("Veille: Erreur mise à jour compteur de demandes :", e);
                notif.style.display = "none";
            }
        }

        // Exécution principale à l'initialisation de la page
        document.addEventListener("DOMContentLoaded", () => {
            console.log("Veille: DOM entièrement chargé. Début de l'initialisation de veille.html...");
            fetch("header.html")
                .then(response => {
                    console.log("Veille: Réponse de fetch('header.html') reçue.");
                    if (!response.ok) {
                        throw new Error(`Erreur HTTP lors du chargement du header pour Veille: ${response.status}`);
                    }
                    return response.text();
                })
                .then(data => {
                    console.log("Veille: Header HTML récupéré. Injection dans le placeholder.");
                    document.getElementById("header-placeholder").innerHTML = data;

                    console.log("Veille: Rendre le body et le main visibles.");
                    document.body.style.opacity = "1";
                    const mainElement = document.querySelector("main");
                    if (mainElement) {
                        mainElement.style.display = "block";
                    }

                    // console.log("Veille: Mise à jour de la bulle de notification.");
                    // mettreAJourBulleDemandes(); // Cette ligne est maintenant commentée

                    console.log("Veille: Gestion des liens actifs du menu.");
                    const path = location.pathname.split("/").pop();
                    const links = document.querySelectorAll("nav a");
                    links.forEach(link => {
                        if (link.getAttribute("href") === path) {
                            link.classList.add("active");
                        }
                    });

                    // Initialiser l'affichage des articles et attacher les écouteurs d'événements
                    renderArticles(articles); // Affiche tous les articles au chargement
                    console.log("Veille: Articles initiaux rendus.");

                    // Les écouteurs oninput/onchange sont déjà dans le HTML, mais c'est une bonne pratique de les attacher ici aussi si besoin.
                    // document.getElementById('search').addEventListener('input', filtrerArticles);
                    // document.getElementById('filtre-tag').addEventListener('change', filtrerArticles);

                })
                .catch(error => {
                    console.error("Veille: Erreur critique lors du chargement du header ou initialisation de Veille:", error);
                    document.getElementById("header-placeholder").innerHTML = "<p style='color:white;text-align:center'>Erreur de chargement du menu</p>";
                    // Rendre visible même en cas d'erreur du header pour ne pas laisser une page blanche
                    document.body.style.opacity = "1";
                    const mainElement = document.querySelector("main");
                    if (mainElement) {
                        mainElement.style.display = "block";
                    }
                });
        });
    </script>
</body>
</html>
