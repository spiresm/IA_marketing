<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veille IA Marketing</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Styles généraux pour l'animation d'apparition de la page */
        body {
            opacity: 0;
            transition: opacity 0.5s ease-in; /* Transition plus douce */
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f0f4f8; /* Couleur de fond plus moderne */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        body.show {
            opacity: 1;
        }
        main {
            display: none; /* Main caché au début, sera affiché par le script */
            flex-grow: 1; /* Permet au main de prendre l'espace disponible */
        }
        main.show {
            display: block; /* S'assure que main devient visible */
        }
        #header-placeholder, #footer-placeholder {
            width: 100%;
        }

        /* Conteneur principal de la veille */
        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* En-tête de la veille */
        .veille-header {
            text-align: center;
            margin-bottom: 30px;
            /* Ajout pour masquer le header si besoin, mais le h1 est supprimé */
            display: none; /* Cache complètement le conteneur du titre si vide */
        }
        .veille-header h1 {
            color: #0077b6;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .veille-header p {
            color: #555;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Filtres et recherche */
        .filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .filters select,
        .filters input {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .filters select:focus,
        .filters input:focus {
            outline: none;
            border-color: #0077b6;
            box-shadow: 0 0 0 3px rgba(0, 119, 182, 0.2);
        }
        .filters input {
            flex-grow: 1;
            max-width: 300px;
        }

        /* Grille des articles */
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            padding-bottom: 20px; /* Espace avant le footer */
        }

        /* Carte d'article */
        .article-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            cursor: pointer;
            border: 1px solid #e0e0e0;
        }
        .article-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        /* Styles pour l'image retirés */
        /* .article-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 1px solid #eee;
        } */
        .article-card .content {
            padding: 18px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .article-card h3 {
            font-size: 1.3rem;
            color: #0077b6;
            margin: 0 0 10px;
            line-height: 1.3;
        }
        .article-card p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limite le texte à 3 lignes */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .article-card .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #888;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        .article-card .date,
        .article-card .source {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .article-card .source {
            font-weight: bold;
        }

        /* Boutons d'action - Ajustements pour l'alignement */
        .button-group {
            display: flex; /* Utilise flexbox pour l'alignement */
            justify-content: center; /* Centre les boutons horizontalement */
            gap: 20px; /* Espace entre les boutons */
            margin-top: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Permet aux boutons de passer à la ligne sur petits écrans */
        }
        .button-group button {
            background: #0077b6;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 119, 182, 0.3);
            /* margin: 0 10px; - Remplacé par gap dans le flex container */
        }
        .button-group button:hover {
            background: #005f8a;
            transform: translateY(-2px);
        }
        .button-group button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 119, 182, 0.3);
        }

        /* Loader pour l'ajout d'article */
        #add-article-loader {
            display: none;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        #add-article-loader .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0077b6; /* Couleur de votre thème */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Popup pour le formulaire d'ajout/édition */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 600px;
            position: relative;
            max-height: 90vh; /* Limite la hauteur de la modale */
            overflow-y: auto; /* Ajoute un scroll si le contenu dépasse */
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }

        .modal-content h2 {
            color: #0077b6;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .modal-content label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .modal-content input[type="text"],
        .modal-content input[type="url"],
        .modal-content textarea,
        .modal-content select {
            width: calc(100% - 20px); /* Adjust to account for padding */
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box; /* Include padding in width */
        }

        .modal-content textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-content button {
            background-color: #0077b6;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 10px;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        .modal-content button:hover {
            background-color: #005f8a;
        }

        /* Message de statut pour la modal */
        #modal-status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            display: none; /* Masqué par défaut */
        }

        #modal-status-message.success {
            background-color: #d4edda; /* Vert clair */
            color: #155724; /* Vert foncé */
        }

        #modal-status-message.error {
            background-color: #f8d7da; /* Rouge clair */
            color: #721c24; /* Rouge foncé */
        }

        /* Overlay de chargement pour la modal */
        #modal-loader-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        #modal-loader-overlay .spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0077b6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        #modal-loader-overlay p {
            margin-top: 15px;
            font-size: 1.1rem;
            color: #555;
        }

        /* --- Styles pour la bulle d'information initiale --- */
        .info-bubble-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Fond semi-transparent */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Assure que la bulle est au-dessus de tout le reste */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .info-bubble-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .info-bubble-content {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            text-align: center;
            position: relative;
            transform: translateY(20px); /* Légère animation d'apparition */
            transition: transform 0.3s ease;
        }

        .info-bubble-overlay.visible .info-bubble-content {
            transform: translateY(0);
        }

        .info-bubble-content h3 {
            color: #003366;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .info-bubble-content p {
            color: #444;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .info-bubble-content button {
            background-color: #0077b6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .info-bubble-content button:hover {
            background-color: #005f8a;
        }

        /* Media Queries pour la responsivité */
        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                gap: 10px;
            }
            .filters select,
            .filters input {
                width: calc(100% - 20px); /* Ajuste la largeur pour les petits écrans */
                margin: 0 auto;
            }
            .articles-grid {
                grid-template-columns: 1fr; /* Une seule colonne sur mobile */
            }
            .button-group button {
                width: calc(100% - 20px);
                margin-bottom: 10px;
            }
            /* Styles spécifiques pour les petites écrans de la bulle d'info */
            .info-bubble-content {
                margin: 20px;
                padding: 20px;
            }
            .info-bubble-content h3 {
                font-size: 1.3em;
            }
            .info-bubble-content p {
                font-size: 0.9em;
            }
            .info-bubble-content button {
                font-size: 1em;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <div id="info-bubble-overlay" class="info-bubble-overlay">
        <div class="info-bubble-content">
            <h3>Bienvenue dans la Veille IA & Marketing !</h3>
            <p>
                Gardez un œil sur les dernières actualités et avancées en intelligence artificielle appliquées au marketing. Utilisez la barre de recherche pour trouver des articles spécifiques ou filtrez par catégories pour rester informé des tendances qui comptent.
            </p>
            <button id="info-bubble-close-btn">Compris !</button>
        </div>
    </div>

    <div id="header-placeholder"></div>

    <main>
        <div class="container">
            <div class="veille-header" style="display: none;">
                <h1>Veille IA Marketing</h1>
            </div>

            <div class="filters">
                <select id="categoryFilter">
                    <option value="">Toutes les catégories</option>
                    <option value="Actualités">Actualités</option>
                    <option value="Outils">Outils</option>
                    <option value="Stratégie">Stratégie</option>
                    <option value="Données">Données</option>
                    <option value="Éthique">Éthique</option>
                    <option value="Automatisation">Automatisation</option>
                    <option value="Personnalisation">Personnalisation</option>
                    <option value="Contenu">Contenu</option>
                </select>
                <input type="text" id="searchInput" placeholder="Rechercher par titre ou mot-clé...">
            </div>

            <div class="articles-grid" id="articles-list">
                </div>

            <div class="button-group">
                <button id="addArticleBtn">Ajouter un nouvel article</button>
                <button id="loadMoreBtn">Charger plus d'articles</button>
            </div>
            <div id="add-article-loader">
                <div class="spinner"></div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <div id="articleModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modalTitle">Ajouter un nouvel article</h2>
            <form id="articleForm">
                <label for="articleTitle">Titre de l'article:</label>
                <input type="text" id="articleTitle" required>

                <label for="articleCategory">Catégorie:</label>
                <select id="articleCategory" required>
                    <option value="">Sélectionner une catégorie</option>
                    <option value="Actualités">Actualités</option>
                    <option value="Outils">Outils</option>
                    <option value="Stratégie">Stratégie</option>
                    <option value="Données">Données</option>
                    <option value="Éthique">Éthique</option>
                    <option value="Automatisation">Automatisation</option>
                    <option value="Personnalisation">Personnalisation</option>
                    <option value="Contenu">Contenu</option>
                </select>

                <label for="articleSource">Source:</label>
                <input type="text" id="articleSource" required>

                <label for="articleUrl">URL de l'article:</label>
                <input type="url" id="articleUrl" required>

                <label for="articleImageUrl">URL de l'image (optionnel):</label>
                <input type="url" id="articleImageUrl">

                <label for="articleDescription">Description (optionnel):</label>
                <textarea id="articleDescription"></textarea>

                <button type="submit" id="submitArticleBtn">Ajouter l'article</button>
                <div id="modal-status-message"></div>
            </form>
            <div id="modal-loader-overlay">
                <div class="spinner"></div>
                <p>Chargement...</p>
            </div>
        </div>
    </div>


    <script>
        const ARTICLES_PER_LOAD = 9; // Nombre d'articles à charger à chaque fois
        
        // ARTICLES INITIAUX (réintégrés ici)
        let articles = [
            {
                id: '1',
                title: "L'IA générative révolutionne la création de contenu marketing",
                category: "Contenu",
                source: "MarketingTech.com",
                url: "https://www.marketingtech.com/generative-ai-content",
                imageUrl: "https://images.unsplash.com/photo-1620712943547-cd0cfcfb172a?fit=crop&w=600&h=380&q=80",
                description: "Comment les outils d'IA comme GPT-4 et Midjourney transforment la production de textes, images et vidéos pour les campagnes marketing.",
                date: "2024-05-15"
            },
            {
                id: '2',
                title: "Personnalisation à grande échelle : le rôle clé de l'IA en 2024",
                category: "Personnalisation",
                source: "DigitalMarketing.org",
                url: "https://www.digitalmarketing.org/ai-personalization",
                imageUrl: "https://images.unsplash.com/photo-1557804506-669a67965da0?fit=crop&w=600&h=380&q=80",
                description: "L'IA permet aux marques de proposer des expériences hyper-personnalisées à leurs clients, augmentant l'engagement et les conversions.",
                date: "2024-05-10"
            },
            {
                id: '3',
                title: "Éthique de l'IA en marketing : transparence et biais",
                category: "Éthique",
                source: "AIforGood.com",
                url: "https://www.aiforgood.com/ai-ethics-marketing",
                imageUrl: "https://images.unsplash.com/photo-1542744173-8e7e53415c10?fit=crop&w=600&h=380&q=80",
                description: "Les entreprises doivent naviguer entre innovation et responsabilité éthique face aux défis des algorithmes biaisés et de la vie privée.",
                date: "2024-05-08"
            },
            {
                id: '4',
                title: "Automatisation du marketing avec l'IA : les nouvelles frontières",
                category: "Automatisation",
                source: "MarketingAutomationPro.net",
                url: "https://www.marketingautomationpro.net/ai-automation",
                imageUrl: "https://images.unsplash.com/photo-1582213782179-e0dce381665a?fit=crop&w=600&h=380&q=80",
                description: "De l'envoi d'e-mails à l'optimisation des campagnes publicitaires, l'IA rend l'automatisation plus intelligente et plus efficace.",
                date: "2024-05-05"
            },
            {
                id: '5',
                title: "L'impact de l'IA sur l'analyse des données clients",
                category: "Données",
                source: "DataScienceDaily.io",
                url: "https://www.datasciencedaily.io/ai-customer-data",
                imageUrl: "https://images.unsplash.com/photo-1551288259-cd919c72bb98?fit=crop&w=600&h=380&q=80",
                description: "Les algorithmes d'IA permettent d'extraire des insights plus profonds des vastes quantités de données clients, facilitant la prise de décision marketing.",
                date: "2024-05-01"
            },
            {
                id: '6',
                title: "Top 5 des outils d'IA pour les spécialistes du marketing en 2024",
                category: "Outils",
                source: "TechReviews.com",
                url: "https://www.techreviews.com/top-ai-marketing-tools",
                imageUrl: "https://images.unsplash.com/photo-1610427977051-5183884f1837?fit=crop&w=600&h=380&q=80",
                description: "Une revue des plateformes et applications essentielles qui utilisent l'IA pour booster l'efficacité des équipes marketing.",
                date: "2024-04-28"
            },
            {
                id: '7',
                title: "Stratégies marketing basées sur l'IA : cas d'études réussis",
                category: "Stratégie",
                source: "BizSuccess.co",
                url: "https://www.bizsuccess.co/ai-marketing-case-studies",
                imageUrl: "https://images.unsplash.com/photo-1556761175-59427b382d6b?fit=crop&w=600&h=380&q=80",
                description: "Des exemples concrets de marques qui ont intégré l'IA dans leur stratégie marketing pour obtenir des résultats exceptionnels.",
                date: "2024-04-25"
            },
            {
                id: '8',
                title: "L'IA et la voix : le futur de la publicité audio",
                category: "Actualités",
                source: "VoiceTechNews.io",
                url: "https://www.voicetechnews.io/ai-audio-ads",
                imageUrl: "https://images.unsplash.com/photo-1518707474443-7eb9725f778d?fit=crop&w=600&h=380&q=80",
                description: "Comment l'IA est utilisée pour créer des publicités audio dynamiques et personnalisées pour les enceintes connectées et podcasts.",
                date: "2024-04-22"
            },
            {
                id: '9',
                title: "ChatGPT pour le marketing : au-delà des bases",
                category: "Contenu",
                source: "AIContentPro.com",
                url: "https://www.aicontentpro.com/chatgpt-advanced-marketing",
                imageUrl: "https://images.unsplash.com/photo-1684362985338-f9d6c7e2f5b6?fit=crop&w=600&h=380&q=80",
                description: "Exploration des techniques avancées pour utiliser ChatGPT dans la rédaction marketing, l'idéation et le service client.",
                date: "2024-04-20"
            },
            {
                id: '10',
                title: "Prévisions de tendances marketing avec l'IA",
                category: "Données",
                source: "FutureMarketing.net",
                url: "https://www.futuremarketing.net/ai-trend-prediction",
                imageUrl: "https://images.unsplash.com/photo-1620392395147-380d5b00c3b3?fit=crop&w=600&h=380&q=80",
                description: "L'IA analyse d'énormes ensembles de données pour prédire les prochaines grandes tendances de consommation et de marché.",
                date: "2024-04-18"
            },
            {
                id: '11',
                title: "Cybersécurité et IA : protéger les données marketing",
                category: "Éthique",
                source: "CyberSecurityReview.org",
                url: "https://www.cybersecurityreview.org/ai-marketing-data",
                imageUrl: "https://images.unsplash.com/photo-1610427977051-5183884f1837?fit=crop&w=600&h=380&q=80",
                description: "Comment l'IA aide à identifier et à prévenir les menaces de sécurité qui pèsent sur les données sensibles des campagnes marketing.",
                date: "2024-04-15"
            },
            {
                id: '12',
                title: "Marketing d'influence boosté par l'IA",
                category: "Stratégie",
                source: "InfluencerMarketingHub.com",
                url: "https://www.influencermarketinghub.com/ai-influencer-marketing",
                imageUrl: "https://images.unsplash.com/photo-1520607162513-772a1f499426?fit=crop&w=600&h=380&q=80",
                description: "L'IA aide à identifier les influenceurs les plus pertinents et à mesurer l'impact réel des campagnes.",
                date: "2024-04-12"
            }
        ];
        
        let displayedArticlesCount = 0; // Compteur des articles actuellement affichés

        const articlesList = document.getElementById("articles-list");
        const categoryFilter = document.getElementById("categoryFilter");
        const searchInput = document.getElementById("searchInput");
        const loadMoreBtn = document.getElementById("loadMoreBtn");
        const addArticleBtn = document.getElementById("addArticleBtn");
        const addArticleLoader = document.getElementById("add-article-loader");
        const mainElement = document.querySelector("main"); // Sélectionne l'élément main

        // Modal elements
        const articleModal = document.getElementById("articleModal");
        const closeButton = document.querySelector(".close-button");
        const articleForm = document.getElementById("articleForm");
        const modalTitle = document.getElementById("modalTitle");
        const submitArticleBtn = document.getElementById("submitArticleBtn");
        const modalStatusMessage = document.getElementById("modal-status-message");
        const modalLoaderOverlay = document.getElementById("modal-loader-overlay");

        // Info bubble elements
        const infoBubbleOverlay = document.getElementById("info-bubble-overlay");
        const infoBubbleCloseBtn = document.getElementById("info-bubble-close-btn");

        let currentArticleId = null; // Pour l'édition: stocke l'ID de l'article en cours d'édition

        // Fonction pour normaliser les chaînes de caractères (minuscules, sans accents)
        function normalizeString(str) {
            if (typeof str !== 'string') return '';
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        // Fonction pour afficher les messages de statut dans la modale
        function showModalStatus(message, type) {
            modalStatusMessage.textContent = message;
            modalStatusMessage.className = ''; // Réinitialise les classes
            modalStatusMessage.classList.add(type);
            modalStatusMessage.style.display = 'block';
            setTimeout(() => {
                modalStatusMessage.style.display = 'none';
            }, 3000); // Masque le message après 3 secondes
        }

        // Fonction pour générer le HTML d'une carte d'article
        function createArticleCard(article) {
            const card = document.createElement("div");
            card.className = "article-card";
            card.dataset.id = article.id; // Stocke l'ID de l'article pour l'édition/suppression

            // L'image est retirée comme demandé
            card.innerHTML = `
                <div class="content">
                    <h3>${article.title || 'Titre Inconnu'}</h3>
                    <p>${article.description || 'Pas de description disponible.'}</p>
                    <div class="meta">
                        <span class="date"><i class="fa-solid fa-calendar-alt"></i> ${article.date || 'Date inconnue'}</span>
                        <span class="source"><i class="fa-solid fa-newspaper"></i> ${article.source || 'Source inconnue'}</span>
                    </div>
                </div>
            `;

            // Ajoute un écouteur de clic pour ouvrir l'URL de l'article
            card.addEventListener('click', () => {
                if (article.url) {
                    window.open(article.url, '_blank');
                } else {
                    alert('URL de l\'article non disponible.');
                }
            });

            return card;
        }

        // Fonction pour rendre les articles filtrés/recherchés et charger plus
        function renderArticles(articlesToRender, append = false) {
            if (!append) {
                articlesList.innerHTML = ""; // Vide la liste pour un nouveau rendu
                displayedArticlesCount = 0;
            }

            const category = normalizeString(categoryFilter.value);
            const searchTerm = normalizeString(searchInput.value);

            const filteredAndSearchedArticles = articlesToRender.filter(article => {
                const matchesCategory = !category || normalizeString(article.category).includes(category);
                const matchesSearch = !searchTerm ||
                                      normalizeString(article.title).includes(searchTerm) ||
                                      normalizeString(article.description).includes(searchTerm) ||
                                      normalizeString(article.source).includes(searchTerm);
                return matchesCategory && matchesSearch;
            });

            // Tri par date (du plus récent au plus ancien)
            filteredAndSearchedArticles.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return dateB - dateA;
            });

            // Afficher les articles par lots
            const articlesToAdd = filteredAndSearchedArticles.slice(displayedArticlesCount, displayedArticlesCount + ARTICLES_PER_LOAD);

            articlesToAdd.forEach(article => {
                articlesList.appendChild(createArticleCard(article));
            });

            displayedArticlesCount += articlesToAdd.length;

            // Gérer la visibilité du bouton "Charger plus"
            if (displayedArticlesCount < filteredAndSearchedArticles.length) {
                loadMoreBtn.style.display = "block";
            } else {
                loadMoreBtn.style.display = "none";
            }
             if (filteredAndSearchedArticles.length === 0 && articlesToAdd.length === 0) { // Condition affinée pour le message d'absence d'articles
                articlesList.innerHTML = '<p style="text-align: center; color: #666; width: 100%;">Aucun article ne correspond à vos critères.</p>';
                loadMoreBtn.style.display = "none";
            }
        }

        // --- Écouteurs d'événements ---
        categoryFilter.addEventListener("change", () => renderArticles(articles));
        searchInput.addEventListener("input", () => renderArticles(articles));
        loadMoreBtn.addEventListener("click", () => renderArticles(articles, true)); // true pour append

        addArticleBtn.addEventListener("click", () => {
            currentArticleId = null; // Réinitialise l'ID pour un nouvel ajout
            modalTitle.textContent = "Ajouter un nouvel article";
            submitArticleBtn.textContent = "Ajouter l'article";
            articleForm.reset(); // Vide le formulaire
            modalStatusMessage.style.display = 'none'; // Cache le message de statut
            articleModal.style.display = "flex"; // Affiche la modale
        });

        closeButton.addEventListener("click", () => {
            articleModal.style.display = "none";
        });

        window.addEventListener("click", (event) => {
            if (event.target == articleModal) {
                articleModal.style.display = "none";
            }
        });

        // La soumission du formulaire sera désactivée/modifiée car nous n'avons plus de backend direct
        articleForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            modalLoaderOverlay.style.display = 'flex'; // Affiche le loader dans la modale

            const articleData = {
                // Pour l'ajout "local", un ID simple peut être généré
                id: Date.now().toString(), // Génère un ID unique basé sur le timestamp
                title: document.getElementById("articleTitle").value,
                category: document.getElementById("articleCategory").value,
                source: document.getElementById("articleSource").value,
                url: document.getElementById("articleUrl").value,
                imageUrl: document.getElementById("articleImageUrl").value, // L'URL d'image est toujours capturée, même si non affichée.
                description: document.getElementById("articleDescription").value,
                date: new Date().toISOString().slice(0, 10) // Date actuelle au format AAAA-MM-JJ
            };

            // Simule l'ajout d'article au tableau local
            articles.unshift(articleData); // Ajoute le nouvel article au début du tableau

            // Simule un délai pour l'opération
            setTimeout(() => {
                modalLoaderOverlay.style.display = 'none';
                showModalStatus('Article ajouté localement ! (Non persistant)', 'success');
                renderArticles(articles); // Re-render les articles pour afficher le nouveau
                setTimeout(() => {
                    articleModal.style.display = "none";
                }, 1000);
            }, 1000); // 1 seconde de simulation
        });

        // Fonction pour charger et insérer le contenu du header et footer
        async function loadComponent(url, placeholderId, errorMessage) {
            try {
                const res = await fetch(url);
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                document.getElementById(placeholderId).innerHTML = await res.text();
            } catch (error) {
                    console.error(`Erreur lors du chargement de ${url}:`, error);
                    document.getElementById(placeholderId).innerHTML = `<p style='color:red;text-align:center;'>${errorMessage}: ${error.message}</p>`;
            }
        };

        // Fonction pour mettre à jour la bulle de notification (désormais inactive sans le PROXY_URL)
        async function mettreAJourBulleDemandes() {
            // Cette fonction est maintenue mais sera inactive sans un PROXY_URL défini et fonctionnel.
            // La bulle de notification pour les "Demandes IA" ne se mettra pas à jour dynamiquement.
            const notif = document.getElementById('notification-badge'); 
            if (notif) {
                // Vous pouvez définir un nombre fixe ou masquer si vous n'avez plus de backend.
                notif.style.display = 'none'; // Masquer la bulle car il n'y a plus de backend direct pour les demandes
                console.warn("La bulle de notification des demandes IA n'est pas mise à jour, le backend n'est plus utilisé pour cette page.");
            }
        }

        // --- Logique d'affichage de la bulle d'information initiale ---
        // Affiche toujours la bulle quand la page est chargée
        infoBubbleCloseBtn.addEventListener('click', () => {
            infoBubbleOverlay.classList.remove('visible');
        });

        // Fermer la bulle si l'utilisateur clique en dehors d'elle
        infoBubbleOverlay.addEventListener('click', (event) => {
            if (event.target === infoBubbleOverlay) {
                infoBubbleOverlay.classList.remove('visible');
            }
        });
        // --- Fin de la logique de la bulle d'information initiale ---


        // Au chargement de la page
        window.addEventListener("load", async () => {
            // Charger le header et le footer en parallèle
            await Promise.all([
                loadComponent("header.html", "header-placeholder", "Erreur de chargement du menu"),
                loadComponent("footer.html", "footer-placeholder", "Erreur de chargement du pied de page")
            ]);

            // Afficher les articles initialement définis dans le code
            renderArticles(articles); 
            
            // Appeler la fonction de mise à jour de la bulle (elle gérera l'absence de PROXY_URL)
            mettreAJourBulleDemandes(); 

            // Rendre le corps visible après le chargement initial et l'apparition de la modale
            document.body.classList.add("show");
            if (mainElement) {
                mainElement.classList.add("show");
            }
            // Afficher la bulle d'information après que le contenu principal soit visible
            infoBubbleOverlay.classList.add('visible');
        });
    </script>
</body>
</html>
