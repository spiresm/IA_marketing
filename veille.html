<script>
  const apiKey = 'd7a09af0695b961ca491657b7291e461';
  const query = 'intelligence artificielle';
  const countries = ['fr', 'be', 'ch', 'ca'];
  let articles = [];

  function renderArticles() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const tool = document.getElementById('toolFilter').value.toLowerCase();
    const container = document.getElementById('news-container');
    container.innerHTML = '';

    const filtered = articles.filter(article => {
      const content = `${article.title} ${article.description}`.toLowerCase();
      return (!searchTerm || content.includes(searchTerm)) &&
             (!tool || content.includes(tool));
    });

    if (filtered.length === 0) {
      container.innerHTML = '<p style="text-align:center">Aucune actualité correspondante.</p>';
      return;
    }

    filtered.forEach(article => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="date">${article.published_at ? article.published_at.split('T')[0] : 'Date inconnue'}</div>
        <h2>${article.title}</h2>
        <p class="meta">Source : ${article.source || 'N/A'}</p>
        <p>${article.description || ''}</p>
        <p><a href="${article.url}" target="_blank">Lire l'article complet</a></p>
      `;
      container.appendChild(card);
    });
  }

  // Récupérer les actualités de plusieurs pays
  Promise.all(
    countries.map(country =>
      fetch(`https://api.mediastack.com/v1/news?access_key=${apiKey}&languages=fr&countries=${country}&keywords=${encodeURIComponent(query)}&limit=15`)
        .then(res => res.json())
        .catch(err => ({ data: [] }))
    )
  )
  .then(results => {
    articles = results.flatMap(result => result.data || []);
    renderArticles();
  })
  .catch(error => {
    console.error('Erreur :', error);
    document.getElementById('news-container').innerHTML = '<p>Erreur de chargement des actualités.</p>';
  });

  document.getElementById('searchInput').addEventListener('input', renderArticles);
  document.getElementById('toolFilter').addEventListener('change', renderArticles);
</script>
