<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cas d'usages - iMarketing</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <link rel="preload" href="header.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="footer.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="log_ia.png" as="image">
    <link rel="preload" href="Section-Clients-Logo-RTBF.png" as="image">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Variables CSS pour faciliter la gestion des couleurs */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --light-blue: #64B5F6;
            --lighter-blue: #42A5F5;
            --background-grey: #f0f2f5;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #dc3545;
            --postit-yellow: #FFFAA0;
            --light-blue-card: #E0F2F7;
            --grey-text: #555;
            --border-color: #ddd;
        }

        /* Styles généraux */
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            background-color: var(--background-grey);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        body.show {
        }

        main {
            padding: 40px 20px;
            flex-grow: 1;
        }
        main.show {
        }

        /* --- Styles du Loader (si toujours utilisé) --- */
        /* Loader spécifique à la galerie des tips */
        #galerie .loader { /* Cible le loader à l'intérieur de la galerie */
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue); /* Utilise une variable du thème */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
            display: block; /* Visible par défaut quand HTML est injecté */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Conteneur des contrôles en haut (sera splité et réorganisé) */
        /* N'est plus utilisé comme un wrapper direct, mais ses styles sont réappliqués à de nouveaux wrappers */


        /* NOUVEAU: Section pour les logos des outils (Maintenant au-dessus des filtres) */
        .tool-logos-section {
            max-width: 960px; /* Largeur pour aligner avec la galerie de tips */
            margin: 20px auto; /* Marge au-dessus et en dessous */
            /* padding: 20px; */ /* Supprimé pour que les logos occupent toute la largeur */
            /* background: #fff; */ /* Supprimé */
            /* box-shadow: var(--card-shadow); */ /* Supprimé */
            text-align: center;
            position: relative; /* Pour positionner les flèches */
            display: flex; /* Utilise flexbox pour aligner les flèches et le contenu */
            align-items: center; /* Centre verticalement les éléments */
            justify-content: center; /* Centre le contenu horizontalement */
        }
        .tool-logos-section h2 { /* Ce titre est maintenant retiré du HTML */
            color: var(--primary-blue);
            margin-bottom: 20px;
            width: 100%; /* Pour que le titre prenne toute la largeur */
        }
        
        /* Conteneur pour le défilement des logos */
        .scrollable-tools-container {
            flex-grow: 1; 
            overflow: hidden; 
            position: relative;
            /* padding: 0 10px; */ /* Supprimé pour éviter les demi-logos */
        }

        .tools-grid {
            display: flex; 
            flex-wrap: nowrap; 
            gap: 15px; 
            margin-top: 20px;
            justify-content: flex-start; 
            transition: transform 0.3s ease-in-out; 
        }
        .tool-card {
            flex-shrink: 0; 
            width: 100px; 
            background-color: #f9f9f9; 
            padding: 10px; 
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.2s ease, box-shadow 0.2s ease; 
            cursor: pointer; 
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            text-align: center;
            min-height: 100px; 
        }
        .tool-card:hover {
            transform: translateY(-3px); 
            box-shadow: 0 5px 10px rgba(0,0,0,0.1); 
        }
        .tool-card img {
            max-width: 50px; 
            height: auto;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .tool-card .tool-name {
            font-weight: bold;
            color: var(--dark-blue);
            font-size: 0.8em; 
        }
        /* Dark mode adjustments for tool cards in cas-usages */
        body.dark-mode .tool-logos-section,
        body.dark-mode .tool-card {
            background-color: var(--dark-mode-card-bg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode .tool-logos-section h2 {
            color: var(--dark-mode-text);
        }
        body.dark-mode .tool-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        body.dark-mode .tool-card .tool-name {
            color: var(--dark-mode-text);
        }

        /* Styles pour les flèches de navigation */
        .scroll-arrow {
            background: rgba(0, 119, 182, 0.8); 
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s ease, opacity 0.3s ease;
        }
        .scroll-arrow:hover {
            background: var(--dark-blue);
        }
        .scroll-arrow.left {
            left: 5px; 
        }
        .scroll-arrow.right {
            right: 5px; 
        }
        .scroll-arrow.hidden {
            opacity: 0;
            pointer-events: none; 
        }


        /* NOUVEAU: Conteneur pour les filtres uniquement */
        .filters-area-container {
            max-width: 960px; 
            margin: 15px auto 25px auto; 
            padding: 0 20px;
            box-sizing: border-box;
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            flex-wrap: wrap; 
        }

        /* NOUVEAU: Conteneur pour le bouton "Créer un Tip" (maintenant en haut) */
        .create-tip-button-container { 
            max-width: 960px; 
            margin: 0px auto 30px auto; 
            padding: 0 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: center; 
            flex-wrap: wrap; 
        }


        /* Conteneur principal de la galerie (la "box" blanche) */
        .galerie-container {
            max-width: 960px; 
            margin: 0px auto; 
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }

        /* Conteneur des filtres (la flexbox interne) */
        #filters { 
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            flex-grow: 1;
            min-width: 0;
        }
        
        #filters select,
        #filters input[type="text"] {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9em;
            flex: 1; 
            min-width: 120px;
            box-sizing: border-box; 
        }
        #preview-text {
            min-width: 180px;
            max-width: 250px;
        }

        /* Styles pour les boutons d'action et "Créer un Tip" */
        .action-buttons { 
            display: flex; 
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end; 
            align-items: center;
        }
        
        .action-buttons a, .create-tip-button { 
            background: var(--primary-blue);
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .create-tip-button { 
            padding: 12px 25px;
            font-size: 1.1em;
            display: flex; 
            align-items: center;
            gap: 8px; 
        }

        .action-buttons a:hover, .create-tip-button:hover { 
            background: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Galerie en colonne */
        #galerie {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px 0;
            position: relative;
            z-index: 1;
        }

        /* Styles pour chaque carte de tip */
        .carte {
            background: #fff;
            border-left: 5px solid transparent; 
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            display: flex; 
            align-items: flex-start; 
            padding: 0;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-left-color 0.2s ease;
            box-sizing: border-box;
            width: 100%;
            z-index: 1;
        }
        .carte:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        /* Conteneur pour toutes les informations textuelles sur la carte */
        .infos-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-width: 0;
            padding: 15px;
            width: 100%;
            position: relative; 
        }

        .tip-title {
            font-size: 1.3em;
            color: var(--dark-blue);
            font-weight: 600; /* Ajusté de bold à 600 */
            margin-bottom: 8px;
        }

        .outil-badge {
            background-color: #e0f2f7;
            color: var(--primary-blue);
            font-size: 0.85em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            white-space: nowrap;
            text-transform: uppercase;
            align-self: flex-start;
        }

        /* Section des métadonnées (Auteur, Catégorie) */
        .metadata-section {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2px 10px;
            font-size: 0.9em;
            color: var(--grey-text);
            margin-bottom: 4px;
            padding-bottom: 2px;
            border-bottom: 1px solid #eee;
        }
        .metadata-label {
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        /* Style pour le nom de l'auteur cliquable */
        .metadata-value.auteur-value a {
            color: var(--primary-blue); 
            text-decoration: none;
            font-weight: bold; 
        }
        .metadata-value.auteur-value a:hover {
            text-decoration: underline;
        }
        .metadata-value {
            color: #666;
            word-break: break-word;
        }

        /* Le texte de prévisualisation sur la carte (post-it) */
        .preview-post-it {
            position: absolute;
            top: 60px; 
            right: 15px;
            background-color: var(--postit-yellow);
            color: #333;
            font-weight: 600; /* Ajusté de bold à 600 */
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 1em;
            z-index: 2;
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 150px;
            transform: rotate(2deg);
        }

        /* Boutons d'action sur la carte */
        .card-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 15px;
            padding-top: 5px;
            width: 100%;
        }

        .top-buttons-group {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Les icônes de vignettes en ligne */
        .card-preview-icons-inline {
            display: flex; 
            gap: 5px; 
            margin-left: 10px; 
        }
        .icon-vignette {
            color: #888; 
            font-size: 1.2em;
        }
        .icon-vignette[title="Contient une image"] {
            color: #4CAF50; 
        }
        /* Style pour l'icône PDF dans les vignettes de carte */
        .icon-vignette.pdf-thumbnail {
            width: 24px; 
            height: 24px;
            object-fit: contain; 
            vertical-align: middle; 
            border: 1px solid #ddd;
            border-radius: 3px;
        }


        /* Styles spécifiques pour le bouton "Copier le prompt" */
        .copier-btn {
            background-color: var(--light-blue);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .copier-btn:hover {
            background-color: var(--lighter-blue);
            transform: translateY(-1px);
        }

        .toggle-content-btn, .edit-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .toggle-content-btn:hover, .edit-btn:hover {
            background: var(--dark-blue);
            transform: translateY(-1px);
        }

        /* Styles pour le bouton supprimer (corbeille) */
        .supprimer-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 1.3em;
            cursor: pointer;
            transition: color 0.2s, transform 0.1s;
            padding: 0 5px;
            align-self: flex-start;
            margin-left: auto; /* Pousser la poubelle à droite */
        }

        .supprimer-btn:hover {
            color: var(--error-text);
            transform: translateY(-1px);
        }

        #success-message {
            background-color: var(--success-bg);
            color: var(--success-text);
            border: 1px solid #c3e6cb;
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Message d'erreur */
        .error-message {
            text-align: center;
            color: var(--error-text);
            margin-top: 20px;
            padding: 15px;
            background-color: var(--error-bg);
            border: 1px solid #f5c6cb;
            border-radius: 8px;
        }

        /* Styles for the new right-side preview panel */
        .preview-panel {
            position: fixed;
            top: 0;
            right: -760px; /* Masqué par défaut */
            width: 740px;
            max-width: 90%;
            height: 100%;
            background-color: #fff;
            box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .preview-panel.open {
            right: 0;
        }

        /* Overlay pour la fermeture au clic dans le vide */
        .preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* Assombrir l'arrière-plan */
            z-index: 999;
            display: none; /* Caché par défaut */
        }
        .preview-overlay.active {
            display: block;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8em;
            color: #888;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1001;
        }
        .close-btn:hover {
            color: #333;
        }

        .panel-content {
            flex-grow: 1;
            padding-top: 40px; /* Espace pour le bouton de fermeture */
        }

        .panel-content h3 {
            color: var(--primary-blue);
            font-size: 1.5em;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light-blue);
            padding-bottom: 10px;
        }

        .panel-content p {
            color: #444;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .panel-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .panel-content .prompt-code {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-break: break-word;
            margin-top: 20px;
            position: relative;
        }
        .panel-content .prompt-code code {
            display: block;
        }

        .panel-content .copy-prompt-panel-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s;
            margin-top: 10px;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .panel-content .copy-prompt-panel-btn:hover {
            background-color: var(--dark-blue);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            main {
                padding: 20px 10px;
            }

            .filters-area-container, .create-tip-button-container, .galerie-container, .tool-logos-section {
                padding: 0 10px;
            }

            #filters select,
            #filters input[type="text"] {
                flex: 1 1 100%; /* Full width on small screens */
                min-width: unset;
            }

            .carte {
                flex-direction: column; /* Stack elements vertically */
                align-items: stretch;
            }

            .preview-post-it {
                position: static; /* Retire la position absolue */
                margin-top: 15px;
                transform: none; /* Retire la rotation */
                max-width: 100%;
                order: 1; /* Place le post-it après le contenu principal */
            }
            .infos-wrapper {
                order: 0; /* Place les infos avant le post-it */
            }

            .card-actions {
                flex-direction: column;
                align-items: center;
            }
            .top-buttons-group {
                flex-direction: column;
                width: 100%;
                gap: 8px;
            }
            .copier-btn, .toggle-content-btn, .edit-btn {
                width: 100%;
                text-align: center;
            }
            .supprimer-btn {
                margin-left: 0;
                align-self: flex-end;
            }

            .create-tip-button-container {
                margin-top: 15px;
                margin-bottom: 20px;
                flex-direction: column; /* Force les boutons à s'empiler */
            }
            .create-tip-button { /* Ajuste la largeur des boutons */
                width: 100%;
                justify-content: center; /* Centre le texte et l'icône */
            }
            .preview-post-it {
                position: static;
                margin-top: 10px;
                max-width: unset;
                text-align: center;
                transform: none;
                font-size: 1.1em;
            }
            /* Ajustements pour le carré PDF sur mobile */
            .preview-panel-pdf-square {
                width: 100px;
                height: 100px;
                font-size: 0.9em;
            }
            .preview-panel-pdf-square img {
                max-width: 60px;
                max-height: 60px;
            }
            .preview-panel-pdf-square .file-name {
                font-size: 0.7em;
            }
            .download-button {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            /* Ajustements pour les logos sur mobile */
            .tool-logos-section {
                padding: 20px 10px; /* Moins de padding sur les côtés */
            }
            .scroll-arrow {
                width: 30px;
                height: 30px;
                font-size: 1.2em;
            }
            .scroll-arrow.left {
                left: 0px;
            }
            .scroll-arrow.right {
                right: 0px;
            }
            .tool-card {
                width: 80px; /* Réduire la largeur des cartes sur mobile */
            }
            .tool-card img {
                max-width: 40px;
            }
            .tool-card .tool-name {
                font-size: 0.7em;
            }
        }

        /* Styles pour le footer */
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            width: 100%;
        }

        footer p {
            margin: 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div class="create-tip-button-container">
            <a href="creer-tip.html" class="create-tip-button">
                <i class="fas fa-plus-circle"></i> Créer un nouveau Tip
            </a>
        </div>

        <div class="tool-logos-section">
            <button class="scroll-arrow left" id="scroll-left-arrow" aria-label="Défiler vers la gauche"><i class="fas fa-chevron-left"></i></button>
            <div id="scrollable-tools-container" class="scrollable-tools-container">
                <div id="tool-logos-grid" class="tools-grid">
                    </div>
            </div>
            <button class="scroll-arrow right" id="scroll-right-arrow" aria-label="Défiler vers la droite"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div class="filters-area-container">
            <div id="filters">
                <input type="text" id="preview-text" placeholder="Rechercher dans le texte de prévisualisation..." />
                <select id="filtre-categorie">
                    <option value="">Toutes les catégories</option>
                    <option value="Marketing Digital">Marketing Digital</option>
                    <option value="Création de Contenu">Création de Contenu</option>
                    <option value="Analyse de Données">Analyse de Données</option>
                    <option value="Automatisation">Automatisation</option>
                    <option value="Stratégie">Stratégie</option>
                    <option value="Productivité">Productivité</option>
                </select>
                <select id="filtre-tri-date">
                    <option value="recent" selected>Plus récent</option>
                    <option value="ancien">Plus ancien</option>
                </select>
                <select id="filtre-outil">
                    <option value="">Tous les outils</option> 
                </select>
            </div>
        </div>
        
        <div class="galerie-container">
            <div id="success-message"></div>
            <div id="error-display" class="error-message" style="display: none;"></div>
            <div id="galerie">
                <p style="text-align: center;">Chargement des tips...</p>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <div id="previewOverlay" class="preview-overlay"></div>

    <div id="previewPanel" class="preview-panel">
        <button class="close-btn" id="close-preview-panel"><i class="fas fa-times"></i></button>
        <div class="panel-content">
            <h3 id="panel-title"></h3>
            <p id="panel-category" class="outil-badge"></p>
            <div class="metadata-section">
                <span class="metadata-label">Auteur :</span> <span id="panel-author" class="metadata-value auteur-value"></span>
            </div>
            <p id="panel-description"></p>
            <p id="panel-usage"></p>
            <div class="panel-content-area">
                
            </div>
            <div class="prompt-code" style="display:none;">
                <h4>Prompt :</h4>
                <code id="panel-prompt"></code>
                <button class="copy-prompt-panel-btn" id="copy-prompt-panel-btn">Copier le prompt</button>
            </div>
        </div>
    </div>
    <div class="preview-overlay" id="preview-overlay"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>
    <script>
        // Utilisation de jQuery pour le chargement du header/footer et les gestionnaires d'événements
        $(function() {
            // Ces appels jQuery sont correct. Ils chargent header/footer.
            $("#header-placeholder").load("header.html", function() {
                // Logique du mode sombre pour le header après son chargement
                if (localStorage.getItem('darkMode') === 'enabled') {
                    $('body').addClass('dark-mode');
                }
                $('.dark-mode-toggle').on('click', function() {
                    $('body').toggleClass('dark-mode');
                    if ($('body').hasClass('dark-mode')) {
                        localStorage.setItem('darkMode', 'enabled');
                    } else {
                        localStorage.setItem('darkMode', 'disabled');
                    }
                });
            });
            $("#footer-placeholder").load("footer.html");
        });

        // --- TOUTES LES DÉCLARATIONS ET FONCTIONS LOCALES À cas-usages.html SONT ICI ---
        // Elles sont encapsulées dans le bloc DOMContentLoaded pour éviter les conflits globaux.

        document.addEventListener("DOMContentLoaded", async () => {
            console.log("cas-usages: DOMContentLoaded, début de l'initialisation...");

            // Déclarations de variables DOM et d'état (maintenant locales au DOMContentLoaded)
            const apiBase = window.location.origin + '/.netlify/functions/';
            let allTips = []; 
            const galerieDiv = document.getElementById('galerie');
            const errorDisplay = document.getElementById('error-display');
            const filtreCategorieSelect = document.getElementById('filtre-categorie');
            const filtreOutilSelect = document.getElementById('filtre-outil'); 
            const filtreTriDateSelect = document.getElementById('filtre-tri-date');
            const previewTextInput = document.getElementById('preview-text');

            const previewPanel = document.getElementById('previewPanel');
            const previewPanelTitle = document.getElementById('previewPanelTitle'); // Corrigé : était 'panel-title'
            const previewPanelCategory = document.getElementById('panel-category');
            const previewPanelAuthor = document.getElementById('panel-author');
            const previewPanelDescription = document.getElementById('panel-description');
            const previewPanelUsage = document.getElementById('panel-usage'); 
            const previewPanelContentArea = document.querySelector('#previewPanel .panel-content-area'); 
            const previewPanelPrompt = document.getElementById('panel-prompt');
            const copyPromptPanelBtn = document.getElementById('copy-prompt-panel-btn');
            const closePreviewPanelBtn = document.getElementById('close-preview-panel');
            const previewOverlay = document.getElementById('preview-overlay');
            
            // Éléments pour le défilement des logos
            const toolLogosGrid = document.getElementById('tool-logos-grid');
            const scrollableToolsContainer = document.getElementById('scrollable-tools-container');
            const scrollLeftArrow = document.getElementById('scroll-left-arrow');
            const scrollRightArrow = document.getElementById('scroll-right-arrow');

            let currentToolScrollIndex = 0; 
            const maxVisibleLogos = 10; 

            // --- Données des logos des outils (locales à ce script) ---
            const toolsData = [
                { name: "Premiere Pro", img: "logo_premiere.png" },
                { name: "n8n", img: "logo_n8n.png" },
                { name: "Runway ML", img: "logo_runwayML.png" }, 
                { name: "Midjourney", img: "logo_midjourney.png" },
                { name: "Stable Diffusion", img: "logo_stable_diff.png" },
                { name: "ChatGPT", img: "logo_chatgpt.png" },
                { name: "DALL-E 3", img: "logo_dall_E.png" }, 
                { name: "Claude", img: "logo_claude.png" },
                { name: "Firefly", img: "logo_firefly.png" }, 
                { name: "Photoshop", img: "logo_photoshop.png" }, 
                { name: "ElevenLabs", img: "logo_elevenlabs.png" } 
            ];

            // --- Fonctions utilitaires (locales à ce script) ---
            function escapeHtml(text) {
                if (text === null || text === undefined) { return ''; }
                text = String(text);
                const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }

            function getYouTubeVideoId(url) {
                let videoId = null;
                const youtubeRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(youtubeRegex);
                if (match && match[1]) { videoId = match[1]; }
                return videoId;
            }

            // loadComponent est déjà définie globalement via script.js ou dans le jQuery $(function)
            // On ne la redéfinit pas ici si elle est déjà globale
            // Si elle n'est pas globale (ce qui était mon intention en la mettant dans ce bloc), elle doit être ici.
            // Vu le message d'erreur précédent, elle est déjà globale ou chargée par jQuery.

            function applyFiltersAndSort() {
                let filtered = [...allTips];

                const categorie = filtreCategorieSelect.value;
                if (categorie) { filtered = filtered.filter(tip => tip.categorie === categorie); }

                const outil = filtreOutilSelect.value; 
                if (outil) {
                    const normalizedOutilFilter = outil.toLowerCase().replace(/[^a-z0-9]/g, ''); 
                    filtered = filtered.filter(tip => {
                        const normalizedTipOutil = String(tip.outil).toLowerCase().replace(/[^a-z0-9]/g, '');
                        return normalizedTipOutil.includes(normalizedOutilFilter) || normalizedOutilFilter.includes(normalizedTipOutil);
                    });
                }

                const searchText = previewTextInput.value.toLowerCase();
                if (searchText) {
                    filtered = filtered.filter(tip => 
                        (tip.title && String(tip.title).toLowerCase().includes(searchText)) ||
                        (tip.description && String(tip.description).toLowerCase().includes(searchText)) ||
                        (tip.promptText && String(tip.promptText).toLowerCase().includes(searchText)) ||
                        (tip.prompt && String(tip.prompt).toLowerCase().includes(searchText)) ||
                        (tip.auteur && String(tip.auteur).toLowerCase().includes(searchText)) ||
                        (tip.categorie && String(tip.categorie).toLowerCase().includes(searchText)) ||
                        (tip.outil && String(tip.outil).toLowerCase().includes(searchText))
                    );
                }

                const sortOrder = filtreTriDateSelect.value;
                
                filtered.sort((a, b) => {
                    if (sortOrder === 'recent') {
                        const dateA = new Date(a.dateCreation || a.date);
                        const dateB = new Date(b.dateCreation || b.date);
                        return dateB.getTime() - dateA.getTime();
                    } else if (sortOrder === 'ancien') {
                        const dateA = new Date(a.dateCreation || a.date);
                        const dateB = new Date(b.dateCreation || b.date);
                        return dateA.getTime() - dateB.getTime();
                    }
                    return 0;
                });
                
                displayTips(filtered);
            }

            function setupFilters() {
                filtreCategorieSelect.addEventListener('change', applyFiltersAndSort);
                previewTextInput.addEventListener('input', applyFiltersAndSort);
                filtreTriDateSelect.addEventListener('change', applyFiltersAndSort);
                
                filtreOutilSelect.addEventListener('change', () => { applyFiltersAndSort(); });

                populateOutilFilter(); 
            }
            
            function populateOutilFilter() {
                filtreOutilSelect.innerHTML = '<option value="">Tous les outils</option>'; 

                const uniqueTools = [...new Set(toolsData.map(tool => tool.name))].sort();

                uniqueTools.forEach(toolName => {
                    const option = document.createElement('option');
                    option.value = toolName;
                    option.textContent = toolName;
                    filtreOutilSelect.appendChild(option);
                });
            }

            async function loadAndDisplayTips() {
                galerieDiv.innerHTML = '<div class="loader"></div><p style="text-align: center;">Chargement des tips...</p>';
                try {
                    const response = await fetch(`${apiBase}get-tips`);
                    if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
                    let fetchedTips = await response.json();
                    
                    allTips = fetchedTips.map(tip => {
                        let tipUrls = [];
                        if (Array.isArray(tip.urls)) { tipUrls = tip.urls; } 
                        else if (typeof tip.urls === 'string' && tip.urls.startsWith('[')) {
                            try { const parsed = JSON.parse(tip.urls); if (Array.isArray(parsed)) { tipUrls = parsed; } else { console.warn("Parsed URLs string is not an array:", parsed); } } 
                            catch (e) { console.error("Erreur de parsing de la chaîne URLs:", e, tip.urls); }
                        } else if (tip.url) { tipUrls = [tip.url]; }
                        return {
                            ...tip,
                            dateCreation: tip.date_creation || tip.dateCreation || tip.date_ajout || tip.date || new Date().toISOString(),
                            titre: tip.titre && tip.titre.trim() !== '' ? tip.titre : "Titre non spécifié",
                            auteur: tip.auteur && tip.auteur.trim() !== '' ? tip.auteur : "Auteur inconnu",
                            description: tip.description || '',
                            outil: tip.outil && tip.outil.trim() !== '' ? tip.outil : "Non spécifié", 
                            categorie: tip.categorie && tip.categorie.trim() !== '' ? tip.categorie : "Autre", 
                            urls: tipUrls 
                        };
                    });
                    applyFiltersAndSort(); 
                } catch (error) {
                    console.error("Erreur lors du chargement des tips:", error);
                    errorDisplay.style.display = 'block';
                    errorDisplay.textContent = `Erreur de chargement des tips: ${error.message}`;
                    galerieDiv.innerHTML = ''; 
                } finally {
                    const localLoader = galerieDiv.querySelector('.loader');
                    if (localLoader) localLoader.style.display = 'none';
                    const loadingText = galerieDiv.querySelector('p[style="text-align: center;"]');
                    if (loadingText) loadingText.remove();
                }
            }

            function displayTips(tipsToDisplay) {
                galerieDiv.innerHTML = ''; 
                if (tipsToDisplay.length === 0) { galerieDiv.innerHTML = '<p style="text-align: center; color: #555;">Aucun tip ne correspond à vos filtres.</p>'; return; }
                tipsToDisplay.forEach(tip => {
                    const dateObj = new Date(tip.dateCreation);
                    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    const formattedDate = dateObj.toLocaleDateString('fr-FR', options);
                    const actualPromptContent = tip.promptText || tip.prompt;
                    const auteurLink = `<a href="equipe.html?auteur=${encodeURIComponent(tip.auteur)}" class="metadata-value auteur-value">${escapeHtml(tip.auteur)}</a>`;
                    const cardHtml = `
                        <div class="carte" style="border-left-color: ${getCategoryColor(tip.categorie)};">
                            <div class="infos-wrapper">
                                <h3 class="tip-title">${escapeHtml(tip.titre)}</h3>
                                <span class="outil-badge">${escapeHtml(tip.outil || 'Non spécifié')}</span>
                                <div class="metadata-section">
                                    <span class="metadata-label">Auteur:</span>
                                    <span class="metadata-value auteur-value">${auteurLink}</span>
                                    <span class="metadata-label">Catégorie:</span>
                                    <span class="metadata-value">${escapeHtml(tip.categorie)}</span>
                                    <span class="metadata-label">Date:</span>
                                    <span class="metadata-value">${formattedDate}</span>
                                </div>
                                ${tip.previewText ? `<div class="preview-post-it">${escapeHtml(tip.previewText)}</div>` : ''}
                                <div class="card-actions">
                                    <div class="top-buttons-group">
                                        <button class="toggle-content-btn" data-id="${tip.id}">Voir le Tip</button>
                                        ${actualPromptContent && actualPromptContent.trim() !== '' ? `<button class="copier-btn" data-copy="${escapeHtml(actualPromptContent)}">Copier le prompt</button>` : ''}
                                        <button class="edit-btn" data-id="${tip.id}">Éditer</button>
                                        <div class="card-preview-icons-inline">
                                            ${(tip.fileUrls && tip.fileUrls.length > 0) || tip.imageUrl ? `<i class="fas fa-image icon-vignette" title="Contient une image"></i>` : ''}
                                            ${tip.documentUrl && tip.documentUrl.trim() !== '' ? `<img src="PDF_file_icon.svg.webp" alt="Document PDF" class="icon-vignette pdf-thumbnail" title="Contient un document PDF">` : ''}
                                            ${(tip.urls && tip.urls.some(url => getYouTubeVideoId(url))) ? `<i class="fab fa-youtube icon-vignette" title="Contient une vidéo YouTube"></i>` : ''}
                                            ${(tip.urls && tip.urls.some(url => !getYouTubeVideoId(url) && url.trim() !== '')) ? `<i class="fas fa-link icon-vignette" title="Contient un lien externe"></i>` : ''}
                                        </div>
                                    </div>
                                    <button class="supprimer-btn" data-id="${tip.id}" title="Supprimer le tip"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                    galerieDiv.insertAdjacentHTML('beforeend', cardHtml);
                });
                attachEventListenersToCards();
            }

            function getCategoryColor(category) {
                switch (category) {
                    case 'Marketing Digital': return '#0077b6';
                    case 'Création de Contenu': return '#38a3a5';
                    case 'Analyse de Données': return '#ffc300';
                    case 'Automatisation': return '#c70039';
                    case 'Stratégie': return '#8ac926';
                    case 'Productivité': return '#9d4edd';
                    case 'Autre': return '#6c757d';
                    default: return '#cccccc';
                }
            }

            function attachEventListenersToCards() {
                document.querySelectorAll('.toggle-content-btn').forEach(button => { button.onclick = (e) => openPreviewPanel(e.target.dataset.id); });
                document.querySelectorAll('.copier-btn').forEach(button => { button.onclick = (e) => copyToClipboard(e.target.dataset.copy, e.target); });
                document.querySelectorAll('.edit-btn').forEach(button => { button.onclick = (e) => redirectToEditPage(e.target.dataset.id); });
                document.querySelectorAll('.supprimer-btn').forEach(button => { button.onclick = (e) => confirmAndDeleteTip(e.target.dataset.id || e.target.closest('button').dataset.id); });
            }

            async function openPreviewPanel(tipId) {
                console.log(`Tentative d'ouverture du panneau d'aperçu pour le tip ID: ${tipId}`);
                const tip = allTips.find(t => t.id === tipId);
                if (tip) {
                    console.log("Données du tip pour le panneau d'aperçu:", tip);
                    previewPanelTitle.textContent = escapeHtml(tip.titre || "Détail du Tip");
                    previewPanelCategory.textContent = escapeHtml(tip.categorie || 'Catégorie inconnue');
                    previewPanelAuthor.innerHTML = `<a href="equipe.html?auteur=${encodeURIComponent(tip.auteur)}" class="metadata-value auteur-value">${escapeHtml(tip.auteur)}</a>`;
                    previewPanelDescription.textContent = escapeHtml(tip.description || '');
                    previewPanelUsage.textContent = escapeHtml(tip.usage || ''); 
                    
                    let contentHtml = ''; // Définir localement pour cette fonction

                    // Ajouter Description section
                    if (tip.description && tip.description.trim() !== '') {
                        contentHtml += `<h4>Description:</h4><div class="content-card-blue">${escapeHtml(tip.description)}</div>`;
                    }
                    
                    // URLs (avec gestion spécifique YouTube)
                    if (tip.urls && tip.urls.length > 0) {
                        let hasContentToDisplay = false; let linksAndVideosHtml = '';
                        tip.urls.forEach((url) => {
                            const youtubeId = getYouTubeVideoId(url);
                            if (youtubeId) {
                                hasContentToDisplay = true; const embedUrl = `https://www.youtube-nocookie.com/embed/${youtubeId}?autoplay=0&rel=0`; 
                                linksAndVideosHtml += `<div class="video-responsive"><iframe src="${escapeHtml(embedUrl)}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="YouTube video player" onerror="console.error('Échec du chargement de l\\'intégration YouTube pour l\\'ID: ${youtubeId}. Vérifiez la disponibilité de la vidéo ou le réseau. URL tentée: ${embedUrl}');"></iframe></div>`;
                            } else if (url.trim() !== '') {
                                hasContentToDisplay = true; linksAndVideosHtml += `<p><a href="${escapeHtml(url)}" target="_blank" style="word-break: break-all;"><i class="fas fa-external-link-alt"></i> ${escapeHtml(url)}</a></p>`;
                            }
                        });
                        if (hasContentToDisplay) { contentHtml += `<h4>Liens/Vidéos associées:</h4>${linksAndVideosHtml}`; }
                    }
                    const panelPromptContent = tip.promptText || tip.prompt;
                    if (panelPromptContent) {
                        previewPanelPrompt.textContent = escapeHtml(panelPromptContent);
                        previewPanel.querySelector('.prompt-code').style.display = 'block'; 
                        copyPromptPanelBtn.onclick = () => { copyToClipboard(panelPromptContent, copyPromptPanelBtn); };
                    } else {
                        previewPanel.querySelector('.prompt-code').style.display = 'none'; 
                    }

                    if ((tip.fileUrls && Array.isArray(tip.fileUrls) && tip.fileUrls.length > 0) || tip.imageUrl) {
                        contentHtml += `<h4>Images associées:</h4><div class="preview-panel-image-container">`; let imageCounter = 1; const imageUrlsToDisplay = [];
                        if (tip.fileUrls && Array.isArray(tip.fileUrls)) { imageUrlsToDisplay.push(...tip.fileUrls); }
                        if (tip.imageUrl && !imageUrlsToDisplay.includes(tip.imageUrl)) { imageUrlsToDisplay.push(tip.imageUrl); }
                        imageUrlsToDisplay.forEach(url => { contentHtml += `<div class="preview-panel-image-wrapper"><div class="image-number-badge">${imageCounter++}</div><a href="${escapeHtml(url)}" target="_blank"><img src="${escapeHtml(url)}" alt="Image du tip" class="preview-panel-image" /></a></div>`; });
                        contentHtml += `</div>`;
                    }
                    if (tip.documentUrl && tip.documentUrl.trim() !== '') { contentHtml += `<h4>Document associé:</h4><div class="preview-panel-document-square-container"><a href="${escapeHtml(tip.documentUrl)}" target="_blank" class="preview-panel-pdf-square"><img src="PDF_file_icon.svg.webp" alt="Icône PDF"><span class="file-name">${escapeHtml(tip.documentFileName || 'Document PDF')}</span><span class="download-button">Télécharger</span></a></div>`; }
                    if (tip.previewText) { contentHtml += `<h4>Post-it:</h4><div class="preview-text-card-yellow">${escapeHtml(tip.previewText)}</div>`; }
                    
                    const dateObj = new Date(tip.dateCreation); const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }; const formattedDate = dateObj.toLocaleDateString('fr-FR', options);
                    const auteurPanelLink = `<a href="equipe.html?auteur=${encodeURIComponent(tip.auteur)}" class="metadata-value auteur-value">${escapeHtml(tip.auteur)}</a>`;

                    contentHtml += `<div class="metadata-section" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;"><span class="metadata-label">Auteur:</span><span class="metadata-value auteur-value">${auteurPanelLink}</span><span class="metadata-label">Catégorie:</span><span class="metadata-value">${escapeHtml(tip.categorie)}</span><span class="metadata-label">Outil:</span><span class="metadata-value">${escapeHtml(tip.outil || 'Non spécifié')}</span><span class="metadata-label">Date de création:</span><span class="metadata-value">${formattedDate}</span></div>`;
                    
                    // Assignation du contenu HTML au panneau d'aperçu
                    previewPanelContent.innerHTML = contentHtml; // Correction ici, était previewPanelContentArea

                    previewPanel.classList.add('open'); 
                    previewOverlay.classList.add('active'); 
                    bodyElement.style.overflow = 'hidden';
                } else { console.error("Tip non trouvé pour l'ID:", tipId); }
            }

            function closePreviewPanel() {
                previewPanel.classList.remove('open');
                previewOverlay.classList.remove('active');
                bodyElement.style.overflow = '';
            }

            closePreviewBtn.addEventListener('click', closePreviewPanel);
            previewOverlay.addEventListener('click', closePreviewPanel);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && previewPanel.classList.contains('open')) { closePreviewPanel(); } });

            async function copyToClipboard(text, buttonElement) {
                try {
                    if (navigator.clipboard && navigator.clipboard.writeText) { await navigator.clipboard.writeText(text); } 
                    else { const textarea = document.createElement('textarea'); textarea.value = text; textarea.style.position = 'fixed'; textarea.style.opacity = '0'; document.body.appendChild(textarea); textarea.focus(); textarea.select(); document.execCommand('copy'); document.body.removeChild(textarea); }
                    const originalText = buttonElement.textContent; buttonElement.textContent = 'Copié !';
                    setTimeout(() => { buttonElement.textContent = originalText; }, 1500);
                } catch (err) { console.error('Échec de la copie: ', err); alert('La copie automatOkay, je comprends. Vous voulez que je prenne le code que vous considérez comme l'"ancien code qui fonctionnait" (malgré les problèmes de design et de compatibilité que nous avions rencontrés), et que je le "répare" pour qu'il affiche les logos et les tips, en intégrant toutes les fonctionnalités que nous avons développées depuis.

Votre message "il affiche ni les logo ni les tip" est le problème principal. Les logs que vous avez fournis précédemment pour `get-tips` montrent clairement que la **fonction Netlify `get-tips` fonctionne PARFAITEMENT et renvoie bien 9 tips valides**. C'est une excellente nouvelle, car la donnée est bien là où elle doit être.

Le problème est que le **JavaScript côté client n'arrive pas à générer ou à afficher ces données**. Les erreurs que vous avez vues précédemment (comme `SyntaxError` et `ReferenceError`) indiquent que votre JavaScript s'arrête prématurément, ou que la logique d'affichage est défaillante.

Je vais reprendre le code que vous avez fourni en dernier (le code HTML avec le script intégré), en m'appuyant sur cette structure, et je vais y réintégrer toutes les fonctionnalités et corrections validées précédemment, en étant très attentif aux problèmes de portée et d'initialisation.

---

### **Fichier HTML : `cas-usages.html` (Code Complet - Réintégration et Correction)**

Cette version devrait résoudre les problèmes d'affichage des logos et des tips, et intégrer toutes les fonctionnalités souhaitées. J'ai :

1.  **Réorganisé l'ordre des éléments JavaScript** dans le `<script>` pour m'assurer que tout est défini avant d'être utilisé.
2.  **Remplacé les URLs des préloads** par des versions sans crochets `[]` qui pouvaient causer des problèmes de parsing.
3.  **Remis le `<h2>` pour "Outils IA Populaires"** car il était dans votre code d'origine que vous avez dit "fonctionnait".
4.  **Assuré que toutes les variables DOM sont bien sélectionnées et accessibles.**
5.  **Corrigé les problèmes d'affichage dans la `openPreviewPanel`** pour s'assurer que le contenu du panneau est bien assigné.
6.  **Intégré la logique de défilement des logos** et leur filtrage.
7.  **Harmonisé les noms des outils** pour le filtrage (`DALL-E` au lieu de `DALL-E 3`, `Adobe Firefly` au lieu de `Firefly`, etc.).
8.  **Ajusté la graisse de police** dans les cartes.
9.  **Vérifié l'existence de `mettreAJourBulleDemandes`** avant de l'appeler pour éviter l'erreur si elle n'est pas définie globalement dans `script.js`.

```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cas d'usages - iMarketing</title>
    
    <link rel="preconnect" href="[https://fonts.googleapis.com](https://fonts.googleapis.com)">
    <link rel="preconnect" href="[https://fonts.gstatic.com](https://fonts.gstatic.com)" crossorigin>
    <link rel="preconnect" href="[https://cdnjs.cloudflare.com](https://cdnjs.cloudflare.com)">

    <link rel="preload" href="header.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="footer.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="log_ia.png" as="image">
    <link rel="preload" href="Section-Clients-Logo-RTBF.png" as="image">
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css)">
    <link rel="stylesheet" href="style.css">
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap)" rel="stylesheet">

    <style>
        /* Variables CSS pour faciliter la gestion des couleurs */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --light-blue: #64B5F6;
            --lighter-blue: #42A5F5;
            --background-grey: #f0f2f5;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            --card-hover-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #dc3545;
            --postit-yellow: #FFFAA0;
            --light-blue-card: #E0F2F7;
            --grey-text: #555;
            --border-color: #ddd;
        }

        /* Styles généraux */
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            background-color: var(--background-grey);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        body.show {
        }

        main {
            padding: 40px 20px;
            flex-grow: 1;
        }
        main.show {
        }

        /* --- Styles du Loader (si toujours utilisé) --- */
        /* Loader spécifique à la galerie des tips */
        #galerie .loader { /* Cible le loader à l'intérieur de la galerie */
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue); /* Utilise une variable du thème */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
            display: block; /* Visible par défaut quand HTML est injecté */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Conteneur des contrôles en haut (sera splité et réorganisé) */
        /* N'est plus utilisé comme un wrapper direct, mais ses styles sont réappliqués à de nouveaux wrappers */


        /* NOUVEAU: Section pour les logos des outils (Maintenant au-dessus des filtres) */
        .tool-logos-section {
            max-width: 960px; /* Largeur pour aligner avec la galerie de tips */
            margin: 20px auto; /* Marge au-dessus et en dessous */
            /* padding: 20px; */ /* Supprimé pour que les logos occupent toute la largeur */
            /* background: #fff; */ /* Supprimé */
            /* box-shadow: var(--card-shadow); */ /* Supprimé */
            text-align: center;
            position: relative; /* Pour positionner les flèches */
            display: flex; /* Utilise flexbox pour aligner les flèches et le contenu */
            align-items: center; /* Centre verticalement les éléments */
            justify-content: center; /* Centre le contenu horizontalement */
        }
        .tool-logos-section h2 { /* Ce titre est maintenant inclus dans le HTML comme demandé */
            color: var(--primary-blue);
            margin-bottom: 20px;
            width: 100%; /* Pour que le titre prenne toute la largeur */
        }
        
        /* Conteneur pour le défilement des logos */
        .scrollable-tools-container {
            flex-grow: 1; 
            overflow: hidden; 
            position: relative;
            /* padding: 0 10px; */ /* Supprimé pour éviter les demi-logos */
        }

        .tools-grid {
            display: flex; 
            flex-wrap: nowrap; 
            gap: 15px; 
            margin-top: 20px;
            justify-content: flex-start; 
            transition: transform 0.3s ease-in-out; 
        }
        .tool-card {
            flex-shrink: 0; 
            width: 100px; 
            background-color: #f9f9f9; 
            padding: 10px; 
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.2s ease, box-shadow 0.2s ease; 
            cursor: pointer; 
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            text-align: center;
            min-height: 100px; 
        }
        .tool-card:hover {
            transform: translateY(-3px); 
            box-shadow: 0 5px 10px rgba(0,0,0,0.1); 
        }
        .tool-card img {
            max-width: 50px; 
            height: auto;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .tool-card .tool-name {
            font-weight: bold;
            color: var(--dark-blue);
            font-size: 0.8em; 
        }
        /* Dark mode adjustments for tool cards in cas-usages */
        body.dark-mode .tool-logos-section,
        body.dark-mode .tool-card {
            background-color: var(--dark-mode-card-bg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode .tool-logos-section h2 {
            color: var(--dark-mode-text);
        }
        body.dark-mode .tool-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
        }
        body.dark-mode .tool-card .tool-name {
            color: var(--dark-mode-text);
        }

        /* Styles pour les flèches de navigation */
        .scroll-arrow {
            background: rgba(0, 119, 182, 0.8); 
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s ease, opacity 0.3s ease;
        }
        .scroll-arrow:hover {
            background: var(--dark-blue);
        }
        .scroll-arrow.left {
            left: 5px; 
        }
        .scroll-arrow.right {
            right: 5px; 
        }
        .scroll-arrow.hidden {
            opacity: 0;
            pointer-events: none; 
        }


        /* NOUVEAU: Conteneur pour les filtres uniquement */
        .filters-area-container {
            max-width: 960px; 
            margin: 15px auto 25px auto; 
            padding: 0 20px;
            box-sizing: border-box;
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            flex-wrap: wrap; 
        }

        /* NOUVEAU: Conteneur pour le bouton "Créer un Tip" (maintenant en haut) */
        .create-tip-button-container { 
            max-width: 960px; 
            margin: 0px auto 30px auto; 
            padding: 0 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: center; 
            flex-wrap: wrap; 
        }


        /* Conteneur principal de la galerie (la "box" blanche) */
        .galerie-container {
            max-width: 960px; 
            margin: 0px auto; 
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }

        /* Conteneur des filtres (la flexbox interne) */
        #filters { 
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            flex-grow: 1;
            min-width: 0;
        }
        
        #filters select,
        #filters input[type="text"] {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9em;
            flex: 1; 
            min-width: 120px;
            box-sizing: border-box; 
        }
        #preview-text {
            min-width: 180px;
            max-width: 250px;
        }

        /* Styles pour les boutons d'action et "Créer un Tip" */
        .action-buttons { 
            display: flex; 
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end; 
            align-items: center;
        }
        
        .action-buttons a, .create-tip-button { 
            background: var(--primary-blue);
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .create-tip-button { 
            padding: 12px 25px;
            font-size: 1.1em;
            display: flex; 
            align-items: center;
            gap: 8px; 
        }

        .action-buttons a:hover, .create-tip-button:hover { 
            background: var(--dark-blue);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Galerie en colonne */
        #galerie {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px 0;
            position: relative;
            z-index: 1;
        }

        /* Styles pour chaque carte de tip */
        .carte {
            background: #fff;
            border-left: 5px solid transparent; 
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            display: flex; 
            align-items: flex-start; 
            padding: 0;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-left-color 0.2s ease;
            box-sizing: border-box;
            width: 100%;
            z-index: 1;
        }
        .carte:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        /* Conteneur pour toutes les informations textuelles sur la carte */
        .infos-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-width: 0;
            padding: 15px;
            width: 100%;
            position: relative; 
        }

        .tip-title {
            font-size: 1.3em;
            color: var(--dark-blue);
            font-weight: 600; /* Ajusté de bold à 600 */
            margin-bottom: 8px;
        }

        .outil-badge {
            background-color: #e0f2f7;
            color: var(--primary-blue);
            font-size: 0.85em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            white-space: nowrap;
            text-transform: uppercase;
            align-self: flex-start;
        }

        /* Section des métadonnées (Auteur, Catégorie) */
        .metadata-section {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2px 10px;
            font-size: 0.9em;
            color: var(--grey-text);
            margin-bottom: 4px;
            padding-bottom: 2px;
            border-bottom: 1px solid #eee;
        }
        .metadata-label {
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        /* Style pour le nom de l'auteur cliquable */
        .metadata-value.auteur-value a {
            color: var(--primary-blue); 
            text-decoration: none;
            font-weight: bold; 
        }
        .metadata-value.auteur-value a:hover {
            text-decoration: underline;
        }
        .metadata-value {
            color: #666;
            word-break: break-word;
        }

        /* Le texte de prévisualisation sur la carte (post-it) */
        .preview-post-it {
            position: absolute;
            top: 60px; 
            right: 15px;
            background-color: var(--postit-yellow);
            color: #333;
            font-weight: 600; /* Ajusté de bold à 600 */
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 1em;
            z-index: 2;
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 150px;
            transform: rotate(2deg);
        }

        /* Boutons d'action sur la carte */
        .card-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 15px;
            padding-top: 5px;
            width: 100%;
        }

        .top-buttons-group {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Les icônes de vignettes en ligne */
        .card-preview-icons-inline {
            display: flex; 
            gap: 5px; 
            margin-left: 10px; 
        }
        .icon-vignette {
            color: #888; 
            font-size: 1.2em;
        }
        .icon-vignette[title="Contient une image"] {
            color: #4CAF50; 
        }
        /* Style pour l'icône PDF dans les vignettes de carte */
        .icon-vignette.pdf-thumbnail {
            width: 24px; 
            height: 24px;
            object-fit: contain; 
            vertical-align: middle; 
            border: 1px solid #ddd;
            border-radius: 3px;
        }


        /* Styles spécifiques pour le bouton "Copier le prompt" */
        .copier-btn {
            background-color: var(--light-blue);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .copier-btn:hover {
            background-color: var(--lighter-blue);
            transform: translateY(-1px);
        }

        .toggle-content-btn, .edit-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .toggle-content-btn:hover, .edit-btn:hover {
            background: var(--dark-blue);
            transform: translateY(-1px);
        }

        /* Styles pour le bouton supprimer (corbeille) */
        .supprimer-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 1.3em;
            cursor: pointer;
            transition: color 0.2s, transform 0.1s;
            padding: 0 5px;
            align-self: flex-start;
            margin-left: auto; /* Pousser la poubelle à droite */
        }

        .supprimer-btn:hover {
            color: var(--error-text);
            transform: translateY(-1px);
        }

        #success-message {
            background-color: var(--success-bg);
            color: var(--success-text);
            border: 1px solid #c3e6cb;
            padding: 10px 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        /* Message d'erreur */
        .error-message {
            text-align: center;
            color: var(--error-text);
            margin-top: 20px;
            padding: 15px;
            background-color: var(--error-bg);
            border: 1px solid #f5c6cb;
            border-radius: 8px;
        }

        /* Styles for the new right-side preview panel */
        .preview-panel {
            position: fixed;
            top: 0;
            right: -760px; /* Masqué par défaut */
            width: 740px;
            max-width: 90%;
            height: 100%;
            background-color: #fff;
            box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .preview-panel.open {
            right: 0;
        }

        /* Overlay pour la fermeture au clic dans le vide */
        .preview-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4); /* Assombrir l'arrière-plan */
            z-index: 999;
            display: none; /* Caché par default */
        }
        .preview-overlay.active {
            display: block;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8em;
            color: #888;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1001;
        }
        .close-btn:hover {
            color: #333;
        }

        .panel-content {
            flex-grow: 1;
            padding-top: 40px; /* Espace pour le bouton de fermeture */
        }

        .panel-content h3 {
            color: var(--primary-blue);
            font-size: 1.5em;
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light-blue);
            padding-bottom: 10px;
        }

        .panel-content p {
            color: #444;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .panel-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .panel-content .prompt-code {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-break: break-word;
            margin-top: 20px;
            position: relative;
        }
        .panel-content .prompt-code code {
            display: block;
        }

        .panel-content .copy-prompt-panel-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s;
            margin-top: 10px;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .panel-content .copy-prompt-panel-btn:hover {
            background-color: var(--dark-blue);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            main {
                padding: 20px 10px;
            }

            .filters-area-container, .create-tip-button-container, .galerie-container, .tool-logos-section {
                padding: 0 10px;
            }

            #filters select,
            #filters input[type="text"] {
                flex: 1 1 100%; /* Full width on small screens */
                min-width: unset;
            }

            .carte {
                flex-direction: column; /* Stack elements vertically */
                align-items: stretch;
            }

            .preview-post-it {
                position: static; /* Retire la position absolue */
                margin-top: 15px;
                transform: none; /* Retire la rotation */
                max-width: 100%;
                order: 1; /* Place le post-it après le contenu principal */
            }
            .infos-wrapper {
                order: 0; /* Place les infos avant le post-it */
            }

            .card-actions {
                flex-direction: column;
                align-items: center;
            }
            .top-buttons-group {
                flex-direction: column;
                width: 100%;
                gap: 8px;
            }
            .copier-btn, .toggle-content-btn, .edit-btn {
                width: 100%;
                text-align: center;
            }
            .supprimer-btn {
                margin-left: 0;
                align-self: flex-end;
            }

            .create-tip-button-container {
                margin-top: 15px;
                margin-bottom: 20px;
                flex-direction: column; /* Force les boutons à s'empiler */
            }
            .create-tip-button { /* Ajuste la largeur des boutons */
                width: 100%;
                justify-content: center; /* Centre le texte et l'icône */
            }
            .preview-post-it {
                position: static;
                margin-top: 10px;
                max-width: unset;
                text-align: center;
                transform: none;
                font-size: 1.1em;
            }
            /* Ajustements pour le carré PDF sur mobile */
            .preview-panel-pdf-square {
                width: 100px;
                height: 100px;
                font-size: 0.9em;
            }
            .preview-panel-pdf-square img {
                max-width: 60px;
                max-height: 60px;
            }
            .preview-panel-pdf-square .file-name {
                font-size: 0.7em;
            }
            .download-button {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            /* Ajustements pour les logos sur mobile */
            .tool-logos-section {
                padding: 20px 10px; /* Moins de padding sur les côtés */
            }
            .scroll-arrow {
                width: 30px;
                height: 30px;
                font-size: 1.2em;
            }
            .scroll-arrow.left {
                left: 0px;
            }
            .scroll-arrow.right {
                right: 0px;
            }
            .tool-card {
                width: 80px; /* Réduire la largeur des cartes sur mobile */
            }
            .tool-card img {
                max-width: 40px;
            }
            .tool-card .tool-name {
                font-size: 0.7em;
            }
        }

        /* Styles pour le footer */
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            width: 100%;
        }

        footer p {
            margin: 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div class="create-tip-button-container">
            <a href="creer-tip.html" class="create-tip-button">
                <i class="fas fa-plus-circle"></i> Créer un nouveau Tip
            </a>
        </div>

        <div class="tool-logos-section">
            <button class="scroll-arrow left" id="scroll-left-arrow" aria-label="Défiler vers la gauche"><i class="fas fa-chevron-left"></i></button>
            <div id="scrollable-tools-container" class="scrollable-tools-container">
                <div id="tool-logos-grid" class="tools-grid">
                    </div>
            </div>
            <button class="scroll-arrow right" id="scroll-right-arrow" aria-label="Défiler vers la droite"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div class="filters-area-container">
            <div id="filters">
                <input type="text" id="preview-text" placeholder="Rechercher dans le texte de prévisualisation..." />
                <select id="filtre-categorie">
                    <option value="">Toutes les catégories</option>
                    <option value="Marketing Digital">Marketing Digital</option>
                    <option value="Création de Contenu">Création de Contenu</option>
                    <option value="Analyse de Données">Analyse de Données</option>
                    <option value="Automatisation">Automatisation</option>
                    <option value="Stratégie">Stratégie</option>
                    <option value="Productivité">Productivité</option>
                </select>
                <select id="filtre-tri-date">
                    <option value="recent" selected>Plus récent</option>
                    <option value="ancien">Plus ancien</option>
                </select>
                <select id="filtre-outil">
                    <option value="">Tous les outils</option> 
                </select>
            </div>
        </div>
        
        <div class="galerie-container">
            <div id="success-message"></div>
            <div id="error-display" class="error-message" style="display: none;"></div>
            <div id="galerie">
                <p style="text-align: center;">Chargement des tips...</p>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <div id="previewOverlay" class="preview-overlay"></div>

    <div id="previewPanel" class="preview-panel">
        <button class="close-btn" id="close-preview-panel"><i class="fas fa-times"></i></button>
        <div class="panel-content">
            <h3 id="panel-title"></h3>
            <p id="panel-category" class="outil-badge"></p>
            <div class="metadata-section">
                <span class="metadata-label">Auteur :</span> <span id="panel-author" class="metadata-value auteur-value"></span>
            </div>
            <p id="panel-description"></p>
            <p id="panel-usage"></p>
            <div class="panel-content-area">
                
            </div>
            <div class="prompt-code" style="display:none;">
                <h4>Prompt :</h4>
                <code id="panel-prompt"></code>
                <button class="copy-prompt-panel-btn" id="copy-prompt-panel-btn">Copier le prompt</button>
            </div>
        </div>
    </div>
    <div class="preview-overlay" id="preview-overlay"></div>

    <script src="[https://code.jquery.com/jquery-3.6.0.min.js](https://code.jquery.com/jquery-3.6.0.min.js)"></script>
    <script src="script.js"></script>
    <script>
        // --- VARIABLES ET FONCTIONS GLOBALES (si elles sont partagées entre les pages) ---
        // Si ces variables/fonctions sont utilisées sur PLUSIEURS pages, elles devraient être dans script.js
        // et non redéfinies ici. Pour l'instant, elles sont ici pour que cette page fonctionne.
        // Si vous déplacez cette section vers script.js, supprimez-la de cas-usages.html

        // Déclarations de variables globales pour l'accès inter-fonctions
        const apiBase = window.location.origin + '/.netlify/functions/';
        let allTips = []; 
        let currentToolScrollIndex = 0; // Pour le défilement des logos
        const maxVisibleLogos = 10; // Pour le défilement des logos

        // Références aux éléments DOM principaux qui sont utilisés par plusieurs fonctions
        // Ces variables DOIVENT être définies après que le DOM soit chargé.
        let galerieDiv;
        let errorDisplay;
        let filtreCategorieSelect;
        let filtreOutilSelect; 
        let filtreTriDateSelect;
        let previewTextInput;
        let previewPanel;
        let previewPanelTitle;
        let previewPanelCategory;
        let previewPanelAuthor;
        let previewPanelDescription;
        let previewPanelUsage; 
        let previewPanelContentArea; 
        let previewPanelPrompt;
        let copyPromptPanelBtn;
        let closePreviewPanelBtn;
        let previewOverlay;
        let toolLogosGrid;
        let scrollableToolsContainer;
        let scrollLeftArrow;
        let scrollRightArrow;
        // Ces variables sont globales à ce script seulement (pas au window)

        // Données des logos des outils (globales à ce script)
        const toolsData = [
            { name: "Premiere Pro", img: "logo_premiere.png" },
            { name: "n8n", img: "logo_n8n.png" },
            { name: "Runway ML", img: "logo_runwayML.png" }, 
            { name: "Midjourney", img: "logo_midjourney.png" },
            { name: "Stable Diffusion", img: "logo_stable_diff.png" },
            { name: "ChatGPT", img: "logo_chatgpt.png" },
            { name: "DALL-E 3", img: "logo_dall_E.png" }, 
            { name: "Claude", img: "logo_claude.png" },
            { name: "Firefly", img: "logo_firefly.png" }, 
            { name: "Photoshop", img: "logo_photoshop.png" }, 
            { name: "ElevenLabs", img: "logo_elevenlabs.png" } 
        ];

        // --- Fonctions utilitaires (globales à ce script) ---

        // Fonction pour charger des composants HTML via fetch
        // Note: Si script.js la définit déjà globalement, supprimez cette définition ici.
        async function loadComponent(url, placeholderId) {
            try {
                const res = await fetch(url);
                if (!res.ok) {
                    const errorDetail = await res.text();
                    throw new Error(`HTTP error! status: ${res.status} - ${res.statusText}. URL: ${url}. Response: ${errorDetail.substring(0, 200)}...`);
                }
                document.getElementById(placeholderId).innerHTML = await res.text();
            } catch (error) {
                console.error(`Erreur lors du chargement de ${url}:`, error);
                const placeholder = document.getElementById(placeholderId);
                if (placeholder) placeholder.innerHTML = `<p style='color:red;text-align:center;'>Erreur de chargement du composant: ${url}. (${error.message})</p>`;
            }
        };

        // getYouTubeVideoId (doit être global ou déplacé ici si utilisé)
        function getYouTubeVideoId(url) {
            let videoId = null;
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = url.match(youtubeRegex);
            if (match && match[1]) { videoId = match[1]; }
            return videoId;
        }

        // escapeHtml (doit être global ou déplacé ici si utilisé)
        function escapeHtml(text) {
            if (text === null || text === undefined) { return ''; }
            text = String(text);
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }


        // renderToolLogos (doit être global ou déplacé ici si utilisé)
        function renderToolLogos() {
            if (!toolLogosGrid || !scrollableToolsContainer || !scrollLeftArrow || !scrollRightArrow || !filtreOutilSelect) {
                console.warn("Certains éléments nécessaires au rendu des logos sont introuvables. La fonction renderToolLogos est ignorée.");
                return; 
            }
            toolLogosGrid.innerHTML = ''; 
            const allToolsCard = document.createElement('div');
            allToolsCard.className = 'tool-card';
            allToolsCard.innerHTML = `<i class="fas fa-tools" style="font-size: 50px; color: var(--primary-blue); margin-bottom: 8px;"></i><span class="tool-name">Tous les outils</span>`;
            allToolsCard.addEventListener('click', () => { filtreOutilSelect.value = ""; applyFiltersAndSort(); });
            toolLogosGrid.appendChild(allToolsCard);

            const sortedToolsData = [...toolsData].sort((a, b) => a.name.localeCompare(b.name));
            sortedToolsData.forEach(tool => {
                if (tool.name === "Tous les outils") return; 
                const toolCard = document.createElement('div');
                toolCard.className = 'tool-card'; 
                toolCard.innerHTML = `<img src="${tool.img}" alt="Logo de ${tool.name}" loading="lazy"><span class="tool-name">${tool.name}</span>`;
                toolCard.addEventListener('click', () => { filtreOutilSelect.value = tool.name; applyFiltersAndSort(); });
                toolLogosGrid.appendChild(toolCard);
            });
            scrollLeftArrow.onclick = () => scrollTools('left');
            scrollRightArrow.onclick = () => scrollTools('right');
            updateToolScrollPosition(); 
            checkToolArrowVisibility();
        }

        // updateToolScrollPosition (doit être global ou déplacé ici si utilisé)
        function updateToolScrollPosition() {
            if (!toolLogosGrid || !scrollableToolsContainer) return;
            const toolCardElement = toolLogosGrid.querySelector('.tool-card');
            if (!toolCardElement) { toolLogosGrid.style.transform = `translateX(0px)`; checkToolArrowVisibility(); return; }
            const cardWidth = toolCardElement.offsetWidth; 
            const gap = parseFloat(window.getComputedStyle(toolLogosGrid).gap); 
            const totalCardWidth = cardWidth + gap;
            const offset = -currentToolScrollIndex * totalCardWidth;
            toolLogosGrid.style.transform = `translateX(${offset}px)`;
            checkToolArrowVisibility();
        }

        // scrollTools (doit être global ou déplacé ici si utilisé)
        function scrollTools(direction) {
            if (!toolLogosGrid || !scrollableToolsContainer) return;
            const toolCardElement = toolLogosGrid.querySelector('.tool-card');
            if (!toolCardElement) return;
            const cardWidth = toolCardElement.offsetWidth;
            const gap = parseFloat(window.getComputedStyle(toolLogosGrid).gap);
            const totalCardWidth = cardWidth + gap;
            const containerWidth = scrollableToolsContainer.offsetWidth;
            let scrollStepCount = Math.floor(containerWidth / totalCardWidth);
            if (scrollStepCount === 0) scrollStepCount = 1; 
            if (direction === 'left') { currentToolScrollIndex = Math.max(0, currentToolScrollIndex - scrollStepCount); } 
            else { const maxIndex = toolLogosGrid.children.length - scrollStepCount; currentToolScrollIndex = Math.min(maxIndex, currentToolScrollIndex + scrollStepCount); }
            updateToolScrollPosition();
        }

        // checkToolArrowVisibility (doit être global ou déplacé ici si utilisé)
        function checkToolArrowVisibility() {
            if (!toolLogosGrid || !scrollableToolsContainer || !scrollLeftArrow || !scrollRightArrow) return;
            const toolCardElement = toolLogosGrid.querySelector('.tool-card');
            if (!toolCardElement) { scrollLeftArrow.classList.add('hidden'); scrollRightArrow.classList.add('hidden'); return; }
            const cardWidth = toolCardElement.offsetWidth;
            const gap = parseFloat(window.getComputedStyle(toolLogosGrid).gap);
            const totalCardWidth = cardWidth + gap;
            const containerWidth = scrollableToolsContainer.offsetWidth;
            const totalContentWidth = toolLogosGrid.scrollWidth;
            const visibleCardsInContainer = Math.floor(containerWidth / totalCardWidth);

            if (currentToolScrollIndex <= 0) { scrollLeftArrow.classList.add('hidden'); } else { scrollLeftArrow.classList.remove('hidden'); }
            if (currentToolScrollIndex + visibleCardsInContainer >= toolLogosGrid.children.length) { scrollRightArrow.classList.add('hidden'); } else { scrollRightArrow.classList.remove('hidden'); }
            if (totalContentWidth <= containerWidth + 1) { scrollLeftArrow.classList.add('hidden'); scrollRightArrow.classList.add('hidden'); }
        }

        // populateOutilFilter (doit être global ou déplacé ici si utilisé)
        function populateOutilFilter() {
            if (!filtreOutilSelect) return;
            filtreOutilSelect.innerHTML = '<option value="">Tous les outils</option>'; 
            const uniqueTools = [...new Set(toolsData.map(tool => tool.name))].sort();
            uniqueTools.forEach(toolName => {
                const option = document.createElement('option');
                option.value = toolName;
                option.textContent = toolName;
                filtreOutilSelect.appendChild(option);
            });
        }

        // applyFiltersAndSort (doit être global ou déplacé ici si utilisé)
        function applyFiltersAndSort() {
            let filtered = [...allTips];
            const categorie = filtreCategorieSelect.value;
            if (categorie) { filtered = filtered.filter(tip => tip.categorie === categorie); }
            const outil = filtreOutilSelect.value; 
            if (outil) {
                const normalizedOutilFilter = outil.toLowerCase().replace(/[^a-z0-9]/g, ''); 
                filtered = filtered.filter(tip => {
                    const normalizedTipOutil = String(tip.outil).toLowerCase().replace(/[^a-z0-9]/g, '');
                    return normalizedTipOutil.includes(normalizedOutilFilter) || normalizedOutilFilter.includes(normalizedTipOutil);
                });
            }
            const searchText = previewTextInput.value.toLowerCase();
            if (searchText) {
                filtered = filtered.filter(tip => 
                    (tip.title && String(tip.title).toLowerCase().includes(searchText)) ||
                    (tip.description && String(tip.description).toLowerCase().includes(searchText)) ||
                    (tip.promptText && String(tip.promptText).toLowerCase().includes(searchText)) ||
                    (tip.prompt && String(tip.prompt).toLowerCase().includes(searchText)) ||
                    (tip.auteur && String(tip.auteur).toLowerCase().includes(searchText)) ||
                    (tip.categorie && String(tip.categorie).toLowerCase().includes(searchText)) ||
                    (tip.outil && String(tip.outil).toLowerCase().includes(searchText))
                );
            }
            const sortOrder = filtreTriDateSelect.value;
            filtered.sort((a, b) => {
                if (sortOrder === 'recent') {
                    const dateA = new Date(a.dateCreation || a.date);
                    const dateB = new Date(b.dateCreation || b.date);
                    return dateB.getTime() - dateA.getTime();
                } else if (sortOrder === 'ancien') {
                    const dateA = new Date(a.dateCreation || a.date);
                    const dateB = new Date(b.dateCreation || b.date);
                    return dateA.getTime() - dateB.getTime();
                }
                return 0;
            });
            displayTips(filtered);
        }

        // setupFilters (doit être global ou déplacé ici si utilisé)
        function setupFilters() {
            filtreCategorieSelect.addEventListener('change', applyFiltersAndSort);
            previewTextInput.addEventListener('input', applyFiltersAndSort);
            filtreTriDateSelect.addEventListener('change', applyFiltersAndSort);
            filtreOutilSelect.addEventListener('change', () => { applyFiltersAndSort(); });
            populateOutilFilter(); 
        }

        // loadAndDisplayTips (doit être global ou déplacé ici si utilisé)
        async function loadAndDisplayTips() {
            galerieDiv.innerHTML = '<div class="loader"></div><p style="text-align: center;">Chargement des tips...</p>';
            try {
                const response = await fetch(`${apiBase}get-tips`);
                if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); }
                let fetchedTips = await response.json();
                allTips = fetchedTips.map(tip => {
                    let tipUrls = [];
                    if (Array.isArray(tip.urls)) { tipUrls = tip.urls; } 
                    else if (typeof tip.urls === 'string' && tip.urls.startsWith('[')) {
                        try { const parsed = JSON.parse(tip.urls); if (Array.isArray(parsed)) { tipUrls = parsed; } else { console.warn("Parsed URLs string is not an array:", parsed); } } 
                        catch (e) { console.error("Erreur de parsing de la chaîne URLs:", e, tip.urls); }
                    } else if (tip.url) { tipUrls = [tip.url]; }
                    return {
                        ...tip,
                        dateCreation: tip.date_creation || tip.dateCreation || tip.date_ajout || tip.date || new Date().toISOString(),
                        titre: tip.titre && tip.titre.trim() !== '' ? tip.titre : "Titre non spécifié",
                        auteur: tip.auteur && tip.auteur.trim() !== '' ? tip.auteur : "Auteur inconnu",
                        description: tip.description || '',
                        outil: tip.outil && tip.outil.trim() !== '' ? tip.outil : "Non spécifié", 
                        categorie: tip.categorie && tip.categorie.trim() !== '' ? tip.categorie : "Autre", 
                        urls: tipUrls 
                    };
                });
                applyFiltersAndSort(); 
            } catch (error) {
                console.error("Erreur lors du chargement des tips:", error);
                errorDisplay.style.display = 'block';
                errorDisplay.textContent = `Erreur de chargement des tips: ${error.message}`;
                galerieDiv.innerHTML = ''; 
            } finally {
                const localLoader = galerieDiv.querySelector('.loader');
                if (localLoader) localLoader.style.display = 'none';
                const loadingText = galerieDiv.querySelector('p[style="text-align: center;"]');
                if (loadingText) loadingText.remove(); 
            }
        }

        // displayTips (doit être global ou déplacé ici si utilisé)
        function displayTips(tipsToDisplay) {
            galerieDiv.innerHTML = ''; 
            if (tipsToDisplay.length === 0) { galerieDiv.innerHTML = '<p style="text-align: center; color: #555;">Aucun tip ne correspond à vos filtres.</p>'; return; }
            tipsToDisplay.forEach(tip => {
                const dateObj = new Date(tip.dateCreation);
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                const formattedDate = dateObj.toLocaleDateString('fr-FR', options);
                const actualPromptContent = tip.promptText || tip.prompt;
                const auteurLink = `<a href="equipe.html?auteur=${encodeURIComponent(tip.auteur)}" class="metadata-value auteur-value">${escapeHtml(tip.auteur)}</a>`;
                const cardHtml = `
                    <div class="carte" style="border-left-color: ${getCategoryColor(tip.categorie)};">
                        <div class="infos-wrapper">
                            <h3 class="tip-title">${escapeHtml(tip.titre)}</h3>
                            <span class="outil-badge">${escapeHtml(tip.outil || 'Non spécifié')}</span>
                            <div class="metadata-section">
                                <span class="metadata-label">Auteur:</span>
                                <span class="metadata-value auteur-value">${auteurLink}</span>
                                <span class="metadata-label">Catégorie:</span>
                                <span class="metadata-value">${escapeHtml(tip.categorie)}</span>
                                <span class="metadata-label">Date:</span>
                                <span class="metadata-value">${formattedDate}</span>
                            </div>
                            ${tip.previewText ? `<div class="preview-post-it">${escapeHtml(tip.previewText)}</div>` : ''}
                            <div class="card-actions">
                                <div class="top-buttons-group">
                                    <button class="toggle-content-btn" data-id="${tip.id}">Voir le Tip</button>
                                    ${actualPromptContent && actualPromptContent.trim() !== '' ? `<button class="copier-btn" data-copy="${escapeHtml(actualPromptContent)}">Copier le prompt</button>` : ''}
                                    <button class="edit-btn" data-id="${tip.id}">Éditer</button>
                                    <div class="card-preview-icons-inline">
                                        ${(tip.fileUrls && tip.fileUrls.length > 0) || tip.imageUrl ? `<i class="fas fa-image icon-vignette" title="Contient une image"></i>` : ''}
                                        ${tip.documentUrl && tip.documentUrl.trim() !== '' ? `<img src="PDF_file_icon.svg.webp" alt="Document PDF" class="icon-vignette pdf-thumbnail" title="Contient un document PDF">` : ''}
                                        ${(tip.urls && tip.urls.some(url => getYouTubeVideoId(url))) ? `<i class="fab fa-youtube icon-vignette" title="Contient une vidéo YouTube"></i>` : ''}
                                        ${(tip.urls && tip.urls.some(url => !getYouTubeVideoId(url) && url.trim() !== '')) ? `<i class="fas fa-link icon-vignette" title="Contient un lien externe"></i>` : ''}
                                    </div>
                                </div>
                                <button class="supprimer-btn" data-id="${tip.id}" title="Supprimer le tip"><i class="fas fa-trash-alt"></i></button>
                            </div>
                        </div>
                    </div>
                `;
                galerieDiv.insertAdjacentHTML('beforeend', cardHtml);
            });
            attachEventListenersToCards();
        }

        function getCategoryColor(category) {
            switch (category) {
                case 'Marketing Digital': return '#0077b6';
                case 'Création de Contenu': return '#38a3a5';
                case 'Analyse de Données': return '#ffc300';
                case 'Automatisation': return '#c70039';
                case 'Stratégie': return '#8ac926';
                case 'Productivité': return '#9d4edd';
                case 'Autre': return '#6c757d';
                    // These are now part of the DOMContentLoaded block
                    // All other variables are local to the DOMContentLoaded function now.
                    // This is to avoid conflicts with script.js.
                    // If script.js calls 'mettreAJourBulleDemandes', it needs to be defined globally in script.js.
