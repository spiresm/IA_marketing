<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Galerie de Tips IA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Styles généraux pour le corps de la page */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Styles de l'en-tête */
        header {
            width: 100%;
            max-width: 1200px;
            background-color: #fff;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        header h1 {
            color: #0056b3;
            margin: 0;
            font-size: 2.2em;
            text-align: center;
        }

        .header-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            width: 100%;
        }

        /* Barre de recherche */
        .search-bar {
            position: relative;
            flex-grow: 1;
            max-width: 350px;
        }

        #searchInput {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: 1px solid #ccc;
            border-radius: 25px;
            font-size: 1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .search-bar .fas.fa-search {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        /* Filtres (catégorie, outil) */
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filters select {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 25px;
            background-color: #f8f8f8;
            font-size: 0.95em;
            cursor: pointer;
            min-width: 150px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M287%2C116.4L154.5%2C248.9c-2.4%2C2.4-5.6%2C3.9-9.2%2C3.9c-3.6%2C0-6.8-1.4-9.2-3.9L5.4%2C116.4C0.2%2C111.3-1.4%2C104.5%2C1.4%2C99.2s7.6-9.7%2C14.1-9.7h257.9c6.5%2C0%2C11.9%2C4.4%2C14.1%2C9.7S292.2%2C111.3%2C287%2C116.4z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
        }

        /* Bouton "Ajouter un Tip" */
        .add-tip-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s ease;
        }

        .add-tip-btn:hover {
            background-color: #0056b3;
        }

        /* Conteneur principal de la galerie */
        main {
            width: 100%;
            max-width: 1200px;
        }

        .galerie-tips {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            padding: 0 10px;
        }

        /* ************************************************* */
        /* STYLES POUR CHAQUE PLAQUE (CARTE) */
        /* ************************************************* */
        .carte {
            background: #fff;
            border-left: 5px solid transparent; /* Couleur définie par JS */
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            display: flex; /* Garde flexbox pour la disposition horizontale des éléments gauche et droit */
            align-items: flex-start; /* Aligne le contenu en haut */
            padding: 15px; /* Déplace le padding ici pour toute la carte */
            position: relative; /* Important pour les éléments positionnés à l'intérieur */
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-left-color 0.2s ease;
            box-sizing: border-box;
            width: 100%;
            z-index: 1;
            gap: 20px; /* Ajoute un espace entre le contenu textuel et le panneau visuel */
        }

        .carte:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        /* Conteneur pour toutes les informations textuelles (partie gauche de la carte) */
        .infos-wrapper {
            display: flex;
            flex-direction: column;
            flex-grow: 1; /* Permet à cette section de prendre l'espace disponible */
            min-width: 0; /* Permet au contenu de rétrécir si nécessaire */
            flex-basis: 65%; /* Base de largeur pour la partie textuelle */
            max-width: 70%; /* Empêche de prendre trop de place */
        }

        /* Titre du tip */
        .tip-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 8px;
        }

        /* Badge d'outil (ChatGPT, Midjourney...) */
        .outil-badge {
            background-color: #e2e6ea;
            color: #555;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 12px;
        }

        /* Section des métadonnées (catégorie, auteur) */
        .metadata-section {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .metadata-label {
            font-weight: bold;
        }

        .auteur-value {
            color: #007bff;
            font-weight: 500;
        }

        /* Zone d'affichage du texte (description/prompt) */
        .text-display {
            background-color: #f8f8f8;
            border: 1px solid #eee;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #444;
            margin-bottom: 15px;
            max-height: 100px; /* Limite la hauteur pour un aperçu */
            overflow: hidden; /* Cache le contenu débordant */
            position: relative;
        }

        /* Masque dégradé pour le texte tronqué */
        .text-display::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px; /* Hauteur du dégradé */
            background: linear-gradient(to bottom, rgba(248, 248, 248, 0), rgba(248, 248, 248, 1) 90%);
            pointer-events: none; /* Permet d'interagir avec le contenu en dessous */
        }

        /* Quand le contenu est complètement visible */
        .text-display.expanded {
            max-height: none;
            overflow: visible;
        }

        .text-display.expanded::after {
            display: none;
        }

        /* Actions de la carte (boutons) */
        .card-actions {
            display: flex;
            justify-content: space-between;
            align-items: flex-end; /* Alignement en bas pour les boutons */
            margin-top: auto; /* Pousse les actions vers le bas */
            flex-wrap: wrap; /* Permet aux boutons de passer à la ligne */
            gap: 10px;
        }

        .top-buttons-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .card-actions button {
            background-color: #e9ecef;
            color: #333;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card-actions button:hover {
            background-color: #dee2e6;
            transform: translateY(-1px);
        }

        .card-actions button.copier-btn {
            background-color: #28a745;
            color: white;
        }

        .card-actions button.copier-btn:hover {
            background-color: #218838;
        }

        .card-actions button.edit-btn {
            background-color: #ffc107;
            color: #333;
        }

        .card-actions button.edit-btn:hover {
            background-color: #e0a800;
        }

        .card-actions button.supprimer-btn {
            background-color: #dc3545;
            color: white;
            font-size: 1.1em; /* Icône plus grande */
            padding: 8px 12px; /* Ajuste le padding pour l'icône */
        }

        .card-actions button.supprimer-btn:hover {
            background-color: #c82333;
        }

        /* Nouveau : Conteneur pour la partie visuelle de droite (images + post-it) */
        .right-side-visuals {
            display: flex;
            flex-direction: column; /* Empile les vignettes et le post-it verticalement */
            align-items: center; /* Centre horizontalement les éléments dans ce panneau */
            flex-shrink: 0; /* Empêche ce panneau de rétrécir par défaut */
            flex-basis: 250px; /* Largeur de base pour le panneau visuel */
            max-width: 30%; /* Largeur maximale relative à la carte */
            padding: 5px; /* Petit padding interne */
            box-sizing: border-box;
            gap: 15px; /* Espace entre les vignettes et le post-it */
        }

        /* Nouveau : Conteneur des deux vignettes */
        .image-thumbnails-container {
            display: flex;
            justify-content: center; /* Centre les vignettes horizontalement */
            align-items: center;
            gap: 10px; /* Espace entre les vignettes */
            flex-wrap: wrap; /* Permet aux vignettes de passer à la ligne sur petits écrans */
        }

        /* Nouveau : Styles pour les images de vignette individuelles */
        .thumbnail-image {
            width: 100px; /* Largeur fixe pour les vignettes */
            height: 100px; /* Hauteur fixe pour un aspect carré */
            object-fit: cover; /* Recadre les images pour remplir le cadre */
            border-radius: 8px; /* Coins légèrement arrondis */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* Légère ombre */
            transition: transform 0.2s ease;
        }

        .thumbnail-image:hover {
            transform: scale(1.05); /* Léger zoom au survol */
        }

        /* Nouveau : Style pour les images de vignette "placeholder" (si pas d'image/document) */
        .thumbnail-image.placeholder-image {
            background-color: #e0e0e0; /* Fond gris clair */
            border: 1px dashed #ccc; /* Bordure en pointillés */
            color: #888; /* Texte gris */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            text-align: center;
            flex-direction: column; /* Pour centrer le texte "Pas d'image" */
            line-height: 1.2;
        }

        /* Styles pour le "post-it" (maintenant en flux normal) */
        .preview-post-it {
            background-color: #FFFAA0; /* Jaune pastel plus doux */
            color: #333; /* Texte noir par défaut pour le post-it */
            padding: 10px; /* Plus de padding */
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            font-size: 1em; /* Taille de police légèrement plus grande */
            font-weight: bold;
            z-index: 2; /* Garde le z-index en cas de chevauchement */
            white-space: pre-wrap;
            word-break: break-word;
            max-width: 180px; /* Conserve une largeur maximale pour le post-it */
            transform: rotate(2deg); /* Légère rotation pour un effet "post-it" */
            margin: 0 auto; /* Centre horizontalement dans son conteneur flex */
            align-self: center; /* Assure son centrage dans .right-side-visuals */
        }

        /* Overlay et modale pour l'aperçu/édition */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease-out;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            color: #888;
            transition: color 0.2s;
        }

        .close-button:hover {
            color: #333;
        }

        #tipDetails h2 {
            color: #007bff;
            margin-top: 0;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        #tipDetails p {
            margin-bottom: 10px;
            line-height: 1.8;
            font-size: 1em;
            color: #444;
        }

        #tipDetails strong {
            color: #0056b3;
        }

        #tipDetails .detail-field {
            margin-bottom: 10px;
        }

        #tipDetails .detail-label {
            font-weight: bold;
            color: #555;
            margin-right: 5px;
        }

        #tipDetails .detail-value {
            color: #333;
        }

        /* Formulaire d'édition dans la modale */
        .edit-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .edit-form input[type="text"],
        .edit-form textarea,
        .edit-form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box; /* Pour inclure padding et border dans la largeur */
        }

        .edit-form textarea {
            resize: vertical;
            min-height: 100px;
        }

        .edit-form button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
            margin-top: 10px;
        }

        .edit-form button:hover {
            background-color: #0056b3;
        }

        /* Message de confirmation de suppression */
        .delete-confirm-message {
            background-color: #ffe0b2; /* Orange très clair */
            color: #e65100; /* Orange foncé */
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #ffcc80;
        }

        .delete-confirm-message p {
            margin-bottom: 10px;
            font-weight: bold;
        }

        .delete-confirm-message button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        .delete-confirm-message button:hover {
            background-color: #c82333;
        }

        .delete-confirm-message button.cancel-delete {
            background-color: #6c757d;
        }

        .delete-confirm-message button.cancel-delete:hover {
            background-color: #5a6268;
        }


        /* --- MEDIA QUERIES POUR LA RESPONSIVITÉ --- */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            header {
                padding: 15px;
                gap: 15px;
            }

            header h1 {
                font-size: 1.8em;
            }

            .header-controls {
                flex-direction: column;
                align-items: center;
            }

            .search-bar {
                max-width: 100%;
            }

            .filters {
                flex-direction: column;
                width: 100%;
            }

            .filters select {
                width: 100%;
            }

            .galerie-tips {
                grid-template-columns: 1fr; /* Une seule colonne sur mobile */
                padding: 0;
            }

            .carte {
                flex-direction: column; /* Empile les éléments verticalement sur petits écrans */
                align-items: center; /* Centre le contenu lorsqu'empilé */
                gap: 15px; /* Ajuste l'espace pour l'empilement vertical */
                padding: 15px; /* Assure le padding sur la carte */
            }

            .infos-wrapper {
                width: 100%; /* Prend toute la largeur */
                max-width: unset; /* Supprime la contrainte de largeur maximale */
                flex-basis: auto; /* Permet un dimensionnement flexible */
                /* Padding géré par .carte */
            }

            .right-side-visuals {
                width: 100%; /* Prend toute la largeur */
                max-width: unset; /* Supprime la contrainte de largeur maximale */
                flex-basis: auto; /* Permet un dimensionnement flexible */
                /* Padding géré par .carte */
            }

            .image-thumbnails-container {
                justify-content: center; /* Assure le centrage */
                gap: 10px; /* Maintient l'espace */
            }

            .thumbnail-image {
                width: 80px; /* Réduit légèrement la taille des vignettes sur petits écrans */
                height: 80px;
            }

            .preview-post-it {
                position: static; /* Supprime la position absolue, le laisse en flux normal */
                margin-top: 10px; /* Ajoute un peu d'espace si nécessaire */
                max-width: unset; /* Permet la pleine largeur */
                text-align: center; /* Centre le texte */
                transform: none; /* Supprime la rotation sur petits écrans */
                font-size: 1.1em; /* Garde la taille plus grande sur mobile aussi */
            }

            .card-actions {
                flex-direction: column;
                align-items: center;
            }

            .top-buttons-group {
                width: 100%;
                justify-content: center;
            }

            .card-actions button {
                width: 100%;
            }

            .card-actions button.supprimer-btn {
                width: auto; /* Pour que le bouton de suppression reste petit */
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .filters select,
            .add-tip-btn,
            #searchInput {
                font-size: 0.9em;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ma Galerie de Tips IA</h1>
        <div class="header-controls">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Rechercher des tips...">
                <i class="fas fa-search"></i>
            </div>
            <div class="filters">
                <select id="categoryFilter">
                    <option value="">Toutes catégories</option>
                    <option value="Marketing Digital">Marketing Digital</option>
                    <option value="Réseaux Sociaux">Réseaux Sociaux</option>
                    <option value="SEO">SEO</option>
                    <option value="Contenu">Contenu</option>
                    <option value="Publicité">Publicité</option>
                    <option value="Outils IA">Outils IA</option>
                    <option value="Stratégie">Stratégie</option>
                    <option value="Autre">Autre</option>
                </select>
                <select id="toolFilter">
                    <option value="">Tous outils</option>
                    <option value="ChatGPT">ChatGPT</option>
                    <option value="Midjourney">Midjourney</option>
                    <option value="DALL-E">DALL-E</option>
                    <option value="Canva AI">Canva AI</option>
                    <option value="Jasper">Jasper</option>
                    <option value="Semrush">Semrush</option>
                    <option value="Autres">Autres</option>
                </select>
            </div>
            <button id="addTipBtn" class="add-tip-btn"><i class="fas fa-plus"></i> Ajouter un Tip</button>
        </div>
    </header>

    <main>
        <div id="galerieTips" class="galerie-tips">
            </div>
    </main>

    <div id="tipModalOverlay" class="modal-overlay">
        <div class="modal-content">
            <span class="close-button" id="closeModalBtn">&times;</span>
            <div id="tipDetails">
                </div>
        </div>
    </div>

    <script>
        // Données des tips (exemple)
        let tipsData = [
            {
                id: '1',
                titre: 'Optimisation de Contenu SEO avec l\'IA',
                outil: 'ChatGPT',
                categorie: 'SEO',
                auteur: 'Yasmine AIT MASKOUR',
                description: 'Découvrez comment utiliser l\'intelligence artificielle pour améliorer le référencement de vos contenus web. Optimisez vos mots-clés, générez des méta-descriptions percutantes et trouvez de nouvelles idées de sujets en quelques minutes grâce à ChatGPT.',
                prompt: 'Génère 10 titres d\'articles de blog optimisés SEO sur le thème du "marketing de contenu", en incluant des mots-clés de longue traîne.',
                previewText: 'Accélérez l\'optimisation SEO de vos contenus web grâce à l\'aide de ChatGPT, en quelques minutes.',
                imageUrl: 'https://via.placeholder.com/150x150?text=SEO+ChatGPT',
                documentUrl: null // Pas de document pour cet exemple
            },
            {
                id: '2',
                titre: 'Créer des images uniques avec Midjourney',
                outil: 'Midjourney',
                categorie: 'Contenu',
                auteur: 'Lucas Dupont',
                description: 'Apprenez à maîtriser Midjourney pour produire des visuels époustouflants pour vos campagnes marketing, vos articles de blog ou vos publications sur les réseaux sociaux. Explorez les commandes avancées et les styles artistiques.',
                prompt: 'Crée une image surréaliste d\'une ville futuriste sous-marine, avec des couleurs vives et un style "steampunk".',
                previewText: 'Des visuels époustouflants en un clin d\'œil pour vos projets.',
                imageUrl: 'https://via.placeholder.com/150x150?text=Midjourney+Art',
                documentUrl: 'https://www.africau.edu/images/default/sample.pdf' // Exemple de document PDF
            },
            {
                id: '3',
                titre: 'Stratégie de Contenu pour LinkedIn',
                outil: 'ChatGPT',
                categorie: 'Réseaux Sociaux',
                auteur: 'Sophie Martin',
                description: 'Élaborez une stratégie de contenu efficace pour LinkedIn. Boostez votre profil et votre marque professionnelle en publiant du contenu engageant et pertinent, généré avec l\'aide de l\'IA.',
                prompt: 'Rédige 5 idées de posts LinkedIn pour un expert en transformation digitale, axés sur l\'engagement et la génération de leads.',
                previewText: 'Devenez un expert LinkedIn avec des posts percutants.',
                imageUrl: null, // Pas d'image
                documentUrl: null // Pas de document
            },
            {
                id: '4',
                titre: 'Analyse de la concurrence avec l\'IA',
                outil: 'Semrush',
                categorie: 'Marketing Digital',
                auteur: 'David Garcia',
                description: 'Utilisez les outils d\'IA intégrés à Semrush pour une analyse approfondie de vos concurrents. Identifiez leurs stratégies gagnantes et les opportunités pour votre propre business.',
                prompt: 'Analyse les backlinks de 3 concurrents majeurs dans le secteur de l\'e-commerce de mode et propose une stratégie pour les surpasser.',
                previewText: 'Découvrez les secrets de vos concurrents et prenez l\'avantage.',
                imageUrl: 'https://via.placeholder.com/150x150?text=Semrush+AI',
                documentUrl: null
            },
            {
                id: '5',
                titre: 'Brainstorming créatif avec DALL-E',
                outil: 'DALL-E',
                categorie: 'Contenu',
                auteur: 'Alice Tremblay',
                description: 'Stimulez votre créativité en utilisant DALL-E pour générer des concepts visuels inattendus. Idéal pour les publicités, le design produit ou l\'inspiration artistique.',
                prompt: 'Crée une série d\'images conceptuelles pour une nouvelle boisson énergisante, inspirées par l\'esthétique cyberpunk et la nature luxuriante.',
                previewText: 'Laissez l\'IA booster votre imagination visuelle.',
                imageUrl: 'https://via.placeholder.com/150x150?text=DALL-E+Creativity',
                documentUrl: null
            }
        ];

        // Références DOM
        const galerieDiv = document.getElementById('galerieTips');
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const toolFilter = document.getElementById('toolFilter');
        const addTipBtn = document.getElementById('addTipBtn');
        const tipModalOverlay = document.getElementById('tipModalOverlay');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const tipDetailsDiv = document.getElementById('tipDetails');

        // Initialisation de l'ID courant pour l'édition/suppression
        let currentEditingTipId = null;

        // --- Fonctions de gestion des données (Local Storage) ---
        function saveTipsToLocalStorage() {
            localStorage.setItem('tipsData', JSON.stringify(tipsData));
        }

        function loadTipsFromLocalStorage() {
            const storedTips = localStorage.getItem('tipsData');
            if (storedTips) {
                tipsData = JSON.parse(storedTips);
            }
        }

        // --- Fonction utilitaire pour générer un ID unique ---
        function generateUniqueId() {
            return '_' + Math.random().toString(36).substr(2, 9);
        }

        // --- Fonction d'affichage des tips ---
        function displayTips(tipsToDisplay) {
            galerieDiv.innerHTML = ''; // Vide la galerie avant d'afficher
            if (tipsToDisplay.length === 0) {
                galerieDiv.innerHTML = '<p style="text-align: center; color: #555;">Aucun tip trouvé pour vos critères de recherche.</p>';
                return;
            }

            tipsToDisplay.forEach(tip => {
                const carte = document.createElement('div');
                carte.className = 'carte';
                carte.dataset.id = tip.id; // Stocke l'ID pour les actions

                // Détermine la couleur de la bordure en fonction de la catégorie
                let borderColor = '#0077b6'; // Bleu par défaut
                switch (tip.categorie) {
                    case 'Marketing Digital': borderColor = '#28a745'; break; // Vert
                    case 'Réseaux Sociaux': borderColor = '#fd7e14'; break; // Orange
                    case 'SEO': borderColor = '#6f42c1'; break; // Violet
                    case 'Contenu': borderColor = '#dc3545'; break; // Rouge
                    case 'Publicité': borderColor = '#17a2b8'; break; // Cyan
                    case 'Outils IA': borderColor = '#ffc107'; break; // Jaune
                    case 'Stratégie': borderColor = '#e83e8c'; break; // Rose
                    case 'Autre': borderColor = '#6c757d'; break; // Gris
                }
                carte.style.borderLeftColor = borderColor;

                carte.innerHTML = `
                    <div class="infos-wrapper">
                        <div class="tip-title">${tip.titre || 'Sans titre'}</div>
                        <div class="outil-badge">${tip.outil || 'N/A'}</div>
                        <div class="metadata-section">
                            <span class="metadata-label">Catégorie :</span> <span class="metadata-value">${tip.categorie || 'N/A'}</span>
                            <span class="metadata-label">Auteur :</span> <span class="metadata-value auteur-value">${tip.auteur || 'N/A'}</span>
                        </div>
                        <div class="text-display">${tip.description ? `<strong>Description :</strong><br>${tip.description}` : (tip.prompt ? `<strong>Prompt :</strong><br>${tip.prompt}` : 'Pas de contenu à afficher.')}</div>
                        <div class="card-actions">
                            <div class="top-buttons-group">
                                <button class="toggle-content-btn" data-id="${tip.id}">${tip.description && tip.prompt ? 'Afficher le prompt' : 'Contenu'}</button>
                                <button class="copier-btn" data-id="${tip.id}">Copier le prompt</button>
                                <button class="edit-btn" data-id="${tip.id}">Éditer ce tip</button>
                            </div>
                            <button class="supprimer-btn" data-id="${tip.id}"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                    <div class="right-side-visuals">
                        <div class="image-thumbnails-container">
                            ${tip.imageUrl ? `<img src="${tip.imageUrl}" alt="Image pour ${tip.titre}" class="thumbnail-image">` : `<img src="https://via.placeholder.com/100x100?text=Image" alt="Pas d'image" class="thumbnail-image placeholder-image">`}
                            ${tip.documentUrl ? `<img src="https://via.placeholder.com/100x100?text=Doc" alt="Document attaché" class="thumbnail-image document-icon">` : `<img src="https://via.placeholder.com/100x100?text=Doc" alt="Pas de document" class="thumbnail-image placeholder-image">`}
                        </div>
                        ${tip.previewText ? `<div class="preview-post-it">${tip.previewText}</div>` : ''}
                    </div>
                `;
                galerieDiv.appendChild(carte);
            });
        }

        // --- Fonctions de filtrage et recherche ---
        function filterTips() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categoryFilter.value;
            const selectedTool = toolFilter.value;

            const filtered = tipsData.filter(tip => {
                const matchesSearch = tip.titre.toLowerCase().includes(searchTerm) ||
                                      tip.description.toLowerCase().includes(searchTerm) ||
                                      tip.prompt.toLowerCase().includes(searchTerm) ||
                                      tip.auteur.toLowerCase().includes(searchTerm);

                const matchesCategory = selectedCategory === '' || tip.categorie === selectedCategory;
                const matchesTool = selectedTool === '' || tip.outil === selectedTool;

                return matchesSearch && matchesCategory && matchesTool;
            });

            displayTips(filtered);
        }

        // --- Gestionnaires d'événements pour les actions sur les cartes ---
        function handleCardAction(event) {
            const target = event.target;
            const id = target.dataset.id || target.closest('button').dataset.id; // S'assure de récupérer l'ID

            if (!id) return; // Si aucun ID, ignore

            if (target.classList.contains('toggle-content-btn')) {
                toggleCardContent(id, target);
            } else if (target.classList.contains('copier-btn')) {
                copyToClipboard(id);
            } else if (target.classList.contains('edit-btn')) {
                openEditModal(id);
            } else if (target.classList.contains('supprimer-btn')) {
                deleteTip(id);
            } else if (target.classList.contains('thumbnail-image')) {
                 // Si une vignette est cliquée, ouvre l'URL correspondante si elle existe
                const tip = tipsData.find(t => t.id === id);
                if (tip) {
                    if (target.classList.contains('document-icon') && tip.documentUrl) {
                        window.open(tip.documentUrl, '_blank');
                    } else if (tip.imageUrl) {
                        window.open(tip.imageUrl, '_blank');
                    }
                }
            }
        }

        // --- Fonction pour basculer entre description et prompt ---
        function toggleCardContent(tipId, button) {
            const tip = tipsData.find(t => t.id === tipId);
            if (!tip) return;

            const cardElement = button.closest('.carte');
            const textDisplay = cardElement.querySelector('.text-display');

            if (!textDisplay) return;

            // Stocke l'état actuel (description ou prompt affiché) sur le bouton
            let currentContent = button.dataset.currentContent || 'description';

            if (currentContent === 'description' && tip.prompt) {
                textDisplay.innerHTML = `<strong>Prompt :</strong><br>${tip.prompt}`;
                button.textContent = 'Afficher la description';
                button.dataset.currentContent = 'prompt';
            } else if (currentContent === 'prompt' && tip.description) {
                textDisplay.innerHTML = `<strong>Description :</strong><br>${tip.description}`;
                button.textContent = 'Afficher le prompt';
                button.dataset.currentContent = 'description';
            } else {
                // Si l'un des deux est manquant, ne rien faire ou afficher un message par défaut
                textDisplay.innerHTML = tip.description ? `<strong>Description :</strong><br>${tip.description}` : (tip.prompt ? `<strong>Prompt :</strong><br>${tip.prompt}` : 'Pas de contenu à afficher.');
                button.textContent = 'Contenu';
                button.dataset.currentContent = 'description'; // Retourne à la description par défaut
            }

            // Gère l'expansion (si le contenu est tronqué)
            textDisplay.classList.remove('expanded'); // Remet à l'état non-expand
            // Si le nouveau contenu est long, il sera tronqué par défaut (CSS)
        }


        // --- Fonction pour copier le prompt dans le presse-papiers ---
        function copyToClipboard(tipId) {
            const tip = tipsData.find(t => t.id === tipId);
            if (tip && tip.prompt) {
                navigator.clipboard.writeText(tip.prompt).then(() => {
                    alert('Prompt copié dans le presse-papiers !');
                }).catch(err => {
                    console.error('Erreur lors de la copie: ', err);
                    alert('Impossible de copier le prompt.');
                });
            } else {
                alert('Aucun prompt à copier pour ce tip.');
            }
        }

        // --- Fonctions pour la modale d'édition/ajout ---
        function openEditModal(tipId = null) {
            tipModalOverlay.classList.add('active');
            currentEditingTipId = tipId; // Stocke l'ID du tip en cours d'édition

            let modalContentHtml = `
                <h2>${tipId ? 'Éditer un Tip' : 'Ajouter un Nouveau Tip'}</h2>
                <form id="tipForm" class="edit-form">
                    <label for="modalTitre">Titre du Tip :</label>
                    <input type="text" id="modalTitre" required>

                    <label for="modalOutil">Outil utilisé :</label>
                    <input type="text" id="modalOutil" required>

                    <label for="modalCategorie">Catégorie :</label>
                    <select id="modalCategorie" required>
                        <option value="">Sélectionner une catégorie</option>
                        <option value="Marketing Digital">Marketing Digital</option>
                        <option value="Réseaux Sociaux">Réseaux Sociaux</option>
                        <option value="SEO">SEO</option>
                        <option value="Contenu">Contenu</option>
                        <option value="Publicité">Publicité</option>
                        <option value="Outils IA">Outils IA</option>
                        <option value="Stratégie">Stratégie</option>
                        <option value="Autre">Autre</option>
                    </select>

                    <label for="modalAuteur">Auteur :</label>
                    <input type="text" id="modalAuteur" required>

                    <label for="modalDescription">Description :</label>
                    <textarea id="modalDescription" rows="5"></textarea>

                    <label for="modalPrompt">Prompt (ou contenu principal) :</label>
                    <textarea id="modalPrompt" rows="8"></textarea>

                    <label for="modalPreviewText">Texte de prévisualisation (pour le post-it) :</label>
                    <input type="text" id="modalPreviewText">

                    <label for="modalImageUrl">URL de l'image (vignette 1) :</label>
                    <input type="text" id="modalImageUrl" placeholder="Ex: https://example.com/image.jpg">

                    <label for="modalDocumentUrl">URL du document (vignette 2) :</label>
                    <input type="text" id="modalDocumentUrl" placeholder="Ex: https://example.com/document.pdf">

                    <button type="submit">${tipId ? 'Sauvegarder les modifications' : 'Ajouter le Tip'}</button>
                </form>
            `;
            tipDetailsDiv.innerHTML = modalContentHtml;

            // Si c'est une édition, pré-remplir le formulaire
            if (tipId) {
                const tip = tipsData.find(t => t.id === tipId);
                if (tip) {
                    document.getElementById('modalTitre').value = tip.titre;
                    document.getElementById('modalOutil').value = tip.outil;
                    document.getElementById('modalCategorie').value = tip.categorie;
                    document.getElementById('modalAuteur').value = tip.auteur;
                    document.getElementById('modalDescription').value = tip.description;
                    document.getElementById('modalPrompt').value = tip.prompt;
                    document.getElementById('modalPreviewText').value = tip.previewText;
                    document.getElementById('modalImageUrl').value = tip.imageUrl || '';
                    document.getElementById('modalDocumentUrl').value = tip.documentUrl || '';
                }
            }

            // Gérer la soumission du formulaire
            document.getElementById('tipForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveEditedTip();
            });
        }

        function saveEditedTip() {
            const titre = document.getElementById('modalTitre').value;
            const outil = document.getElementById('modalOutil').value;
            const categorie = document.getElementById('modalCategorie').value;
            const auteur = document.getElementById('modalAuteur').value;
            const description = document.getElementById('modalDescription').value;
            const prompt = document.getElementById('modalPrompt').value;
            const previewText = document.getElementById('modalPreviewText').value;
            const imageUrl = document.getElementById('modalImageUrl').value;
            const documentUrl = document.getElementById('modalDocumentUrl').value;

            if (currentEditingTipId) {
                // Modifier un tip existant
                const tipIndex = tipsData.findIndex(t => t.id === currentEditingTipId);
                if (tipIndex !== -1) {
                    tipsData[tipIndex] = {
                        ...tipsData[tipIndex], // Garde les propriétés non modifiées
                        titre, outil, categorie, auteur, description, prompt, previewText,
                        imageUrl: imageUrl || null,
                        documentUrl: documentUrl || null
                    };
                }
            } else {
                // Ajouter un nouveau tip
                const newTip = {
                    id: generateUniqueId(),
                    titre, outil, categorie, auteur, description, prompt, previewText,
                    imageUrl: imageUrl || null,
                    documentUrl: documentUrl || null
                };
                tipsData.push(newTip);
            }

            saveTipsToLocalStorage(); // Sauvegarde les données mises à jour
            filterTips(); // Réaffiche les tips avec les mises à jour/ajouts
            closeModal(); // Ferme la modale
        }

        // --- Fonction de suppression d'un tip ---
        function deleteTip(tipId) {
            const tipToDelete = tipsData.find(t => t.id === tipId);
            if (!tipToDelete) return;

            // Afficher un message de confirmation dans la modale
            tipModalOverlay.classList.add('active');
            tipDetailsDiv.innerHTML = `
                <div class="delete-confirm-message">
                    <p>Êtes-vous sûr de vouloir supprimer le tip : "<strong>${tipToDelete.titre}</strong>" ?</p>
                    <button id="confirmDeleteBtn" data-id="${tipId}">Oui, supprimer</button>
                    <button id="cancelDeleteBtn" class="cancel-delete">Annuler</button>
                </div>
            `;

            document.getElementById('confirmDeleteBtn').onclick = function() {
                tipsData = tipsData.filter(tip => tip.id !== tipId);
                saveTipsToLocalStorage();
                filterTips(); // Réaffiche la liste mise à jour
                closeModal();
            };

            document.getElementById('cancelDeleteBtn').onclick = function() {
                closeModal();
            };
        }

        // --- Fonction pour fermer la modale ---
        function closeModal() {
            tipModalOverlay.classList.remove('active');
            currentEditingTipId = null; // Réinitialise l'ID
            tipDetailsDiv.innerHTML = ''; // Vide le contenu de la modale
        }


        // --- Écouteurs d'événements ---
        document.addEventListener('DOMContentLoaded', () => {
            loadTipsFromLocalStorage(); // Charge les données au démarrage
            displayTips(tipsData); // Affiche tous les tips au chargement

            // Écouteurs pour les contrôles de filtrage/recherche
            searchInput.addEventListener('input', filterTips);
            categoryFilter.addEventListener('change', filterTips);
            toolFilter.addEventListener('change', filterTips);

            // Écouteur pour le bouton "Ajouter un Tip"
            addTipBtn.addEventListener('click', () => openEditModal(null)); // null pour l'ajout

            // Écouteurs pour les actions sur les cartes (délégation d'événements)
            galerieDiv.addEventListener('click', handleCardAction);

            // Écouteur pour fermer la modale
            closeModalBtn.addEventListener('click', closeModal);
            tipModalOverlay.addEventListener('click', (e) => {
                if (e.target === tipModalOverlay) { // Ferme seulement si on clique sur l'overlay
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
