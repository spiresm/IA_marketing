<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title} - Espace IA</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background-color: #f0f4f8;
      color: #333;
    }
    .header {
      background-color: #0077b6;
      color: white;
      padding: 40px 20px;
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-size: 2em;
      color: white;
    }
    nav {
      background-color: #ffffff;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    nav a {
      text-decoration: none;
      color: #0077b6;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 20px;
      transition: background-color 0.3s;
    }
    nav a:hover {
      background-color: #e0f0ff;
    }
    .section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      padding: 40px 20px;
    }
    .tile {
      background-color: #ffffff;
      width: 100%;
      max-width: 800px;
      border-left: 8px solid #0077b6;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
    }
    .tile h2 {
      margin-top: 0;
      color: #0077b6;
    }
    .tile p {
      color: #555;
    }
  </style>
<script>
    window.addEventListener('DOMContentLoaded', () => afficherFiche('fiche-accueil'));
    function masquerToutesFiches() {
      const fiches = document.querySelectorAll('.tile');
      fiches.forEach(fiche => fiche.style.display = 'none');
    }
    function afficherFiche(id) {
      const fiches = document.querySelectorAll('.tile');
      fiches.forEach(fiche => fiche.style.display = 'none');
      const cible = document.getElementById(id);
      if (cible) cible.style.display = 'block';
    }
  </script>
</head>
<body>
  <div class="header">
    <h1>Espace IA Marketing</h1>
  </div>

  <nav>
    <a href="#" onclick="afficherFiche('fiche-accueil')">Accueil</a>
    <a href="#" onclick="afficherFiche('fiche-profil')">Mon profil</a>
    <a href="#" onclick="afficherFiche('fiche-outils')">Outils IA</a>
    <a href="#" onclick="afficherFiche('fiche-prompts')">Prompts</a>
    <a href="#" onclick="afficherFiche('fiche-cas')">Cas d’usage</a>
    <a href="#" onclick="afficherFiche('fiche-creer')">Créer un tip</a>
    <a href="#" onclick="afficherFiche('fiche-veille')">Veille</a>
  </nav>
          </nav>
          <div class="container">
            <h2>Partager un prompt</h2>
            <form @submit.prevent="submitForm">
              <label for="auteur">Votre nom</label>
              <input id="auteur" v-model="auteur" required />

              <label for="outil">Outil IA utilisé</label>
              <select id="outil" v-model="outil">
                <option>Midjourney</option><option>DALL·E</option><option>Stable Diffusion</option><option>Adobe Firefly</option><option>Runway</option>
              </select>

              <label for="categorie">Catégorie</label>
              <select id="categorie" v-model="categorie">
                <option>Portrait</option><option>Paysage</option><option>Concept Art</option><option>Produit</option><option>Architecture</option>
              </select>

              <label for="texte">Prompt</label>
              <textarea id="texte" v-model="texte" rows="4" required></textarea>

              <label>Image</label>
              <div id="drop-zone" @click="triggerFile" @dragover.prevent="onDragOver" @dragleave="onDragLeave" @drop.prevent="onDrop">
                Déposez ou cliquez
              </div>
              <input type="file" ref="fileInput" accept="image/*" style="display:none" @change="onFileChange" />
              <img v-if="imagePreviewUrl" :src="imagePreviewUrl" id="image-preview" />

              <button type="submit">Partager</button>
            </form>

            <div class="confirmation" v-if="confirmationVisible">
              <p>✅ Prompt partagé !</p>
              <img v-if="confirmationImageUrl" :src="confirmationImageUrl" />
              <p>{{ confirmationTexte }}</p>
            </div>
          </div>
        </div>
      `,
      setup() {
        const currentPage = ref('Accueil');
        const auteur = ref('');
        const outil = ref('Midjourney');
        const categorie = ref('Portrait');
        const texte = ref('');
        const fileInput = ref(null);
        const imagePreviewUrl = ref('');
        const confirmationVisible = ref(false);
        const confirmationImageUrl = ref('');
        const confirmationTexte = ref('');

        function go(page) { currentPage.value = page; }
        function triggerFile() { fileInput.value.click(); }
        function onDragOver(e) { e.currentTarget.classList.add('dragover'); }
        function onDragLeave(e) { e.currentTarget.classList.remove('dragover'); }
        function onDrop(e) {
          e.currentTarget.classList.remove('dragover');
          fileInput.value.files = e.dataTransfer.files;
          handleFile(e.dataTransfer.files[0]);
        }
        function onFileChange(e) { handleFile(e.target.files[0]); }
        function handleFile(file) {
          const reader = new FileReader();
          reader.onload = () => { imagePreviewUrl.value = reader.result; };
          reader.readAsDataURL(file);
        }
        function getBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = () => reject();
            reader.readAsDataURL(file);
          });
        }
        async function submitForm() {
          confirmationVisible.value = false;
          let imageUrl = '';
          const file = fileInput.value.files[0];
          if (file) {
            console.log('Nom du fichier à uploader:', file.name);
            try {
              const base64 = await getBase64(file);
              const payload = { fileBase64: base64, fileName: file.name };
              console.log('Payload envoyé à uploadImage:', payload);
              const resp = await fetch('/.netlify/functions/uploadImage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
              });
              if (!resp.ok) throw new Error(`Upload failed: ${resp.status}`);
              const data = await resp.json();
              console.log(data); // Affiche la réponse brute pour debug
              if (!data.url) throw new Error('Aucune URL retournée');
              imageUrl = data.url;
            } catch (err) {
              console.error('Erreur uploadImage:', err);
              alert('Échec upload image');
              return;
            }
          }
          try {
            const promptResp = await fetch('/.netlify/functions/pushPrompt', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ auteur: auteur.value, outil: outil.value, categorie: categorie.value, texte: texte.value, imageUrl })
            });
            if (!promptResp.ok) throw new Error(`Prompt failed: ${promptResp.status}`);
            confirmationImageUrl.value = imageUrl;
            confirmationTexte.value = texte.value;
            confirmationVisible.value = true;
            auteur.value = '';
            outil.value = 'Midjourney';
            categorie.value = 'Portrait';
            texte.value = '';
            imagePreviewUrl.value = '';
            fileInput.value.value = null;
          } catch (err) {
            console.error('Erreur pushPrompt:', err);
            alert('Échec envoi prompt');
          }
        }

        return {
          currentPage, go,
          auteur, outil, categorie, texte, fileInput,
          imagePreviewUrl, confirmationVisible,
          confirmationImageUrl, confirmationTexte,
          triggerFile, onDragOver, onDragLeave, onDrop, onFileChange, submitForm
        };
      }
    };

    Vue.createApp(PromptForm).mount('#app');
  </script>
</body>
</html>
