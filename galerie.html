<script>
  const repoOwner = 'spiresm';
  const repoName = 'IA_marketing';
  const branch = 'main';
  const apiBase = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/prompts?ref=${branch}`;
  const rawBase = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/`;

  async function chargerPrompts() {
    const galerie = document.getElementById('galerie');
    try {
      const res = await fetch(apiBase);
      if (!res.ok) throw new Error(`Erreur GitHub API: ${res.status}`);
      const fichiers = await res.json();

      for (const fichier of fichiers) {
        if (!fichier.name.endsWith('.json')) continue;

        const rawRes = await fetch(fichier.download_url);
        if (!rawRes.ok) continue;
        const data = await rawRes.json();

        let imagePath = data.imageUrl || data.image || '';
        let imageUrl = '';
        if (imagePath) {
          imageUrl = /^https?:\/\//.test(imagePath)
            ? imagePath
            : rawBase + imagePath.replace(/^\/+/, '');
        }

        const div = document.createElement('div');
        div.className = 'carte';

        if (imageUrl) {
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = 'Image du prompt';
          img.onclick = () => img.classList.toggle('zoomed');
          div.appendChild(img);
        }

        const infos = document.createElement('p');
        infos.className = 'infos';
        infos.innerHTML = `<strong>${data.auteur || 'Inconnu'}</strong> • ${data.outil || 'Outil'} • ${data.categorie || 'Catégorie'}`;
        div.appendChild(infos);

        const texte = document.createElement('p');
        texte.textContent = data.texte || '';
        div.appendChild(texte);

        galerie.appendChild(div);
      }
    } catch (e) {
      console.error('Erreur de chargement des prompts :', e);
      galerie.innerHTML = `<p style="color:red;">${e.message}</p>`;
    }
  }

  window.onload = chargerPrompts;
</script>
