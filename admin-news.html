<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration du Flux d'Actualités</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Variables CSS du thème principal, assurez la cohérence */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --light-blue: #64B5F6;
            --lighter-blue: #42A5F5;
            --background-grey: #f0f2f5;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            --card-hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #dc3545;
            --postit-yellow: #FFFAA0;
            --light-blue-card: #E0F2F7;
            --grey-text: #555;
            --border-color: #ddd;
            /* Variables pour le Dark Mode - Assurez-vous qu'elles sont cohérentes avec style.css */
            --header-bg: #ffffff;
            --nav-link-color: #333;
            --nav-link-hover-color: var(--primary-blue);
            --active-link-color: var(--primary-blue);
            --dark-mode-bg: #2b2b2b;
            --dark-mode-text: #e0e0e0;
            --dark-mode-card-bg: #3a3a3a;
            --dark-mode-border: #555;
            --dark-mode-input-bg: #444;
            --dark-mode-accent-blue: #0099e6;
        }

        /* Styles Dark Mode - à dupliquer si nécessaire ou s'assurer qu'ils sont dans style.css */
        body.dark-mode {
            background-color: var(--dark-mode-bg);
            color: var(--dark-mode-text);
        }
        body.dark-mode .container,
        body.dark-mode .news-item-editor {
            background-color: var(--dark-mode-card-bg);
            color: var(--dark-mode-text);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode h1, body.dark-mode label {
            color: var(--dark-mode-text);
        }
        body.dark-mode input[type="text"],
        body.dark-mode textarea,
        body.dark-mode select,
        body.dark-mode input[type="color"] {
            background-color: var(--dark-mode-input-bg);
            border-color: var(--dark-mode-border);
            color: var(--dark-mode-text);
        }
        body.dark-mode select:focus,
        body.dark-mode input:focus {
            border-color: var(--dark-mode-accent-blue) !important;
            box-shadow: 0 0 5px rgba(0, 153, 230, 0.5) !important;
        }
        body.dark-mode .btn {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .btn:hover {
            background-color: var(--primary-blue);
        }
        body.dark-mode .btn-secondary {
            background-color: var(--dark-mode-border);
        }
        body.dark-mode .btn-secondary:hover {
            background-color: #6a6a6a;
        }
        body.dark-mode .news-item-editor button.remove-item {
            background-color: #a02a2a;
        }
        body.dark-mode .news-item-editor button.remove-item:hover {
            background-color: #8c2424;
        }
        body.dark-mode .message-box.success {
            background-color: #4CAF50;
            color: white;
        }
        body.dark-mode .message-box.error {
            background-color: #dc3545;
            color: white;
        }


        /* Styles généraux du corps et du conteneur principal (harmonisation avec index.html) */
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Inter', sans-serif; /* Assurez l'utilisation de Inter */
            background-color: var(--background-grey);
            color: #333;
            line-height: 1.6;
            opacity: 0; /* Pour la transition d'affichage JS */
            transition: opacity 0.3s ease-in;
            overflow-x: hidden; /* Empêche le défilement horizontal */
        }
        
        .header {
            text-align: center;
            background: var(--primary-blue); /* Utilise la variable */
            color: white;
            padding: 10px 0;
            width: 100%;
            box-sizing: border-box;
            position: relative;
        }
        .header img.logo-ia {
            width: 90px;
            height: auto;
            margin-bottom: 5px;
        }
        .header img.logo-rtbf {
            width: 60px;
            height: auto;
            margin-top: 5px;
        }
        .header-title {
            font-size: 1.6em;
            margin: 5px 0;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .nav-wrapper {
            background-color: var(--primary-blue);
            width: 100%;
        }
        .menu-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 30px;
            box-sizing: border-box;
            background-color: transparent;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px 0;
            background-color: transparent;
        }
        nav a {
            text-decoration: none;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.3s ease;
            position: relative;
            margin: 0 5px;
            white-space: nowrap;
        }
        nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        nav a.active {
            background-color: white;
            color: var(--primary-blue);
        }
        .notif-bubble {
            position: absolute;
            top: -6px;
            right: -12px;
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            text-align: center;
            line-height: 12px;
            z-index: 2;
            min-width: 15px;
        }
        .dev-button-header {
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 5px 10px;
            background-color: var(--dark-blue);
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease;
            z-index: 10;
        }
        .dev-button-header:hover {
            background-color: var(--primary-blue);
            transform: translateY(-1px);
        }
        @media (max-width: 1024px) {
            .header { padding: 10px 0; }
            .header img.logo-ia, .header img.logo-rtbf { width: 80px; }
            .header-title { font-size: 1.4em; }
            .dev-button-header { font-size: 0.75em; padding: 5px 10px; }
            nav { justify-content: center; padding: 5px 10px; }
            nav a { flex-basis: auto; min-width: unset; margin: 5px 8px; padding: 7px 10px; font-size: 0.95em; }
        }
        @media (max-width: 768px) {
            .header { padding: 8px 0; }
            .header img.logo-ia { width: 70px; }
            .header img.logo-rtbf { width: 50px; }
            .header-title { font-size: 1.2em; }
            .dev-button-header { font-size: 0.7em; padding: 4px 8px; }
            nav { padding: 5px; }
            nav a { font-size: 0.9em; padding: 6px 8px; margin: 4px 6px; }
        }

        /* Styles spécifiques à cette page d'administration */
        main {
            flex-grow: 1; /* Permet au main de prendre l'espace disponible */
            padding: 20px; /* Padding ajusté */
            background-color: var(--background-grey); /* Couleur de fond cohérente */
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-blue);
        }
        .form-group input[type="text"],
        .form-group textarea,
        .form-group select,
        .form-group input[type="color"] { /* Style pour le sélecteur de couleur */
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        .form-group input[type="color"] {
            width: 80px; 
            padding: 5px;
            height: 40px;
            cursor: pointer;
        }
        .form-group textarea {
            resize: vertical; 
            min-height: 80px;
        }
        .form-actions {
            text-align: right;
            margin-top: 30px;
        }
        .btn {
            background-color: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
            margin-left: 10px;
        }
        .btn:hover {
            background-color: var(--dark-blue);
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .news-item-editor {
            border: 1px solid #eee;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
            position: relative;
        }
        .news-item-editor button.remove-item {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 1em;
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            line-height: 1;
            text-align: center;
            transition: background-color 0.2s ease;
        }
        .news-item-editor button.remove-item:hover {
            background-color: #c82333;
        }
        .message-box {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        /* Style pour le footer */
        .footer {
            margin-top: auto; /* Pousse le footer vers le bas */
            padding: 20px;
            text-align: center;
            background-color: var(--dark-blue);
            color: white;
            font-size: 0.9em;
        }

        /* Media Queries spécifiques à cette page pour harmonisation */
        @media (max-width: 768px) {
            .container {
                margin: 20px auto;
                padding: 20px;
            }
            .form-group input[type="text"],
            .form-group textarea,
            .form-group select {
                width: 100%; /* Pas de calc pour éviter les problèmes sur petits écrans */
            }
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div class="container">
            <h1>Administration du Flux d'Actualités</h1>

            <div id="messageBox" class="message-box"></div>

            <div id="newsItemsContainer">
                </div>

            <div class="form-actions">
                <button type="button" id="addNewsItem" class="btn btn-secondary">Ajouter un Article</button>
                <button type="submit" id="saveNews" class="btn">Sauvegarder le Flux</button>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        const NEWS_DATA_PATH = 'news-data.json';
        const SAVE_NEWS_FUNCTION_URL = '/.netlify/functions/saveNews';

        let newsItems = []; 

        const newsItemsContainer = document.getElementById('newsItemsContainer');
        const addNewsItemButton = document.getElementById('addNewsItem');
        const saveNewsButton = document.getElementById('saveNews');
        const messageBox = document.getElementById('messageBox');

        // --- Récupération des listes Pôle et Collaborateurs depuis l'autre script (simulé ici) ---
        // Dans une vraie application, ces listes seraient chargées depuis une source centrale.
        // Pour cet exemple, je vais les définir ici comme elles sont dans votre code de licences.
        // C'est une duplication, mais simplifie l'exemple sans nécessiter un fichier JS partagé complexe.
        const collaborateursParPole = {
            "Pôle créa.": [
                "Anne-Françoise LELEUX", "Baptiste TARTAS", "Béatrice MARLIER",
                "Boris TEIRLYNCK", "Charlotte DELWARTE", "Céline DELENTREE", "Delphine BENROUBI",
                "Faiza BOUMEDIAN", "Geneviève DE BEAUFFORT", "Giovanni CASCONE",
                "Gregory KEPPENS", "Isabelle MARCHAL", "Isabelle VERTUONGEN",
                "Jimmy DEGRÈVE", "Joel VAN HOEF", "Jonathan LACROIX",
                "Jose ROJO", "Jose-Luis PENAFUERTE", "Mehdi HUSAIN",
                "Michael EVRARD", "Patricia DAVIA", "Pierre LERMIER",
                "Pierre-Jean GILOUX", "Steeve PIRES MADEIRA",
                "Susana GONCALVES VALERIO",
                "Tyan HOOGSTOEL", "Vinciane LE MEN",
                "Sabrina LECLERCQ",
                "Nathalie AUBRY",
                "Jeremy DEHERTOGH",
                "Dominique LEFEVRE",
                "Virginie LONGE"
            ].sort(),
            "CRM": [
                "Frédéric CARTON", "Inès BERNOUX", "Noémie ROSSEY",
                "Yasmine AIT MASKOUR"
            ].sort(),
            "Communication": [
                "Aurore CRABBE", "Elvis TCHANA", "Fabienne CULLUS",
                "Marie NAUWELAERTS", "Régine CARPENTIER"
            ].sort(),
            "Partenariats": [
                "Alinoe VANHAUDENHUYSE", "Catherine CARA", "Dominique CAFFIERS",
                "Fiona KOPEINIG", "Isabelle DELENS",
                "Laura DONATELLO", "Marie-Rose ANGE", "Naïm EL BOHALI",
                "Nathalie DE RIJCKE"
            ].sort(),
            "Marketing digital": [
                "Elise FONCK", "Gaëlle DEGEYE",
                "Mathilde ARMILLAC", "Morgane CARLY", "Yasmine GHAZOUANE",
                "Sara GARCIA"
            ].sort(),
            "Positionnement": [
                "Amelie DE LANGE", "Philippe BLANJEAN",
                "Samuel LALOUX"
            ].sort(),
            "Staff": [
                "Meltem SIVLIN", "Nadia CURTO", "Vincent CRABBE",
                "Olivier LEIDGENS", "Pierre DUBOIS", "Vitold GRAND'HENRY",
                "Romain DELECOUR", "Noemie GORISSEN"
            ].sort()
        };
        const poles = Object.keys(collaborateursParPole).sort();
        poles.unshift("Autre"); // Ajout de l'option "Autre"
        // --- FIN Récupération des listes ---


        // Couleurs par défaut à suggérer ou pour les nouveaux articles
        const defaultColors = [
            "#0077b6", "#FFD700", "#FF4500", "#32CD32", "#8A2BE2",
            "#00BFFF", "#FF69B4", "#7FFF00", "#FFC0CB", "#D8BFD8"
        ]; 

        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000); 
        }

        function createNewsItemEditor(item = { title: '', url: '', source: '', pole: '', collaborateur: '', color: '' }, index) {
            const editorDiv = document.createElement('div');
            editorDiv.className = 'news-item-editor';
            editorDiv.dataset.index = index;

            // Assurer des valeurs par défaut pour les nouveaux articles
            item.pole = item.pole || poles[0]; 
            item.collaborateur = item.collaborateur || collaborateursParPole[item.pole]?.[0] || 'Non spécifié';
            item.color = item.color || defaultColors[Math.floor(Math.random() * defaultColors.length)];

            // Générer les options pour le sélecteur de pôle
            const poleOptions = poles.map(p => `<option value="${p}" ${item.pole === p ? 'selected' : ''}>${p}</option>`).join('');
            
            // Générer les options pour le sélecteur de collaborateur basé sur le pôle actuel de l'item
            let currentCollaborateurs = collaborateursParPole[item.pole] || [];
            if (!currentCollaborateurs.includes(item.collaborateur) && item.collaborateur !== 'Non spécifié') {
                 // Si le collaborateur de l'item n'est pas dans la liste, l'ajouter comme option unique
                currentCollaborateurs = [item.collaborateur, ...currentCollaborateurs].sort();
            }
            const collaborateurOptions = currentCollaborateurs.map(c => `<option value="${c}" ${item.collaborateur === c ? 'selected' : ''}>${c}</option>`).join('');


            editorDiv.innerHTML = `
                <div class="form-group">
                    <label for="title-${index}">Titre de l'actualité :</label>
                    <textarea id="title-${index}" rows="2">${item.title}</textarea>
                </div>
                <div class="form-group">
                    <label for="url-${index}">URL (lien, optionnel) :</label>
                    <input type="text" id="url-${index}" value="${item.url}">
                </div>
                <div class="form-group">
                    <label for="source-${index}">Source (ex: nom du média ou équipe, optionnel) :</label>
                    <input type="text" id="source-${index}" value="${item.source}">
                </div>
                <div class="form-group">
                    <label for="pole-${index}">Pôle :</label>
                    <select id="pole-${index}">${poleOptions}</select>
                </div>
                <div class="form-group">
                    <label for="collaborateur-${index}">Collaborateur :</label>
                    <select id="collaborateur-${index}">${collaborateurOptions}</select>
                </div>
                <div class="form-group">
                    <label for="color-${index}">Couleur du texte :</label>
                    <input type="color" id="color-${index}" value="${item.color}">
                </div>
                <button type="button" class="remove-item">X</button>
            `;

            const removeButton = editorDiv.querySelector('.remove-item');
            removeButton.addEventListener('click', () => {
                removeNewsItem(index);
            });

            // Gérer la mise à jour des collaborateurs quand le pôle change dans un éditeur spécifique
            const poleSelectEditor = editorDiv.querySelector(`#pole-${index}`);
            poleSelectEditor.addEventListener('change', function() {
                const currentId = parseInt(editorDiv.dataset.index);
                const selectedPole = this.value;
                const collaborateurSelectEditor = editorDiv.querySelector(`#collaborateur-${currentId}`);
                
                updateCollaborateurOptionsInEditor(collaborateurSelectEditor, selectedPole);
                
                // Mettre à jour l'item dans le tableau newsItems
                newsItems[currentId].pole = selectedPole;
                newsItems[currentId].collaborateur = collaborateurSelectEditor.value; // Défaut le premier du nouveau pôle
            });


            editorDiv.querySelectorAll('textarea, input, select').forEach(input => {
                input.addEventListener('input', () => {
                    const currentId = parseInt(editorDiv.dataset.index);
                    if (newsItems[currentId]) {
                        newsItems[currentId].title = document.getElementById(`title-${currentId}`).value;
                        newsItems[currentId].url = document.getElementById(`url-${currentId}`).value;
                        newsItems[currentId].source = document.getElementById(`source-${currentId}`).value;
                        // Pole et Collaborateur sont mis à jour via l'écouteur de change du select du pôle,
                        // mais on peut aussi les capturer ici au cas où l'input change manuellement (pas select)
                        newsItems[currentId].pole = document.getElementById(`pole-${currentId}`).value;
                        newsItems[currentId].collaborateur = document.getElementById(`collaborateur-${currentId}`).value;
                        newsItems[currentId].color = document.getElementById(`color-${currentId}`).value;
                    }
                });
            });

            return editorDiv;
        }
        
        // Fonction utilitaire pour mettre à jour les options de collaborateur dans un sélecteur donné
        function updateCollaborateurOptionsInEditor(selectElement, selectedPole) {
            selectElement.innerHTML = ''; // Vide les options existantes
            const collabsForPole = collaborateursParPole[selectedPole] || [];
            
            if (collabsForPole.length === 0) {
                const option = document.createElement('option');
                option.value = 'Non spécifié';
                option.textContent = 'Non spécifié';
                selectElement.appendChild(option);
            } else {
                collabsForPole.forEach(collab => {
                    const option = document.createElement('option');
                    option.value = collab;
                    option.textContent = collab;
                    selectElement.appendChild(option);
                });
            }
            // Sélectionne le premier collaborateur ou 'Non spécifié'
            selectElement.value = collabsForPole[0] || 'Non spécifié';
        }


        function addNewsItem() {
            const newItem = { 
                title: '', 
                url: '', 
                source: '', 
                pole: poles[0], 
                collaborateur: collaborateursParPole[poles[0]]?.[0] || 'Non spécifié', 
                color: defaultColors[Math.floor(Math.random() * defaultColors.length)] 
            };
            newsItems.push(newItem);
            renderNewsItems(); 
            const editor = newsItemsContainer.lastElementChild; 
            if (editor) {
                editor.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }

        function removeNewsItem(indexToRemove) {
            newsItems.splice(indexToRemove, 1); 
            renderNewsItems(); 
        }

        function renderNewsItems() {
            newsItemsContainer.innerHTML = ''; 
            newsItems.forEach((item, index) => {
                const editor = createNewsItemEditor(item, index);
                newsItemsContainer.appendChild(editor);
            });
            updateEditorIndexes(); 
        }

        function updateEditorIndexes() {
            newsItemsContainer.querySelectorAll('.news-item-editor').forEach((editorDiv, newIndex) => {
                editorDiv.dataset.index = newIndex;
                editorDiv.querySelector('textarea[id^="title-"]').id = `title-${newIndex}`;
                editorDiv.querySelector('label[for^="title-"]').setAttribute('for', `title-${newIndex}`);
                editorDiv.querySelector('input[id^="url-"]').id = `url-${newIndex}`;
                editorDiv.querySelector('label[for^="url-"]').setAttribute('for', `url-${newIndex}`);
                editorDiv.querySelector('input[id^="source-"]').id = `source-${newIndex}`;
                editorDiv.querySelector('label[for^="source-"]').setAttribute('for', `source-${newIndex}`);
                editorDiv.querySelector('select[id^="pole-"]').id = `pole-${newIndex}`;
                editorDiv.querySelector('label[for^="pole-"]').setAttribute('for', `pole-${newIndex}`);
                editorDiv.querySelector('select[id^="collaborateur-"]').id = `collaborateur-${newIndex}`;
                editorDiv.querySelector('label[for^="collaborateur-"]').setAttribute('for', `collaborateur-${newIndex}`);
                editorDiv.querySelector('input[id^="color-"]').id = `color-${newIndex}`;
                editorDiv.querySelector('label[for^="color-"]').setAttribute('for', `color-${newIndex}`);
                
                // Mettre à jour l'écouteur du bouton de suppression pour le nouvel index
                const removeButton = editorDiv.querySelector('.remove-item');
                removeButton.onclick = null; 
                removeButton.addEventListener('click', () => {
                    removeNewsItem(newIndex); 
                });

                 // Mettre à jour l'écouteur de changement de pôle pour le nouvel index
                const poleSelectEditor = editorDiv.querySelector(`#pole-${newIndex}`);
                poleSelectEditor.onchange = null; // Supprime l'ancien écouteur
                poleSelectEditor.addEventListener('change', function() {
                    const selectedPole = this.value;
                    const collaborateurSelectEditor = editorDiv.querySelector(`#collaborateur-${newIndex}`);
                    updateCollaborateurOptionsInEditor(collaborateurSelectEditor, selectedPole);
                    newsItems[newIndex].pole = selectedPole;
                    newsItems[newIndex].collaborateur = collaborateurSelectEditor.value;
                });
            });
        }

        async function loadExistingNews() {
            try {
                const response = await fetch(`/${NEWS_DATA_PATH}`); 
                if (response.ok) {
                    newsItems = await response.json();
                    // Assurez-vous que les anciens articles ont les nouvelles propriétés par défaut
                    newsItems = newsItems.map(item => ({
                        // Ajoutez des valeurs par défaut pour les nouvelles propriétés si elles n'existent pas
                        pole: item.pole || poles[0],       
                        collaborateur: item.collaborateur || collaborateursParPole[item.pole]?.[0] || 'Non spécifié', 
                        color: item.color || defaultColors[Math.floor(Math.random() * defaultColors.length)],
                        ...item // Les propriétés existantes écrasent les défauts si elles existent
                    }));
                    renderNewsItems();
                    showMessage('Flux d\'actualités existant chargé.', 'success');
                } else if (response.status === 404) {
                    showMessage('Aucun flux d\'actualités existant trouvé. Commencez à ajouter des articles !', 'info');
                    addNewsItem(); 
                } else {
                    throw new Error(`Erreur lors du chargement des articles : ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                showMessage(`Erreur lors du chargement : ${error.message}.`, 'error');
                console.error("Erreur de chargement du flux existant:", error);
                addNewsItem(); 
            }
        }

        async function saveNews() {
            saveNewsButton.disabled = true;
            saveNewsButton.textContent = 'Sauvegarde en cours...';
            messageBox.style.display = 'none';

            try {
                const response = await fetch(SAVE_NEWS_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newsItems)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Échec de la sauvegarde : ${response.status} ${response.statusText} - ${errorText}`);
                }

                const result = await response.json();
                showMessage(`Flux sauvegardé avec succès ! Le site sera mis à jour dans quelques minutes. (${result.message})`, 'success');

            } catch (error) {
                showMessage(`Erreur de sauvegarde : ${error.message}`, 'error');
                console.error("Erreur de sauvegarde du flux:", error);
            } finally {
                saveNewsButton.disabled = false;
                saveNewsButton.textContent = 'Sauvegarder le Flux';
            }
        }

        addNewsItemButton.addEventListener('click', addNewsItem);
        saveNewsButton.addEventListener('click', saveNews);

        // Charger les composants header et footer
        async function loadComponents() {
            const headerPlaceholder = document.getElementById("header-placeholder");
            const footerPlaceholder = document.getElementById("footer-placeholder");
            try {
                // Charge le header (peut être un fichier header.html ou directement du HTML)
                // Assurez-vous que l'URL est correcte ou insérez le HTML directement si vous n'avez pas de fichier séparé
                const headerResponse = await fetch("header.html"); // Assurez-vous d'avoir un header.html ou remplacez par le contenu HTML
                if (headerResponse.ok) {
                    headerPlaceholder.innerHTML = await headerResponse.text();
                } else {
                    console.error("Erreur de chargement du header.html:", headerResponse.statusText);
                    // Fallback si header.html n'existe pas ou erreur
                    headerPlaceholder.innerHTML = `
                        <div class="header">
                            <img src="log_ia.png" alt="Logo IA Marketing" class="logo-ia">
                            <h1 class="header-title">IA MARKETING</h1> 
                            <img src="Section-Clients-Logo-RTBF.png" alt="Logo RTBF" class="logo-rtbf">
                            <a href="about.html" class="dev-button-header">DEV</a>
                        </div>
                        <div class="nav-wrapper">
                            <div class="menu-container">
                                <nav>
                                    <a href="index.html">Accueil</a>
                                    <a href="equipe.html">Équipe</a>
                                    <a href="outils.html">Outils IA</a>
                                    <a href="galerie.html">Galerie</a>
                                    <a href="Cas-usages.html">Tips</a>
                                    <a href="veille.html">Veille</a>
                                    <a href="charte.html">Charte IA</a>
                                    <a href="faq.html">FAQ</a>
                                    <a href="demandes_ia.html" class="demandes">
                                        Demandes IA
                                        <span class="notif-bubble" id="notif-count">0</span>
                                    </a>
                                    <a href="admin-news.html" class="active">Admin News</a>
                                    <a href="gestion-license.html">Licenses</a>
                                </nav>
                            </div>
                        </div>
                    `;
                }

                const footerResponse = await fetch("footer.html"); // Assurez-vous d'avoir un footer.html ou remplacez par le contenu HTML
                if (footerResponse.ok) {
                    footerPlaceholder.innerHTML = await footerResponse.text();
                } else {
                    console.error("Erreur de chargement du footer.html:", footerResponse.statusText);
                    // Fallback
                    footerPlaceholder.innerHTML = `<div class="footer">© 2025 Espace IA Marketing. Tous droits réservés.</div>`;
                }

                // Initialiser le mode sombre si vous l'avez dans le header/footer
                const darkModeToggle = document.getElementById('darkModeToggle');
                if (darkModeToggle) {
                    // Si votre header.html contient le script darkModeToggle, il s'initialisera seul.
                    // Sinon, vous pouvez mettre ici la logique initializeDarkMode() si elle est définie globalement.
                }

                // Mettre à jour l'état actif du menu après le chargement du header
                const currentPath = window.location.pathname.split('/').pop();
                document.querySelectorAll('nav a').forEach(link => {
                    const linkHref = link.getAttribute('href');
                    const linkFileName = linkHref ? linkHref.split('/').pop() : '';
                    if (linkFileName === currentPath || (currentPath === "" && linkFileName === "index.html")) {
                        link.classList.add("active");
                    } else {
                        link.classList.remove("active");
                    }
                });

            } catch (error) {
                console.error("Erreur lors du chargement des composants:", error);
            }
        }


        document.addEventListener('DOMContentLoaded', async () => {
            await loadComponents(); // Charger le header et le footer en premier
            loadExistingNews(); // Puis charger le contenu spécifique à la page

            // Afficher le corps de la page après le chargement initial
            document.body.style.opacity = "1";
            const mainElement = document.querySelector("main");
            if (mainElement) {
                mainElement.style.display = "block";
            }
        });
    </script>
</body>
</html>
