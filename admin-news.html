<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter une Actualité au Flux</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Variables CSS du thème principal, assurez la cohérence */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --light-blue: #64B5F6;
            --lighter-blue: #42A5F5;
            --background-grey: #f0f2f5;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            --card-hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #dc3545;
            --postit-yellow: #FFFAA0;
            --light-blue-card: #E0F2F7;
            --grey-text: #555;
            --border-color: #ddd;
            /* Variables pour le Dark Mode - Assurez-vous qu'elles sont cohérentes avec style.css */
            --header-bg: #ffffff;
            --nav-link-color: #333;
            --nav-link-hover-color: var(--primary-blue);
            --active-link-color: var(--primary-blue);
            --dark-mode-bg: #2b2b2b;
            --dark-mode-text: #e0e0e0;
            --dark-mode-card-bg: #3a3a3a;
            --dark-mode-border: #555;
            --dark-mode-input-bg: #444;
            --dark-mode-accent-blue: #0099e6;
        }

        /* Styles Dark Mode */
        body.dark-mode {
            background-color: var(--dark-mode-bg);
            color: var(--dark-mode-text);
        }
        body.dark-mode .container,
        body.dark-mode .current-news-section,
        body.dark-mode .news-item-display { /* Ajout pour le style du tableau de messages */
            background-color: var(--dark-mode-card-bg);
            color: var(--dark-mode-text);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode h1, body.dark-mode h2 {
            color: var(--dark-mode-text);
        }
        body.dark-mode input[type="text"],
        body.dark-mode textarea,
        body.dark-mode select {
            background-color: var(--dark-mode-input-bg);
            border-color: var(--dark-mode-border);
            color: var(--dark-mode-text);
        }
        body.dark-mode select:focus,
        body.dark-mode input:focus {
            border-color: var(--dark-mode-accent-blue) !important;
            box-shadow: 0 0 5px rgba(0, 153, 230, 0.5) !important;
        }
        body.dark-mode .btn {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .btn:hover {
            background-color: var(--primary-blue);
        }
        body.dark-mode .btn-secondary {
            background-color: var(--dark-mode-border);
        }
        body.dark-mode .btn-secondary:hover {
            background-color: #6a6a6a;
        }
        body.dark-mode .message-box.success {
            background-color: #4CAF50;
            color: white;
        }
        body.dark-mode .message-box.error {
            background-color: #dc3545;
            color: white;
        }
        body.dark-mode .news-item-display {
            border-color: var(--dark-mode-border);
        }
        body.dark-mode .news-item-display .delete-item-btn {
            color: var(--error-text);
        }


        /* Styles généraux du corps et du conteneur principal (harmonisation avec index.html) */
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
            background-color: var(--background-grey);
            color: #333;
            line-height: 1.6;
            opacity: 0; 
            transition: opacity 0.3s ease-in;
            overflow-x: hidden;
        }
        
        /* Header et Navigation - Copiés de index.html pour la cohérence */
        .header {
            text-align: center;
            background: var(--primary-blue);
            color: white;
            padding: 10px 0;
            width: 100%;
            box-sizing: border-box;
            position: relative;
        }
        .header img.logo-ia {
            width: 90px;
            height: auto;
            margin-bottom: 5px;
        }
        .header img.logo-rtbf {
            width: 60px;
            height: auto;
            margin-top: 5px;
        }
        .header-title {
            font-size: 1.6em;
            margin: 5px 0;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .nav-wrapper {
            background-color: var(--primary-blue);
            width: 100%;
        }
        .menu-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 30px;
            box-sizing: border-box;
            background-color: transparent;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px 0;
            background-color: transparent;
        }
        nav a {
            text-decoration: none;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.3s ease;
            position: relative;
            margin: 0 5px;
            white-space: nowrap;
        }
        nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        nav a.active {
            background-color: white;
            color: var(--primary-blue);
        }
        .notif-bubble {
            position: absolute;
            top: -6px;
            right: -12px;
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            text-align: center;
            line-height: 12px;
            z-index: 2;
            min-width: 15px;
        }
        .dev-button-header {
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 5px 10px;
            background-color: var(--dark-blue);
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease;
            z-index: 10;
        }
        .dev-button-header:hover {
            background-color: var(--primary-blue);
            transform: translateY(-1px);
        }
        @media (max-width: 1024px) {
            .header { padding: 10px 0; }
            .header img.logo-ia, .header img.logo-rtbf { width: 80px; }
            .header-title { font-size: 1.4em; }
            .dev-button-header { font-size: 0.75em; padding: 5px 10px; }
            nav { justify-content: center; padding: 5px 10px; }
            nav a { flex-basis: auto; min-width: unset; margin: 5px 8px; padding: 7px 10px; font-size: 0.95em; }
        }
        @media (max-width: 768px) {
            .header { padding: 8px 0; }
            .header img.logo-ia { width: 70px; }
            .header img.logo-rtbf { width: 50px; }
            .header-title { font-size: 1.2em; }
            .dev-button-header { font-size: 0.7em; padding: 4px 8px; }
            nav { padding: 5px; }
            nav a { font-size: 0.9em; padding: 6px 8px; margin: 4px 6px; }
        }

        /* Styles spécifiques au contenu de cette page */
        main {
            flex-grow: 1; 
            padding: 20px; 
            background-color: var(--background-grey); 
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1, h2 { 
            text-align: center;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-blue);
        }
        .form-group textarea,
        .form-group select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
            resize: vertical; 
            min-height: 80px;
        }
        .form-group select {
            min-height: 40px; 
        }
        .form-actions {
            text-align: right;
            margin-top: 30px;
        }
        .btn {
            background-color: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
            margin-left: 10px;
        }
        .btn:hover {
            background-color: var(--dark-blue);
        }
        .btn:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        .message-box {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: bold;
            display: none; 
        }
        .message-box.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message-box.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        /* Style pour le footer */
        .footer {
            margin-top: auto; 
            padding: 20px;
            text-align: center;
            background-color: var(--dark-blue);
            color: white;
            font-size: 0.9em;
        }

        /* Styles pour l'affichage des messages existants */
        .current-news-section {
            max-width: 600px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .news-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }
        .news-item-display {
            border: 1px solid #eee;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #555;
        }
        .news-item-display .news-text {
            flex-grow: 1;
            margin-right: 10px;
        }
        .news-item-display .delete-item-btn {
            background: none;
            border: none;
            color: #dc3545;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0 5px; 
            transition: transform 0.2s ease;
        }
        .news-item-display .delete-item-btn:hover {
            transform: scale(1.2);
        }
        /* NOUVEAU STYLE POUR news-item-meta-details */
        .news-item-meta-details {
            font-size: 0.8em;
            color: #888;
            white-space: nowrap; 
            text-align: right;
            min-width: 150px; 
            display: flex; /* Utilise flexbox pour aligner verticalement les spans */
            flex-direction: column; /* Les empile verticalement */
            align-items: flex-end; /* Aligner les éléments à droite */
            margin-left: 10px; /* Espace par rapport au texte principal */
        }
        .news-item-meta-details strong {
            font-weight: bold;
        }
        .news-item-meta-details .item-details-line { /* Pour chaque ligne de détails */
            white-space: nowrap;
        }


        /* Media Queries spécifiques pour cette page */
        @media (max-width: 768px) {
            .container, .current-news-section {
                margin: 20px auto;
                padding: 20px;
            }
            .form-group textarea,
            .form-group select {
                width: 100%;
            }
            .news-item-display {
                flex-direction: column; 
                align-items: flex-start;
            }
            .news-item-display .news-text {
                margin-right: 0;
                margin-bottom: 5px;
                width: 100%; 
            }
            .news-item-meta-details { /* Ajustement pour mobile */
                text-align: left;
                width: 100%;
                min-width: unset;
                margin-left: 0;
            }
            .news-item-display .delete-item-btn {
                position: absolute; 
                top: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>

    <main>
        <div class="container">
            <h1>Ajouter une Actualité au Flux</h1>

            <div id="messageBox" class="message-box"></div>

            <form id="newsForm">
                <div class="form-group">
                    <label for="poleSelect">Pôle :</label>
                    <select id="poleSelect" required></select>
                </div>
                <div class="form-group">
                    <label for="collaborateurSelect">Collaborateur :</label>
                    <select id="collaborateurSelect" required></select>
                </div>
                <div class="form-group">
                    <label for="newsMessage">Message :</label>
                    <textarea id="newsMessage" rows="4" required placeholder="Tapez votre message ici..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" id="addNewsButton" class="btn">Ajouter au Flux</button>
                </div>
            </form>
        </div>

        <div class="current-news-section">
            <h2>Messages Actuels du Flux</h2>
            <ul id="currentNewsList" class="news-list">
                </ul>
            <button type="button" id="refreshNewsList" class="btn btn-secondary">Actualiser la liste</button>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script>
        const NEWS_DATA_PATH = 'news-data.json';
        const ADD_NEWS_FUNCTION_URL = '/.netlify/functions/addNews'; 
        const DELETE_NEWS_FUNCTION_URL = '/.netlify/functions/deleteNews';

        const newsForm = document.getElementById('newsForm');
        const poleSelect = document.getElementById('poleSelect');
        const collaborateurSelect = document.getElementById('collaborateurSelect');
        const newsMessage = document.getElementById('newsMessage');
        const addNewsButton = document.getElementById('addNewsButton');
        const messageBox = document.getElementById('messageBox');
        const currentNewsList = document.getElementById('currentNewsList');
        const refreshNewsListButton = document.getElementById('refreshNewsList');

        const collaborateursParPole = {
            "Pôle créa.": [
                "Anne-Françoise LELEUX", "Baptiste TARTAS", "Béatrice MARLIER",
                "Boris TEIRLYNCK", "Charlotte DELWARTE", "Céline DELENTREE", "Delphine BENROUBI",
                "Faiza BOUMEDIAN", "Geneviève DE BEAUFFORT", "Giovanni CASCONE",
                "Gregory KEPPENS", "Isabelle MARCHAL", "Isabelle VERTUONGEN",
                "Jimmy DEGRÈVE", "Joel VAN HOEF", "Jonathan LACROIX",
                "Jose ROJO", "Jose-Luis PENAFUERTE", "Mehdi HUSAIN",
                "Michael EVRARD", "Patricia DAVIA", "Pierre LERMIER",
                "Pierre-Jean GILOUX", "Steeve PIRES MADEIRA",
                "Susana GONCALVES VALERIO",
                "Tyan HOOGSTOEL", "Vinciane LE MEN",
                "Sabrina LECLERCQ",
                "Nathalie AUBRY",
                "Jeremy DEHERTOGH",
                "Dominique LEFEVRE",
                "Virginie LONGE"
            ].sort(),
            "CRM": [
                "Frédéric CARTON", "Inès BERNOUX", "Noémie ROSSEY",
                "Yasmine AIT MASKOUR"
            ].sort(),
            "Communication": [
                "Aurore CRABBE", "Elvis TCHANA", "Fabienne CULLUS",
                "Marie NAUWELAERTS", "Régine CARPENTIER"
            ].sort(),
            "Partenariats": [
                "Alinoe VANHAUDENHUYSE", "Catherine CARA", "Dominique CAFFIERS",
                "Fiona KOPEINIG", "Isabelle DELENS",
                "Laura DONATELLO", "Marie-Rose ANGE", "Naïm EL BOHALI",
                "Nathalie DE RIJCKE"
            ].sort(),
            "Marketing digital": [
                "Elise FONCK", "Gaëlle DEGEYE",
                "Mathilde ARMILLAC", "Morgane CARLY", "Yasmine GHAZOUANE",
                "Sara GARCIA"
            ].sort(),
            "Positionnement": [
                "Amelie DE LANGE", "Philippe BLANJEAN",
                "Samuel LALOUX"
            ].sort(),
            "Staff": [
                "Meltem SIVLIN", "Nadia CURTO", "Vincent CRABBE",
                "Olivier LEIDGENS", "Pierre DUBOIS", "Vitold GRAND'HENRY",
                "Romain DELECOUR", "Noemie GORISSEN"
            ].sort()
        };
        const poles = Object.keys(collaborateursParPole).sort();
        poles.unshift("Autre"); 

        const defaultColorsByPole = {
            "Pôle créa.": "#FF6347",     
            "CRM": "#4682B4",            
            "Communication": "#32CD32",  
            "Partenariats": "#FFD700",   
            "Marketing digital": "#9370DB", 
            "Positionnement": "#20B2AA", 
            "Staff": "#A9A9A9",          
            "Autre": "#808080"           
        };


        function showMessage(message, type) {
            messageBox.textContent = message;
            messageBox.className = `message-box ${type}`;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000); 
        }

        function populateSelectors() {
            poles.forEach(pole => {
                const option = document.createElement('option');
                option.value = pole;
                option.textContent = pole;
                poleSelect.appendChild(option);
            });
            updateCollaborators(); 
        }

        function updateCollaborators() {
            const selectedPole = poleSelect.value;
            collaborateurSelect.innerHTML = ''; 
            
            const collabsForPole = collaborateursParPole[selectedPole] || [];
            
            if (collabsForPole.length === 0) {
                const option = document.createElement('option');
                option.value = 'Non spécifié';
                option.textContent = 'Non spécifié';
                collaborateurSelect.appendChild(option);
            } else {
                collabsForPole.forEach(collab => {
                    const option = document.createElement('option');
                    option.value = collab;
                    option.textContent = collab;
                    collaborateurSelect.appendChild(option);
                });
            }
            collaborateurSelect.value = collabsForPole[0] || 'Non spécifié';
        }

        async function addNewsItem(event) {
            event.preventDefault(); 
            addNewsButton.disabled = true;
            addNewsButton.textContent = 'Ajout en cours...';
            messageBox.style.display = 'none';

            const title = newsMessage.value.trim();
            const pole = poleSelect.value;
            const collaborateur = collaborateurSelect.value;
            const color = defaultColorsByPole[pole] || '#333'; 

            if (!title || !pole || !collaborateur) {
                showMessage('Veuillez sélectionner un pôle, un collaborateur et taper un message.', 'error');
                addNewsButton.disabled = false;
                addNewsButton.textContent = 'Ajouter au Flux';
                return;
            }

            const newsItem = {
                title: title,
                pole: pole,
                collaborateur: collaborateur,
                color: color
            };

            try {
                const response = await fetch(ADD_NEWS_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newsItem)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Échec de l'ajout : ${response.status} ${response.statusText} - ${errorText}`);
                }

                const result = await response.json();
                showMessage(`Actualité ajoutée avec succès ! Le site sera mis à jour dans quelques minutes. (${result.message})`, 'success');
                newsMessage.value = ''; 
                poleSelect.value = poles[0]; 
                updateCollaborators(); 
                loadCurrentNewsItems(); // Recharger la liste après un ajout
                
            } catch (error) {
                showMessage(`Erreur lors de l'ajout : ${error.message}`, 'error');
                console.error("Erreur lors de l'ajout au flux:", error);
            } finally {
                addNewsButton.disabled = false;
                addNewsButton.textContent = 'Ajouter au Flux';
            }
        }

        async function deleteNewsItem(timestampToDelete) { 
            if (!confirm("Êtes-vous sûr de vouloir supprimer cette actualité ?")) {
                return;
            }
            showMessage('Suppression en cours...', 'info');

            try {
                const response = await fetch(DELETE_NEWS_FUNCTION_URL, {
                    method: 'POST', 
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ timestamp: timestampToDelete }) 
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Échec de la suppression : ${response.status} ${response.statusText} - ${errorText}`);
                }

                const result = await response.json();
                showMessage(`Actualité supprimée avec succès ! Le site sera mis à jour dans quelques minutes. (${result.message})`, 'success');
                loadCurrentNewsItems(); // Recharger la liste après une suppression

            } catch (error) {
                showMessage(`Erreur lors de la suppression : ${error.message}`, 'error');
                console.error("Erreur lors de la suppression du flux:", error);
            }
        }

        // Fonction pour charger et afficher les messages actuels dans le panneau
        async function loadCurrentNewsItems() {
            currentNewsList.innerHTML = '<li>Chargement des messages actuels...</li>';
            try {
                const response = await fetch(`/${NEWS_DATA_PATH}?t=${Date.now()}`); // Ajout d'un timestamp pour éviter le cache
                if (response.ok) {
                    let newsItems = await response.json();
                    if (!Array.isArray(newsItems)) {
                        console.warn("Le fichier news-data.json n'est pas un tableau, tentative de conversion.");
                        newsItems = Object.values(newsItems);
                    }

                    // Filtrer les articles de plus de 48 heures CÔTÉ CLIENT pour un affichage immédiat plus précis
                    const fortyEightHoursAgo = new Date(Date.now() - 48 * 60 * 60 * 1000);
                    newsItems = newsItems.filter(item => {
                        return !item.timestamp || new Date(item.timestamp) > fortyEightHoursAgo;
                    });


                    if (newsItems.length === 0) {
                        currentNewsList.innerHTML = '<li>Aucun message actif dans le flux pour le moment.</li>';
                        return;
                    }

                    // Trier par timestamp (le plus récent en premier)
                    newsItems.sort((a, b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0));

                    currentNewsList.innerHTML = ''; 
                    newsItems.forEach((item) => { 
                        const li = document.createElement('li');
                        li.className = 'news-item-display';
                        
                        const itemAge = new Date(item.timestamp);
                        const now = new Date();
                        const diffHours = Math.floor((now - itemAge) / (1000 * 60 * 60));
                        const remainingHours = 48 - diffHours;
                        
                        // CONSTRUIRE LE CONTENU SELON LE FORMAT SOUHAITÉ
                        let itemTitleHtml = `<span style="color: ${item.color || '#333'};">${item.title || 'Titre inconnu'}</span>`;
                        let itemMetaDetails = '';
                        if (item.collaborateur || item.pole) {
                            let details = [];
                            if (item.collaborateur) details.push(item.collaborateur); // Collaborateur d'abord
                            if (item.pole) details.push(`<i>${item.pole}</i>`); // Pôle en italique
                            itemMetaDetails = ` <span class="news-item-meta-details">(${details.join(' ')})</span>`; // Appliquer la classe pour les styles
                        }
                        
                        li.innerHTML = `
                            <span class="news-text">${itemTitleHtml}${itemMetaDetails}</span>
                            <div style="text-align: right;">
                                <span class="item-details-line">Il y a ${diffHours}h</span>
                                <span class="item-details-line">(${remainingHours}h restantes)</span>
                            </div>
                            <button class="delete-item-btn" title="Supprimer ce message">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        `;
                        const deleteButton = li.querySelector('.delete-item-btn');
                        deleteButton.addEventListener('click', () => deleteNewsItem(item.timestamp)); 
                        currentNewsList.appendChild(li);
                    });
                    showMessage('Liste des messages actualisée.', 'success');

                } else if (response.status === 404) {
                    currentNewsList.innerHTML = '<li>Aucun message actif dans le flux pour le moment.</li>';
                } else {
                    throw new Error(`Erreur lors du chargement des messages : ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                currentNewsList.innerHTML = '<li>Erreur lors du chargement des messages.</li>';
                showMessage(`Erreur lors du chargement des messages : ${error.message}`, 'error');
                console.error("Erreur de chargement des messages actuels:", error);
            }
        }


        // Charger les composants header et footer
        async function loadComponents() {
            const headerPlaceholder = document.getElementById("header-placeholder");
            const footerPlaceholder = document.getElementById("footer-placeholder");
            try {
                const headerResponse = await fetch("header.html");
                if (headerResponse.ok) {
                    headerPlaceholder.innerHTML = await headerResponse.text();
                } else {
                    console.error("Erreur de chargement du header.html:", headerResponse.statusText);
                    headerPlaceholder.innerHTML = `
                        <div class="header">
                            <img src="log_ia.png" alt="Logo IA Marketing" class="logo-ia">
                            <h1 class="header-title">IA MARKETING</h1> 
                            <img src="Section-Clients-Logo-RTBF.png" alt="Logo RTBF" class="logo-rtbf">
                            <a href="about.html" class="dev-button-header">DEV</a>
                        </div>
                        <div class="nav-wrapper">
                            <div class="menu-container">
                                <nav>
                                    <a href="index.html">Accueil</a>
                                    <a href="equipe.html">Équipe</a>
                                    <a href="outils.html">Outils IA</a>
                                    <a href="galerie.html">Galerie</a>
                                    <a href="Cas-usages.html">Tips</a>
                                    <a href="veille.html">Veille</a>
                                    <a href="charte.html">Charte IA</a>
                                    <a href="faq.html">FAQ</a>
                                    <a href="demandes_ia.html" class="demandes">
                                        Demandes IA
                                        <span class="notif-bubble" id="notif-count">0</span>
                                    </a>
                                    <a href="admin-news.html" class="active">Admin News</a>
                                    <a href="gestion-license.html">Licenses</a>
                                </nav>
                            </div>
                        </div>
                    `;
                }

                const footerResponse = await fetch("footer.html");
                if (footerResponse.ok) {
                    footerPlaceholder.innerHTML = await footerResponse.text();
                } else {
                    console.error("Erreur de chargement du footer.html:", footerResponse.statusText);
                    footerPlaceholder.innerHTML = `<div class="footer">© 2025 Espace IA Marketing. Tous droits réservés.</div>`;
                }
                
                // Gérer le lien actif dans le menu après le chargement des composants
                const currentPath = window.location.pathname.split('/').pop();
                document.querySelectorAll('nav a').forEach(link => {
                    const linkHref = link.getAttribute('href');
                    const linkFileName = linkHref ? linkHref.split('/').pop() : '';
                    if (linkFileName === currentPath || (currentPath === "" && linkFileName === "index.html")) {
                        link.classList.add("active");
                    } else {
                        link.classList.remove("active");
                    }
                });

                // Optionnel : Initialiser le dark mode si la logique est dans le header ou ici.
                // initializeDarkMode(); 
                
            } catch (error) {
                console.error("Erreur lors du chargement des composants:", error);
            }
        }

        // Initialisation à l'ouverture de la page
        document.addEventListener('DOMContentLoaded', async () => {
            await loadComponents();
            populateSelectors();
            poleSelect.addEventListener('change', updateCollaborators);
            newsForm.addEventListener('submit', addNewsItem);
            refreshNewsListButton.addEventListener('click', loadCurrentNewsItems); 
            
            loadCurrentNewsItems(); 
            document.body.style.opacity = "1"; 
        });
    </script>
</body>
</html>
