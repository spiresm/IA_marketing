<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accueil - Espace IA</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* CSS sp√©cifique au loader et au corps de page */
        #loader {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95); /* Fond blanc semi-transparent */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5em;
            font-family: Arial, sans-serif;
            color: #0077b6; /* Couleur du texte du loader */
            z-index: 9999; /* Assure que le loader est au-dessus de tout */
            opacity: 1; /* Initialement visible */
            transition: opacity 0.5s ease-out; /* Transition douce pour la disparition */
        }

        #loader.hidden {
            opacity: 0; /* Rend le loader transparent */
            pointer-events: none; /* Emp√™che les clics sur l'√©l√©ment transparent */
        }

        /* Styles g√©n√©raux du body et du layout */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f2f4f8;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            opacity: 0; /* Initialement invisible pour l'animation d'apparition */
            transition: opacity 0.5s ease-in; /* Animation d'apparition du contenu */
        }
        /* Classe pour rendre le corps de page visible apr√®s le chargement */
        body.show {
            opacity: 1;
        }

        /* Le CSS pour les sections et les tuiles est conserv√© */
        .section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            padding: 40px 20px;
            flex-grow: 1;
        }

        .tile {
            background-color: #ffffff;
            width: 100%;
            max-width: 900px;
            border-left: 8px solid #0077b6;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .tile h2 {
            margin-top: 0;
            color: #0077b6;
        }

        .tile p {
            color: #555;
            line-height: 1.6;
        }

        /* CSS pour le bloc ChatGPT */
        .chatgpt-wrapper {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }
        .chatgpt-box {
            width: 100%;
            max-width: 650px;
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 119, 182, 0.1);
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 24px;
            align-items: center;
        }
        .chatgpt-box h3 {
            margin: 0;
            font-size: 1.2rem;
            text-align: center;
            color: #333;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .chatgpt-box h3::before {
            content: "üí¨";
            font-size: 1.2rem;
        }
        .chatgpt-box textarea {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
        }
        .chatgpt-box .btn {
            padding: 12px 30px;
            background-color: #0077b6;
            color: #fff;
            font-weight: bold;
            font-size: 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .chatgpt-box .btn:hover {
            background-color: #005f8c;
        }
        #reponse {
            white-space: pre-wrap;
            background: #f4faff;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #cce5ff;
            font-size: 0.95rem;
            line-height: 1.4;
            color: #333;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Style pour le footer (maintenant int√©gr√©) */
        .footer {
            text-align: center;
            padding: 20px;
            color: #777;
            font-size: 0.85rem;
            margin-top: auto;
        }

        /* Nouveaux styles pour la section des derniers ajouts */
        .latest-additions-section {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
        }

        .latest-additions-section h2 {
            text-align: center;
            color: #0077b6;
            margin-bottom: 25px;
        }

        .post-it-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 10px 0;
        }

        /* Styles pour chaque "Post-it" */
        .post-it-note {
            position: relative;
            background-color: #FFFAA0; /* Couleur jaune Post-it */
            color: #333;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-size: 0.95em;
            width: 250px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transform: rotate(calc(var(--rotation) * 1deg)); /* Rotation l√©g√®re */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-sizing: border-box; /* Inclure padding et border dans la largeur/hauteur */
        }

        .post-it-note:nth-child(even) {
            --rotation: -2; /* Alterner la rotation */
        }

        .post-it-note:nth-child(odd) {
            --rotation: 3; /* Alterner la rotation */
        }

        .post-it-note:hover {
            transform: scale(1.03) rotate(0deg); /* Agrandir et redresser au survol */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            z-index: 10; /* Assure qu'il est au-dessus des autres au survol */
        }

        .post-it-note h4 {
            margin-top: 0;
            color: #005f8a;
            font-size: 1.1em;
            margin-bottom: 8px;
            text-align: left;
        }

        .post-it-note p {
            font-size: 0.9em;
            line-height: 1.4;
            margin-bottom: 0;
            flex-grow: 1;
            text-align: left;
            word-wrap: break-word; /* G√©rer les longs mots */
        }

        .post-it-note .post-it-category {
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
            text-align: right;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="loader">
        Chargement...
    </div>

    <div id="header-placeholder"></div>

    <div class="section">
        <div class="tile">
            <h2>Bienvenue sur l‚Äôespace IA Marketing</h2>
            <p>
                Cette plateforme collaborative vous permet de d√©couvrir, partager et capitaliser sur les usages de l‚Äôintelligence artificielle au sein de notre organisation. Que vous cherchiez des outils, des prompts, des cas d‚Äôusage inspirants ou que vous souhaitiez contribuer avec vos propres astuces, tout est centralis√© ici pour accompagner votre mont√©e en comp√©tence et faciliter l‚Äôadoption de l‚ÄôIA au quotidien.
            </p>

            <div class="chatgpt-wrapper">
                <div class="chatgpt-box">
                    <h3>Discuter avec ChatGPT</h3>
                    <textarea id="user-input" rows="4" placeholder="Pose ta question ici..."></textarea>
                    <button class="btn" onclick="envoyer()">Envoyer</button>
                    <pre id="reponse"></pre>
                </div>
            </div>
        </div>
    </div>

    <div class="latest-additions-section">
        <h2>üöÄ Derniers ajouts dans "Cas d'usages" & "Galerie"</h2>
        <div id="post-it-container" class="post-it-container">
            </div>
    </div>

    <footer class="footer">
        Auteur : **Steeve Pires Madeira / Marketing - Equipe Cr√©a**
    </footer>

    <script>
        const PROXY_URL = "/.netlify/functions/proxy"; // URL pour la Netlify Function qui r√©cup√®re les donn√©es de Google Sheets
        const apiBase = window.location.origin + '/.netlify/functions/'; // Pour les fonctions CRUD

        // Cette fonction sera appel√©e par le header pour mettre √† jour la bulle
        async function mettreAJourBulleDemandes() {
            const notif = document.getElementById("notif-count");
            if (!notif) {
                console.warn("√âl√©ment #notif-count non trouv√©. La bulle de notification ne peut pas √™tre mise √† jour.");
                return;
            }
            try {
                const res = await fetch(`${PROXY_URL}?action=getDemandesIA`);
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                const demandes = await res.json();
                const demandesNonTraitees = demandes.filter(d => !d.traite);
                notif.textContent = demandesNonTraitees.length;
                notif.style.display = demandesNonTraitees.length > 0 ? "inline-block" : "none";
            } catch (e) {
                console.error("Erreur lors de la mise √† jour du compteur de demandes :", e);
                notif.style.display = "none";
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const loader = document.getElementById("loader");
            const body = document.body;
            const headerPlaceholder = document.getElementById("header-placeholder");
            // Plus besoin de footerPlaceholder car le footer est direct dans le HTML

            // Fonction pour charger le header
            const loadComponent = async (url, placeholderId, errorMessage) => {
                try {
                    const res = await fetch(url);
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    document.getElementById(placeholderId).innerHTML = await res.text();
                } catch (error) {
                    console.error(`Erreur lors du chargement de ${url}:`, error);
                    document.getElementById(placeholderId).innerHTML = `<p style='color:red;text-align:center;'>${errorMessage}: ${error.message}</p>`;
                }
            };

            // Charger uniquement le header
            loadComponent("header.html", "header-placeholder", "Erreur de chargement du menu")
            .then(() => {
                // Une fois le header charg√©
                mettreAJourBulleDemandes(); // Mettre √† jour la bulle apr√®s le chargement du header

                // Marquer le lien "Accueil" comme actif
                const path = location.pathname.split("/").pop();
                const links = document.querySelectorAll("nav a");
                links.forEach(link => {
                    if (path === "" || path === "index.html") {
                        if (link.getAttribute("href") === "index.html") {
                            link.classList.add("active");
                        }
                    } else if (link.getAttribute("href") === path) {
                        link.classList.add("active");
                    }
                });

                // Cacher le loader et afficher le contenu du body
                loader.classList.add("hidden");
                body.classList.add("show");

                // Appeler la fonction pour afficher les Post-it une fois le DOM charg√©
                displayLatestAdditions();
            })
            .catch(error => {
                console.error("Erreur g√©n√©rale lors du chargement des composants :", error);
                // Si une erreur se produit, masquer le loader et afficher le body quand m√™me
                loader.classList.add("hidden");
                body.classList.add("show");
            });
        });

        async function envoyer() {
            const userMessage = document.getElementById("user-input").value;
            // Afficher un message de chargement
            document.getElementById("reponse").textContent = "Chargement de la r√©ponse...";

            try {
                const response = await fetch("/.netlify/functions/chat-clean", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userMessage })
                });

                const text = await response.text();
                let data;

                try {
                    data = JSON.parse(text);
                } catch (e) {
                    document.getElementById("reponse").textContent = "‚ùå Erreur : r√©ponse non JSON\n" + text;
                    console.error("Erreur de parsing JSON de la r√©ponse de chat-clean:", e, text);
                    return;
                }

                if (data.error) {
                    document.getElementById("reponse").textContent = `‚ùå Erreur API : ${data.error}`;
                    console.error("Erreur renvoy√©e par l'API chat-clean:", data.error);
                } else {
                    document.getElementById("reponse").textContent = data.reply || "‚úÖ Pas de r√©ponse g√©n√©r√©e.";
                }
            } catch (networkError) {
                document.getElementById("reponse").textContent = `‚ùå Erreur r√©seau ou fonction Netlify inaccessible: ${networkError.message}`;
                console.error("Erreur r√©seau ou fonction Netlify inaccessible:", networkError);
            }
        }

        // Fonction pour simuler et afficher les derniers ajouts sous forme de Post-it
        function displayLatestAdditions() {
            const postItContainer = document.getElementById("post-it-container");
            if (!postItContainer) {
                console.error("Conteneur des Post-it non trouv√© !");
                return;
            }

            // Donn√©es simul√©es des derniers ajouts
            // En production, ces donn√©es viendraient d'une API ou d'un fichier JSON
            const latestAdditions = [
                {
                    titre: "G√©n√©rer des id√©es de contenu",
                    prompt: "Utilisez l'IA pour brainstormer des sujets d'articles de blog ou de posts sociaux.",
                    categorie: "Cas d'usages"
                },
                {
                    titre: "Optimiser les campagnes d'e-mailing",
                    prompt: "Cr√©ez des lignes d'objet percutantes et des appels √† l'action optimis√©s par l'IA.",
                    categorie: "Galerie"
                },
                {
                    titre: "Analyse des sentiments clients",
                    prompt: "Analysez les retours clients sur les r√©seaux sociaux pour identifier les tendances.",
                    categorie: "Cas d'usages"
                },
                {
                    titre: "R√©daction de fiches produits",
                    prompt: "G√©n√©rez des descriptions de produits uniques et optimis√©es pour le SEO.",
                    categorie: "Galerie"
                },
                {
                    titre: "Cr√©ation de personas marketing",
                    prompt: "D√©veloppez des profils d'audience d√©taill√©s bas√©s sur des donn√©es r√©elles.",
                    categorie: "Cas d'usages"
                }
            ];

            latestAdditions.forEach((item) => {
                const postIt = document.createElement("div");
                postIt.className = "post-it-note";

                const title = document.createElement("h4");
                title.textContent = item.titre;

                const prompt = document.createElement("p");
                prompt.textContent = item.prompt;

                const category = document.createElement("div");
                category.className = "post-it-category";
                category.textContent = `Cat√©gorie: ${item.categorie}`;

                postIt.appendChild(title);
                postIt.appendChild(prompt);
                postIt.appendChild(category);
                postItContainer.appendChild(postIt);
            });
        }
    </script>
</body>
</html>
