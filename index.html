<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accueil - Espace IA</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="header.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="footer.html" as="fetch" crossorigin="anonymous">
    <link rel="preload" href="log_ia.png" as="image">
    <link rel="preload" href="Section-Clients-Logo-RTBF.png" as="image">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* Variables CSS (laissées ici pour la clarté si style.css est plus générique) */
        :root {
            --primary-blue: #0077b6;
            --dark-blue: #005f8a;
            --light-blue: #64B5F6;
            --lighter-blue: #42A5F5;
            --background-grey: #f0f2f5;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            --card-hover-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --success-bg: #d4edda;
            --success-text: #155724;
            --error-bg: #f8d7da;
            --error-text: #dc3545;
            --postit-yellow: #FFFAA0;
            --light-blue-card: #E0F2F7;
            --grey-text: #555;
            --border-color: #ddd;
            /* Variables pour le Dark Mode - Assurez-vous qu'elles sont cohérentes avec style.css */
            --header-bg: #ffffff;
            --nav-link-color: #333;
            --nav-link-hover-color: var(--primary-blue);
            --active-link-color: var(--primary-blue);
            --dark-mode-bg: #2b2b2b;
            --dark-mode-text: #e0e0e0;
            --dark-mode-card-bg: #3a3a3a;
            --dark-mode-border: #555;
            --dark-mode-input-bg: #444;
            --dark-mode-accent-blue: #0099e6; /* Un bleu plus vif pour le dark mode */
        }

        /* Styles Dark Mode - à déplacer dans style.css si vous voulez un fichier CSS propre */
        body.dark-mode {
            background-color: var(--dark-mode-bg);
            color: var(--dark-mode-text);
        }
        body.dark-mode .latest-additions-section,
        body.dark-mode .addition-card,
        body.dark-mode .modal-content {
            background-color: var(--dark-mode-card-bg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode .latest-additions-section h2,
        body.dark-mode .card-header h4 {
            color: var(--dark-mode-text); /* Titres en texte clair */
        }
        body.dark-mode .card-header .icon {
            color: var(--dark-mode-accent-blue); /* Icônes en bleu plus vif */
        }
        body.dark-mode .addition-card p {
            color: var(--light-text-color);
        }
        body.dark-mode .card-meta {
            color: var(--light-text-color);
            border-top-color: var(--dark-mode-border);
        }
        body.dark-mode .card-meta .category,
        body.dark-mode .view-button,
        body.dark-mode #chatbot-header {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .view-button:hover,
        body.dark-mode #chatbot-header:hover {
            background-color: var(--primary-blue); /* Un peu plus foncé au survol */
        }
        body.dark-mode .addition-card.cas-usage {
            border-left-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .addition-card.galerie {
            border-left-color: #ccb000; /* Jaune plus foncé pour dark mode */
        }
        body.dark-mode .modal-content {
            background-color: var(--dark-mode-card-bg);
            border-color: var(--dark-mode-border);
        }
        body.dark-mode .modal-header {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .modal-header h2 {
            color: var(--dark-mode-text);
        }
        body.dark-mode .modal-body p {
            color: var(--light-text-color);
        }
        body.dark-mode .modal-button {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .modal-button:hover {
            background-color: var(--primary-blue);
        }
        body.dark-mode #chatbot-container {
            background-color: var(--dark-mode-card-bg);
        }
        body.dark-mode #chatbot-header {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode #chatbot-body {
            background-color: #3b3b3b;
        }
        body.dark-mode .message.bot {
            background-color: #555;
            color: var(--dark-mode-text);
        }
        body.dark-mode .message.user {
            background-color: var(--dark-mode-accent-blue);
            color: white;
        }
        body.dark-mode #chatbot-input {
            background-color: var(--dark-mode-input-bg);
            border-color: var(--dark-mode-border);
            color: var(--dark-mode-text);
        }
        body.dark-mode #chatbot-input-container {
            background-color: var(--dark-mode-card-bg);
            border-top-color: var(--dark-mode-border);
        }
        body.dark-mode #chatbot-send-button {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode #chatbot-send-button:hover {
            background-color: var(--primary-blue);
        }
        body.dark-mode #chatbot-fab {
            background-color: var(--dark-mode-accent-blue);
        }
        body.dark-mode #chatbot-fab:hover {
            background-color: var(--primary-blue);
        }

        /* Styles généraux pour le body et main - VISIBLES PAR DÉFAUT */
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            background-color: var(--background-grey);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            /* Pas d'opacité initiale ici. Le contenu est masqué par le loader */
        }
        /* La classe .show sera ajoutée pour déclencher la transition si vous voulez un fondu */
        body.show { 
            /* opacity: 1; */ /* Si vous voulez un fondu du body, sinon retirez */
        }
        main {
            padding: 40px 20px;
            flex-grow: 1;
            /* Pas d'opacité initiale ici. Le contenu est masqué par le loader */
        }
        /* La classe .show sera ajoutée pour déclencher la transition si vous voulez un fondu */
        main.show {
            /* opacity: 1; */ /* Si vous voulez un fondu du main, sinon retirez */
        }

        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95); /* Fond presque opaque */
            display: flex; /* Toujours afficher par défaut pour le loader */
            justify-content: center;
            align-items: center;
            flex-direction: column; /* Pour centrer texte et spinner */
            z-index: 9999;
            opacity: 1; /* S'assure que le loader est visible au démarrage */
            transition: opacity 0.5s ease-out; /* Transition pour cacher le loader */
            pointer-events: all; /* Permet les interactions tant que le loader est là */
        }
        #loader .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }
        #loader p {
            color: var(--primary-blue);
            font-size: 1.1em;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loader.hidden {
            opacity: 0;
            pointer-events: none; /* Désactive les interactions une fois le loader caché */
        }
        
        #header-placeholder {
            width: 100%;
        }

        /* L'ancienne section de bienvenue (si elle existe toujours, mais ne doit pas être visible) */
        .section.welcome-section {
            display: none; /* Assure qu'elle est masquée */    
        }
        
        .footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            background-color: var(--dark-blue);
            color: white;
            font-size: 0.9em;
        }

        /* Styles pour la section des derniers ajouts - Cartes Modernes */
        .latest-additions-section {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }

        .latest-additions-section h2 {
            text-align: center;
            color: var(--primary-blue);
            margin-bottom: 30px;
        }

        .latest-additions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            justify-content: center;
            padding: 10px 0;
        }

        .addition-card {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;    
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .addition-card.cas-usage {
            border-left: 5px solid var(--light-blue);
        }

        .addition-card.galerie {
            border-left: 5px solid var(--postit-yellow);
        }

        .addition-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-header .icon {
            font-size: 1.8em;
            margin-right: 15px;
            color: var(--primary-blue);
        }

        .card-header h4 {
            margin: 0;
            color: var(--dark-blue);
            font-size: 1.2em;
            flex-grow: 1;
        }

        .addition-card p {
            font-size: 0.9em;    
            line-height: 1.5;
            color: var(--grey-text);
            margin-bottom: 15px;
            flex-grow: 1;    
        }

        .addition-card.cas-usage p {
            font-size: 0.95em;    
        }
        
        .addition-card.galerie p {
            /* Styles spécifiques si nécessaires */
        }


        .addition-card .card-image-container {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 15px;
            flex-shrink: 0;    
        }

        .addition-card .card-image-container img {
            max-width: 100%;
            height: 200px;    
            object-fit: cover;    
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* NOUVEAU STYLE POUR LE PETIT LECTEUR VIDÉO DANS LA CARTE */
        .card-small-video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* Ratio 16:9 */
            margin-top: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            border-radius: 5px;
            background-color: #000;
            flex-shrink: 0;
        }

        .card-small-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 5px;
        }

        .card-meta {
            display: flex;
            flex-wrap: wrap;    
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: #888;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            margin-top: 15px;
            flex-shrink: 0;    
        }
        
        .card-meta div {
            margin-right: 10px;
            margin-bottom: 5px;
        }

        .card-meta .category {
            font-style: italic;
            color: var(--primary-blue);
        }

        .card-meta .date {
            font-weight: bold;
        }

        /* Styles pour les boutons "Voir..." */
        .view-button {
            display: block;    
            /* Anciens styles */
            /* width: calc(100% - 0px); */
            padding: 10px;
            margin-top: auto;    
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            flex-shrink: 0;    

            /* MODIFICATION POUR CENTRER LE BOUTON */
            width: fit-content; /* Le bouton prendra la largeur de son contenu */
            min-width: 120px; /* Largeur minimale si le contenu est très court */
            max-width: 100%; /* S'assure qu'il ne dépasse pas la carte sur petit écran */
            margin-left: auto; /* Centre le bouton horizontalement */
            margin-right: auto; /* Centre le bouton horizontalement */
        }

        .view-button:hover {
            background-color: var(--dark-blue);
            transform: translateY(-2px);
        }

        /* Styles pour le Chatbot */
        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 10px;
            background-color: #fff;
            display: none; /* Masqué par défaut */
            flex-direction: column;
            max-height: 80vh;
            overflow: hidden;
        }

        #chatbot-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 15px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        #chatbot-header h3 {
            margin: 0;
            font-size: 1.1em;
        }

        #chatbot-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0 5px;
        }

        #chatbot-body {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9f9f9;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        #chatbot-messages {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 15px;
            margin-bottom: 10px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background-color: var(--light-blue);
            color: white;
            border-bottom-right-radius: 2px;
        }

        .message.bot {
            align-self: flex-start;
            background-color: #e0e0e0;
            color: #333;
            border-bottom-left-radius: 2px;
        }

        #chatbot-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
            background-color: #fff;
        }

        #chatbot-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            margin-right: 10px;
            font-size: 0.9em;
        }

        #chatbot-send-button {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #chatbot-send-button:hover {
            background-color: var(--dark-blue);
        }

        #chatbot-loading {
            text-align: center;
            font-size: 0.9em;
            color: #777;
            padding: 5px;
        }
        #chatbot-fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-blue);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: background-color 0.3s ease;
        }

        #chatbot-fab:hover {
            background-color: var(--dark-blue);
        }

        /* Styles pour la Modale de Bienvenue */
        .modal {
            display: none; /* Masqué par défaut, affiché par JS */
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            position: relative;
            text-align: center;
        }

        .modal-header {
            background-color: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            margin: -20px -20px 20px -20px;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .modal-body p {
            line-height: 1.6;
            color: var(--grey-text);
            margin-bottom: 20px;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 5px;
            right: 15px;
            cursor: pointer;
            z-index: 10;
        }

        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-button {
            background-color: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease;
        }

        .modal-button:hover {
            background-color: var(--dark-blue);
        }

        /* Media Queries pour la responsivité (si nécessaire, à harmoniser avec style.css) */
        @media (max-width: 768px) {
            .latest-additions-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                width: 90%;
            }
            #chatbot-container {
                width: 90%;
                right: 5%;
                bottom: 10px;
            }
            #chatbot-fab {
                bottom: 10px;
                right: 10px;
            }
        }

        /* NOUVEAUX STYLES POUR LE FLUX RSS DÉFILANT */
        .news-ticker-section {
            max-width: 900px;
            margin: 0 auto 20px auto; /* <-- Marge supérieure réglée à 0 pour "coller" */
            padding: 15px 20px;
            background: #e0f7fa; /* Un fond clair pour le flux */
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden; /* Cache le contenu qui dépasse */
            position: relative;
            display: flex; /* Utilisation de flexbox pour l'icône et le texte */
            align-items: center;
        }

        body.dark-mode .news-ticker-section {
            background-color: #1a2a3a; /* Couleur plus foncée pour le dark mode */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        body.dark-mode .news-ticker-section .icon {
            color: var(--dark-mode-accent-blue);
        }
        body.dark-mode .news-ticker-content a {
            color: var(--dark-mode-text);
        }

        .news-ticker-section .icon {
            font-size: 1.5em;
            color: var(--primary-blue);
            margin-right: 15px;
            flex-shrink: 0; /* Empêche l'icône de rétrécir */
        }

        .news-ticker-container {
            flex-grow: 1; /* Prend l'espace restant */
            height: 1.5em; /* Hauteur pour une ligne de texte */
            line-height: 1.5em; /* Centre le texte verticalement */
            overflow: hidden;
            position: relative;
        }

        .news-ticker-content {
            white-space: nowrap; /* Empêche le retour à la ligne du texte */
            position: absolute;
            top: 0;
            left: 0;
            will-change: transform; /* Optimisation pour l'animation */
            animation: ticker 25s linear infinite; /* Animation défilante, durée sera ajustée par JS */
            animation-play-state: running; /* Par défaut, l'animation est lancée */
        }

        .news-ticker-content:hover {
            animation-play-state: paused; /* Met en pause au survol */
        }

        .news-item {
            display: inline-block; /* Affiche les éléments en ligne */
            padding-right: 50px; /* Espace entre les actualités */
            font-size: 0.95em;
        }

        .news-item a {
            color: #333;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s ease;
        }

        .news-item a:hover {
            color: var(--primary-blue);
            text-decoration: underline;
        }

        /* Animation de défilement */
        @keyframes ticker {
            0% { transform: translateX(100%); } /* Commence hors de l'écran à droite */
            100% { transform: translateX(-100%); } /* Finit hors de l'écran à gauche */
        }

        /* Ajustement de l'animation pour le contenu plus long */
        .news-ticker-content[data-duration] {
            animation-duration: var(--ticker-duration);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .news-ticker-section {
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px 15px;
            }
            .news-ticker-section .icon {
                font-size: 1.2em;
                margin-right: 10px;
            }
            .news-item {
                font-size: 0.85em;
                padding-right: 30px;
            }
        }
    </style>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div> <p>Chargement du contenu...</p>
    </div>

    <div id="header-placeholder"></div>

    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <div class="modal-header">
                <h2>Bienvenue sur l'Espace IA Marketing</h2>
            </div>
            <div class="modal-body">
                <p>Cette plateforme collaborative vous permet de découvrir, partager et capitaliser sur les usages de l’intelligence artificielle au sein de notre organisation. Que vous cherchiez des outils, des prompts, des cas d’usage inspirants ou que vous souhaitez contribuer avec vos propres astuces, tout est centralisé ici pour accompagner votre montée en compétence et faciliter l’adoption de l’IA au quotidien. Explorez les différentes sections pour trouver des ressources, ajouter vos propres contributions ou poser des questions à notre chatbot IA intégré !</p>
                <button class="modal-button" id="confirmWelcome">Compris !</button>
            </div>
        </div>
    </div>

    <main>
        <section class="news-ticker-section">
            <i class="fas fa-newspaper icon"></i>
            <div class="news-ticker-container">
                <div class="news-ticker-content" id="newsTickerContent">
                    </div>
            </div>
        </section>

        <div class="latest-additions-section">
            <h2>Derniers ajouts</h2>
            <div id="latest-additions-grid" class="latest-additions-grid">
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>
    
    <div id="chatbot-fab">
        <i class="fas fa-comment-dots"></i>
    </div>

    <div id="chatbot-container">
        <div id="chatbot-header">
            <h3>Assistant IA</h3>
            <button id="chatbot-toggle"><i class="fas fa-times"></i></button>
        </div>
        <div id="chatbot-body">
            <div id="chatbot-messages">
                <div class="message bot">Bonjour ! Comment puis-je vous aider aujourd'hui ?</div>
            </div>
            <div id="chatbot-loading" style="display:none;">L'IA réfléchit...</div>
        </div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Tapez votre message..." />
            <button id="chatbot-send-button"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        const PROXY_URL = "/.netlify/functions/proxy";
        const GET_TIPS_URL = "/.netlify/functions/get-tips";
        const GET_PROMPTS_URL = "/.netlify/functions/getGalleryPrompts";
        
        // Références aux éléments DOM
        const loader = document.getElementById("loader");
        const bodyElement = document.body;
        const mainElement = document.querySelector('main');
        const headerPlaceholder = document.getElementById("header-placeholder");
        const footerPlaceholder = document.getElementById("footer-placeholder");

        const chatbotFab = document.getElementById('chatbot-fab');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendButton = document.getElementById('chatbot-send-button');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotLoading = document.getElementById('chatbot-loading');

        const welcomeModal = document.getElementById('welcomeModal');
        const closeButton = document.querySelector('#welcomeModal .close-button');
        const confirmWelcomeButton = document.getElementById('confirmWelcome');

        // Initialisation de l'état de la modale de bienvenue
        const HAS_SEEN_WELCOME_MODAL = 'hasSeenWelcomeModal';

        // --- Fonctions utilitaires ---

        /**
         * Ajoute un message au corps du chatbot.
         * @param {string} text Le texte du message.
         * @param {string[]} classes Classes CSS supplémentaires pour le message.
         */
        function appendMessage(text, ...classes) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', ...classes);
            messageDiv.textContent = text;
            if (chatbotMessages) {
                chatbotMessages.appendChild(messageDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight; // Fait défiler vers le bas
            } else {
                console.warn("chatbotMessages element not found when trying to append message.");
            }
        }

        /**
         * Initialisation du Dark Mode
         */
        function initializeDarkMode() {
            const toggle = document.getElementById('darkModeToggle'); // Assurez-vous que cet ID est dans header.html
            if (!toggle) {
                console.warn("DarkModeToggle non trouvé dans le header. Le mode sombre ne sera pas activé via le toggle.");
                return;
            }
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                bodyElement.classList.add(savedTheme);
                if (savedTheme === 'dark-mode') {
                    toggle.checked = true;
                }
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                bodyElement.classList.add('dark-mode');
                toggle.checked = true;
            } else {
                bodyElement.classList.add('light-mode');
            }

            toggle.addEventListener('change', () => {
                if (toggle.checked) {
                    bodyElement.classList.remove('light-mode');
                    bodyElement.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark-mode');
                } else {
                    bodyElement.classList.remove('dark-mode');
                    bodyElement.classList.add('light-mode');
                    localStorage.setItem('theme', 'light-mode');
                }
            });

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (!localStorage.getItem('theme')) {
                    if (event.matches) {
                        bodyElement.classList.remove('light-mode');
                        bodyElement.classList.add('dark-mode');
                        toggle.checked = true;
                    } else {
                        bodyElement.classList.remove('dark-mode');
                        bodyElement.classList.add('light-mode');
                        toggle.checked = false;
                    }
                }
            });
        }

        /**
         * Extrait l'ID d'une vidéo YouTube à partir de son URL.
         * @param {string} url L'URL de la vidéo YouTube.
         * @returns {string|null} L'ID de la vidéo ou null si non trouvé.
         */
        function getYouTubeVideoId(url) {
            let videoId = null;
            const youtubeRegex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = url.match(youtubeRegex);
            if (match && match[1]) {
                videoId = match[1];
            }
            return videoId;
        }

        /**
         * Vérifie si une URL se termine par une extension d'image courante.
         * @param {string} url L'URL à vérifier.
         * @returns {boolean} True si l'URL semble être une image, false sinon.
         */
        function isImageUrl(url) {
            return (/\.(gif|jpe?g|tiff?|png|webp|bmp)$/i).test(url);
        }

        /**
         * Crée une carte pour les derniers ajouts (Cas d'usage ou Galerie).
         * @param {object} item Les données de l'élément (tip ou prompt).
         * @param {'cas-usage'|'galerie'} type Le type de carte à créer.
         * @returns {HTMLElement} L'élément div représentant la carte.
         */
        const createCard = (item, type) => {
            console.log(`[createCard] Création de la carte pour le type: ${type}, titre: ${item.titre}`);
            console.log("[createCard] Données de l'élément:", item);

            const card = document.createElement("div");
            card.className = `addition-card ${type}`;

            const header = document.createElement('div');
            header.className = 'card-header';

            const icon = document.createElement('i');
            if (type === 'cas-usage') {
                icon.className = 'fas fa-lightbulb icon';
            } else if (type === 'galerie') {
                icon.className = 'fas fa-image icon';
            }    
            header.appendChild(icon);

            const title = document.createElement("h4");
            title.textContent = item.titre || "Titre non spécifié";
            header.appendChild(title);
            card.appendChild(header);
            
            const descriptionElement = document.createElement("p");
            descriptionElement.textContent = item.description || item.promptText || item.prompt || '';
            card.appendChild(descriptionElement);

            // LOGIQUE HARMONISÉE POUR DÉTECTER LE MÉDIA À AFFICHER (IMAGE OU VIDÉO)
            let mediaToDisplay = null;
            let mediaType = null; // 'youtube' ou 'image'

            // Priorité 1: Chercher dans item.urls pour une vidéo YouTube
            if (item.urls && Array.isArray(item.urls)) {
                const youtubeUrl = item.urls.find(url => getYouTubeVideoId(url));
                if (youtubeUrl) {
                    mediaToDisplay = youtubeUrl;
                    mediaType = 'youtube';
                    console.log("[createCard] Média trouvé: YouTube URL:", mediaToDisplay);
                } else {
                    // Priorité 2: Si pas de YouTube, chercher la première image dans item.urls
                    const imageUrl = item.urls.find(url => isImageUrl(url));
                    if (imageUrl) {
                        mediaToDisplay = imageUrl;
                        mediaType = 'image';
                        console.log("[createCard] Média trouvé: Image URL (depuis urls):", mediaToDisplay);
                    }
                }
            }
            
            // Priorité 3: Si rien trouvé dans item.urls, et si item.imageUrl existe (pour le cas de la galerie souvent)
            if (!mediaToDisplay && item.imageUrl && isImageUrl(item.imageUrl)) {
                mediaToDisplay = item.imageUrl;
                mediaType = 'image';
                console.log("[createCard] Média trouvé: Image URL (depuis item.imageUrl):", mediaToDisplay);
            }
            // FIN LOGIQUE HARMONISÉE


            if (mediaType === 'youtube') {
                const youtubeId = getYouTubeVideoId(mediaToDisplay);
                // Utilisation de youtube-nocookie.com pour une meilleure confidentialité
                const embedUrl = `https://www.youtube-nocookie.com/embed/${youtubeId}?autoplay=0&controls=0&modestbranding=1&rel=0&showinfo=0`;
                
                const videoContainer = document.createElement('div');
                videoContainer.className = 'card-small-video-container';

                const iframe = document.createElement('iframe');
                iframe.src = embedUrl;
                iframe.frameBorder = "0";
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                iframe.allowFullscreen = true;
                iframe.title = `Vidéo intégrée pour ${item.titre}`;
                iframe.onerror = () => {
                    console.error(`Erreur de chargement de l'iframe vidéo pour ${item.titre}, ID: ${youtubeId}. URL: ${embedUrl}`);
                    videoContainer.style.display = 'none'; // Cache le conteneur en cas d'erreur
                };
                iframe.onload = () => {
                    console.log(`Iframe YouTube chargée pour ${item.titre}.`);
                };

                videoContainer.appendChild(iframe);
                card.appendChild(videoContainer);
            } else if (mediaType === 'image') {
                const imgContainer = document.createElement('div');
                imgContainer.className = 'card-image-container';
                const img = document.createElement('img');
                img.src = mediaToDisplay;
                img.alt = `Vignette de ${item.titre}`;
                img.onerror = () => {
                    console.error(`Erreur de chargement de l'image pour ${item.titre}. URL: ${mediaToDisplay}`);
                    imgContainer.style.display = 'none'; // Cache le conteneur en cas d'erreur
                };
                img.onload = () => {
                    console.log(`Image chargée pour ${item.titre}. URL: ${mediaToDisplay}`);
                };
                imgContainer.appendChild(img);
                card.appendChild(imgContainer);
            } else {
                console.log(`[createCard] Aucun média visuel (YouTube ou Image) trouvé pour la carte '${item.titre}'.`);
            }
            
            const meta = document.createElement('div');
            meta.className = 'card-meta';

            if (item.auteur) {
                const authorDiv = document.createElement("div");
                authorDiv.innerHTML = `<strong>Auteur:</strong> ${item.auteur}`;
                meta.appendChild(authorDiv);
            }

            const categoryDiv = document.createElement("div");
            categoryDiv.className = "category";
            // MODIFICATION ICI: Unifier la catégorie en "TIP"
            categoryDiv.innerHTML = `<strong>Catégorie:</strong> TIP`; 
            meta.appendChild(categoryDiv);

            if (item.outil) {
                const toolDiv = document.createElement("div");
                toolDiv.innerHTML = `<strong>Outil:</strong> ${item.outil}`;
                meta.appendChild(toolDiv);
            }
            
            const dateDiv = document.createElement("div");
            dateDiv.className = "date";
            const dateToUse = item.date_creation || item.dateCreation || item.date_ajout || item.date;
            if (dateToUse) {
                const d = new Date(dateToUse);
                dateDiv.textContent = `Ajouté le ${d.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' })}`;
            } else {
                dateDiv.textContent = `Date inconnue`;
            }
            meta.appendChild(dateDiv);
            
            card.appendChild(meta);   

            const button = document.createElement('a');
            button.className = "view-button";   
            if (type === 'cas-usage') {
                button.href = "cas-usages.html";
                button.textContent = "Voir le Tip";
            } else if (type === 'galerie') {   
                button.href = "galerie.html";
                button.textContent = "Voir la galerie";
            }
            card.appendChild(button);

            return card;
        };

        /**
         * Charge et affiche les derniers ajouts (Cas d'usage ou Prompts de galerie).
         */
        async function displayLatestAdditions() {
            const container = document.getElementById("latest-additions-grid");

            if (!container) {
                console.error("Conteneur des derniers ajouts non trouvé !");
                return;
            }
            container.innerHTML = ''; // Nettoyer le conteneur avant de charger

            try {
                const [casUsagesResponse, promptsResponse] = await Promise.all([
                    fetch(GET_TIPS_URL),
                    fetch(GET_PROMPTS_URL)
                ]);

                if (!casUsagesResponse.ok) {
                    throw new Error(`Erreur lors du chargement des cas d'usages: ${casUsagesResponse.statusText}`);
                }
                let casUsages = await casUsagesResponse.json();
                if (!Array.isArray(casUsages)) {
                    throw new Error("Les données des cas d'usages ne sont pas un tableau.");
                }
                console.log("[displayLatestAdditions] Données brutes des cas d'usages:", casUsages);

                if (!promptsResponse.ok) {
                    throw new Error(`Erreur lors du chargement des prompts de la galerie: ${promptsResponse.statusText}`);
                }
                let prompts = await promptsResponse.json();
                if (!Array.isArray(prompts)) {
                    throw new Error("Les données des prompts ne sont pas un tableau.");
                }
                console.log("[displayLatestAdditions] Données brutes des prompts de la galerie:", prompts);
                
                // Harmonisation et parsing des URLs et dates pour les deux sources
                casUsages = casUsages.map(item => {
                    let itemUrls = [];
                    // Handle urls property as an array, potentially parsing stringified JSON
                    if (Array.isArray(item.urls)) {
                        itemUrls = item.urls;
                    } else if (typeof item.urls === 'string' && item.urls.startsWith('[')) {
                        try {
                            const parsed = JSON.parse(item.urls);
                            if (Array.isArray(parsed)) {
                                itemUrls = parsed;
                            }
                        } catch (e) {
                            console.error("Erreur de parsing des URLs du cas d'usage:", e, item.urls);
                        }
                    } else if (item.url) { // Fallback for single 'url' property
                        itemUrls = [item.url];
                    }

                    // NOUVEAU : Ajouter item.fileUrls si elles existent, en leur donnant la priorité
                    if (item.fileUrls && Array.isArray(item.fileUrls)) {
                        itemUrls = [...item.fileUrls, ...itemUrls];
                    }

                    // Add item.imageUrl to itemUrls if it exists and is not already there
                    if (item.imageUrl && !itemUrls.includes(item.imageUrl)) { // Utiliser includes pour vérifier l'existence
                        itemUrls.unshift(item.imageUrl); // Ajouter en début de tableau pour la priorité
                    }


                    const processedItem = {   
                        ...item,   
                        urls: itemUrls, // Ensure urls is an array, potentially including imageUrl
                        effectiveDate: new Date(item.date_creation || item.dateCreation || item.date_ajout || item.date || new Date(0).toISOString())   
                    };
                    console.log("[displayLatestAdditions] Cas d'usage traité:", processedItem);
                    return processedItem;
                });

                prompts = prompts.map(item => {
                    let itemUrls = [];
                     // Handle urls property as an array, potentially parsing stringified JSON
                    if (Array.isArray(item.urls)) {
                        itemUrls = item.urls;
                    } else if (typeof item.urls === 'string' && item.urls.startsWith('[')) {
                        try {
                            const parsed = JSON.parse(item.urls);
                            if (Array.isArray(parsed)) {
                                itemUrls = parsed;
                            }
                        } catch (e) {
                            console.error("Erreur de parsing des URLs du prompt:", e, item.urls);
                        }
                    } else if (item.url) { // Fallback for single 'url' property
                        itemUrls = [item.url];
                    }

                    // NOUVEAU : Ajouter item.fileUrls si elles existent, en leur donnant la priorité
                    if (item.fileUrls && Array.isArray(item.fileUrls)) {
                        itemUrls = [...item.fileUrls, ...itemUrls];
                    }

                    // Add item.imageUrl to itemUrls if it exists and is not already there
                    if (item.imageUrl && !itemUrls.includes(item.imageUrl)) {
                        itemUrls.unshift(item.imageUrl); // Ajouter en début de tableau pour la priorité
                    }

                    const processedItem = {   
                        ...item,   
                        urls: itemUrls, // Ensure urls is an array, potentially including imageUrl
                        effectiveDate: new Date(item.date_creation || item.dateCreation || item.date_ajout || item.date || new Date(0).toISOString())   
                    };
                    console.log("[displayLatestAdditions] Prompt traité:", processedItem);
                    return processedItem;
                });

                // Trier par date effective (du plus récent au plus ancien)
                casUsages.sort((a, b) => b.effectiveDate.getTime() - a.effectiveDate.getTime());
                // Filtrer les prompts qui ont une image ou vidéo dans leur tableau 'urls' ou une imageUrl directe
                const imagePrompts = prompts.filter(item => (item.urls && item.urls.some(url => getYouTubeVideoId(url) || isImageUrl(url))) || (item.imageUrl && isImageUrl(item.imageUrl)));
                imagePrompts.sort((a, b) => b.effectiveDate.getTime() - a.effectiveDate.getTime());

                const latestCasUsage = casUsages.length > 0 ? casUsages[0] : null;
                const latestGalerieItem = imagePrompts.length > 0 ? imagePrompts[0] : null;

                console.log("[displayLatestAdditions] Dernier cas d'usage à afficher:", latestCasUsage);
                console.log("[displayLatestAdditions] Dernier élément de galerie à afficher:", latestGalerieItem);


                let itemsDisplayed = 0;

                if (latestCasUsage) {
                    container.appendChild(createCard(latestCasUsage, 'cas-usage'));
                    itemsDisplayed++;
                } else {
                    console.warn("Aucun cas d'usage trouvé pour l'affichage sur la page d'accueil.");
                }

                if (latestGalerieItem && (container.children.length < 2 || (latestCasUsage && latestGalerieItem.id !== latestCasUsage.id))) {
                    container.appendChild(createCard(latestGalerieItem, 'galerie'));
                    itemsDisplayed++;
                } else if (!latestGalerieItem) {
                    console.warn("Aucun élément de galerie trouvé pour l'affichage sur la page d'accueil.");
                }

                if (itemsDisplayed === 0) {
                    const noAdditionsMessage = document.createElement('p');
                    noAdditionsMessage.style.textAlign = 'center';
                    noAdditionsMessage.style.color = '#777';
                    noAdditionsMessage.textContent = 'Aucun ajout récent à afficher pour le moment.';
                    container.appendChild(noAdditionsMessage);
                }

            } catch (error) {
                console.error("Erreur lors de la récupération ou de l'affichage des derniers ajouts:", error);
                container.innerHTML = `<p style="text-align: center; color: red;">Erreur lors du chargement des derniers ajouts. Veuillez réessayer.</p>`;
            }
        }
        
        /**
         * Envoie un message au chatbot et affiche la réponse.
         */
        async function sendMessage() {
            const messageText = chatbotInput.value.trim();
            if (messageText === "") return;

            appendMessage(messageText, 'user');
            chatbotInput.value = '';
            chatbotLoading.style.display = 'block';
            
            try {
                const response = await fetch(`${PROXY_URL}?action=chatWithGPT`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: messageText })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }

                const data = await response.json();
                appendMessage(data.reply, 'bot');
            } catch (error) {
                console.error('Erreur lors de la communication avec le chatbot :', error);
                appendMessage("Désolé, je n'ai pas pu communiquer avec l'IA. Veuillez réessayer.", 'bot', 'error-message');
            } finally {
                chatbotLoading.style.display = 'none';
            }
        }

        /**
         * Fonction utilitaire pour charger des composants HTML via fetch.
         * @param {string} url - L'URL du composant HTML.
         * @param {string} placeholderId - L'ID de l'élément où insérer le HTML.
         * @returns {Promise<void>} Une promesse qui se résout quand le composant est chargé.
         */
        async function loadComponent(url, placeholderId) {
            try {
                const res = await fetch(url);
                if (!res.ok) {
                    const errorDetail = await res.text();
                    throw new Error(`HTTP error! status: ${res.status} - ${res.statusText}. URL: ${url}. Response: ${errorDetail.substring(0, 200)}...`);
                }
                document.getElementById(placeholderId).innerHTML = await res.text();
                console.log(`Composant ${url} chargé avec succès dans #${placeholderId}.`);
            } catch (error) {
                console.error(`Erreur lors du chargement de ${url}:`, error);
                document.getElementById(placeholderId).innerHTML = `<p style='color:red;text-align:center;'>Erreur de chargement du composant: ${url}. (${error.message})</p>`;
            }
        };

        // --- Fonctions pour le News Ticker ---
        async function loadNewsTicker() {
            const newsTickerContent = document.getElementById('newsTickerContent');
            if (!newsTickerContent) {
                console.error("L'élément #newsTickerContent n'a pas été trouvé.");
                return;
            }

            try {
                // Appel à votre fonction Netlify qui va chercher et parser le flux RSS
                const response = await fetch('/.netlify/functions/fetchNews');
                if (!response.ok) {
                    throw new Error(`Échec du chargement des actualités : ${response.statusText} (Status: ${response.status})`);
                }
                const newsItems = await response.json(); // La fonction Netlify devrait retourner un tableau JSON d'actualités

                if (!newsItems || newsItems.length === 0) {
                    newsTickerContent.innerHTML = '<span class="news-item">Aucune actualité trouvée pour le moment.</span>';
                    // S'assurer que l'animation est arrêtée s'il n'y a pas de contenu
                    newsTickerContent.style.animation = 'none';
                    newsTickerContent.style.transform = 'translateX(0)';
                    return;
                }

                newsTickerContent.innerHTML = ''; // Nettoyer le contenu existant

                newsItems.forEach(item => {
                    const span = document.createElement('span');
                    span.className = 'news-item';
                    const a = document.createElement('a');
                    a.href = item.url || '#';
                    // `item.title` devrait déjà être décodé grâce à `htmlEntities: true` dans la fonction Netlify.
                    a.textContent = item.title || 'Titre inconnu'; 
                    
                    a.target = '_blank'; // Ouvre le lien dans un nouvel onglet
                    a.rel = 'noopener noreferrer'; // Bonnes pratiques de sécurité
                    span.appendChild(a);
                    newsTickerContent.appendChild(span);
                });

                // Pour un défilement continu : calculer la largeur totale et cloner le contenu
                const tickerContainer = newsTickerContent.parentElement;
                const totalContentWidth = newsTickerContent.scrollWidth; // Largeur de tous les news-item mis bout à bout
                const containerVisibleWidth = tickerContainer.offsetWidth; // Largeur de la fenêtre visible

                // Cloner le contenu si nécessaire pour assurer un défilement continu
                // On clone au moins une fois le contenu entier du ticker.
                // Cela évite les "sauts" et assure un défilement infini visuellement.
                if (totalContentWidth > 0 && totalContentWidth < containerVisibleWidth * 2) {
                    const originalContent = newsTickerContent.innerHTML;
                    newsTickerContent.innerHTML += originalContent; // Ajoutez le clone
                    // Si le contenu reste trop court après un premier clonage, clonez encore
                    if (newsTickerContent.scrollWidth < containerVisibleWidth * 2) {
                        newsTickerContent.innerHTML += originalContent;
                    }
                } else if (totalContentWidth === 0) {
                    // Aucun contenu réel, désactiver l'animation
                    newsTickerContent.style.animation = 'none';
                    newsTickerContent.style.transform = 'translateX(0)';
                    return;
                }

                // Ajuster la durée de l'animation en fonction de la largeur totale DU CONTENU CLONE et de la vitesse désirée
                const adjustedTotalWidth = newsTickerContent.scrollWidth / 2; // On divise par 2 car l'animation déplace 2 fois le contenu (original + clone)
                const speed = 5; // Pixels par seconde (plus petit = plus lent). J'ai réduit à 5 pour un défilement TRES lent.
                const duration = adjustedTotalWidth / speed; // Durée de l'animation en secondes
                
                newsTickerContent.style.setProperty('--ticker-duration', `${duration}s`);
                newsTickerContent.style.animationPlayState = 'running'; // S'assurer que l'animation est lancée

            } catch (error) {
                console.error("Erreur lors du chargement du flux d'actualités :", error);
                newsTickerContent.innerHTML = '<span class="news-item">Impossible de charger les actualités. Vérifiez la console pour les erreurs.</span>';
                newsTickerContent.style.animation = 'none'; // Arrêter l'animation en cas d'erreur
            }
        }


        // --- Initialisation au chargement du DOM ---
        document.addEventListener("DOMContentLoaded", async () => {
            console.log("Accueil: DOMContentLoaded, début de l'initialisation...");

            // Masquer la barre de défilement du body au début pour une meilleure expérience
            bodyElement.style.overflow = 'hidden';

            // Lancez tous les chargements asynchrones en parallèle
            const [headerLoad, footerLoad, latestAdditionsLoad, newsTickerLoad] = await Promise.all([
                loadComponent("header.html", "header-placeholder"),
                loadComponent("footer.html", "footer-placeholder"),
                displayLatestAdditions(), // Cette fonction gère déjà son propre chargement/affichage
                loadNewsTicker() // Charger le flux de nouvelles
            ]);
            
            // Mettre à jour l'état actif du menu après le chargement du header
            const currentPath = window.location.pathname.split('/').pop();
            document.querySelectorAll('nav a').forEach(link => {
                const linkHref = link.getAttribute('href');
                const linkFileName = linkHref ? linkHref.split('/').pop() : '';
                if (linkFileName === currentPath || (currentPath === "" && linkFileName === "index.html")) {
                    link.classList.add("active");
                } else {
                    link.classList.remove("active");
                }
            });

            // Initialiser le mode sombre après que le header soit chargé
            initializeDarkMode();

            // Cacher le loader et révéler le contenu principal
            if (loader) {
                loader.classList.add("hidden");
                loader.addEventListener('transitionend', () => {
                    if (loader.classList.contains('hidden')) {
                        loader.style.display = 'none';
                    }
                }, { once: true });
            }
            
            // Révéler le body et main. Si vous voulez un fondu, ajoutez des transitions sur .show
            bodyElement.style.overflow = ''; // Restaurer le défilement du body une fois la page visible

            console.log("Accueil: Initialisation terminée.");

            // --- Logique de la Modale de Bienvenue ---
            const hasSeenWelcomeModal = localStorage.getItem(HAS_SEEN_WELCOME_MODAL) === 'true';

            if (!hasSeenWelcomeModal && welcomeModal) {
                welcomeModal.style.display = 'flex'; // Afficher la modale
            } else if (welcomeModal) {
                welcomeModal.style.display = 'none'; // S'assurer qu'elle est cachée si déjà vue
            }


            if (closeButton) {
                closeButton.addEventListener('click', () => {
                    welcomeModal.style.display = 'none';
                    localStorage.setItem(HAS_SEEN_WELCOME_MODAL, 'true');
                });
            }
            if (confirmWelcomeButton) {
                confirmWelcomeButton.addEventListener('click', () => {
                    welcomeModal.style.display = 'none';
                    localStorage.setItem(HAS_SEEN_WELCOME_MODAL, 'true');
                });
            }
            if (welcomeModal) {
                welcomeModal.addEventListener('click', (event) => {
                    if (event.target === welcomeModal) {
                        welcomeModal.style.display = 'none';
                        localStorage.setItem(HAS_SEEN_WELCOME_MODAL, 'true');
                    }
                });
            }

            // --- Chatbot event listeners (à conserver, ils sont déjà bons) ---
            if (chatbotFab) {
                chatbotFab.addEventListener('click', () => {
                    chatbotContainer.style.display = chatbotContainer.style.display === 'flex' ? 'none' : 'flex';
                    if (chatbotContainer.style.display === 'flex') {
                        chatbotInput.focus();
                    }
                });
            }

            if (chatbotToggle) {
                chatbotToggle.addEventListener('click', () => {
                    chatbotContainer.style.display = 'none';
                });
            }

            if (chatbotSendButton && chatbotInput) {
                chatbotSendButton.addEventListener('click', sendMessage);
                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            } else {
                console.warn("Chatbot elements (send button or input) not found. Check your HTML structure for chatbot-send-button and chatbot-input.");
            }
        });
    </script>
</body>
</html>
