<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accueil - Espace IA</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      opacity: 0;
      transition: opacity 0.3s ease-in;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f2f4f8;
    }

    .section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      padding: 40px 20px;
    }

    .tile {
      background-color: #ffffff;
      width: 100%;
      max-width: 900px;
      border-left: 8px solid #0077b6;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
      text-align: center;
    }

    .tile h2 {
      margin-top: 0;
      color: #0077b6;
    }

    .tile p {
      color: #555;
      line-height: 1.6;
    }

    .chatgpt-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 50px;
    }

    .chatgpt-box {
      width: 100%;
      max-width: 650px;
      background: #ffffff;
      border: 1px solid #dee2e6;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 119, 182, 0.1);
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      align-items: center;
    }

    .chatgpt-box h3 {
      margin: 0;
      font-size: 1.2rem;
      text-align: center;
      color: #333;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .chatgpt-box h3::before {
      content: "💬";
      font-size: 1.2rem;
    }

    .chatgpt-box textarea {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      padding: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      resize: vertical;
      font-family: inherit;
    }

    .chatgpt-box .btn {
      padding: 12px 30px;
      background-color: #0077b6;
      color: #fff;
      font-weight: bold;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .chatgpt-box .btn:hover {
      background-color: #005f8c;
    }

    #reponse {
      white-space: pre-wrap;
      background: #f4faff;
      padding: 14px;
      border-radius: 8px;
      border: 1px solid #cce5ff;
      font-size: 0.95rem;
      line-height: 1.4;
      color: #333;
      max-width: 500px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div id="header-placeholder"></div>

  <div class="section">
    <div class="tile">
      <h2>Bienvenue sur l’espace IA Marketing</h2>
      <p>
        Cette plateforme collaborative vous permet de découvrir, partager et capitaliser sur les usages de l’intelligence artificielle au sein de notre organisation. Que vous cherchiez des outils, des prompts, des cas d’usage inspirants ou que vous souhaitez contribuer avec vos propres astuces, tout est centralisé ici pour accompagner votre montée en compétence et faciliter l’adoption de l’IA au quotidien.
      </p>

      <div class="chatgpt-wrapper">
        <div class="chatgpt-box">
          <h3>Discuter avec ChatGPT</h3>
          <textarea id="user-input" rows="4" placeholder="Pose ta question ici..."></textarea>
          <button class="btn" onclick="envoyer()">Envoyer</button>
          <pre id="reponse"></pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    function mettreAJourBulleDemandes() {
      const notif = document.getElementById("notif-count");
      // Ajout de logs pour le débogage
      console.log("Recherche de #notif-count sur index.html :", notif);
      if (!notif) {
        console.warn("L'élément #notif-count n'a pas été trouvé sur index.html. La bulle de notification ne peut pas être mise à jour.");
        return;
      }
      const demandes = JSON.parse(localStorage.getItem("demandesIA") || "[]");
      notif.textContent = demandes.length;
      notif.style.display = demandes.length > 0 ? "inline-block" : "none";
      console.log(`Bulle de notification mise à jour sur index.html : ${demandes.length} demandes.`);
    }

    // On utilise DOMContentLoaded pour s'assurer que le DOM est prêt
    document.addEventListener("DOMContentLoaded", () => {
        console.log("DOM entièrement chargé pour index.html. Début de l'initialisation...");
        fetch("header.html")
            .then(res => {
                console.log("Réponse de fetch('header.html') reçue.");
                if (!res.ok) {
                    throw new Error(`Erreur HTTP lors du chargement du header: ${res.status}`);
                }
                return res.text();
            })
            .then(data => {
                document.getElementById("header-placeholder").innerHTML = data;
                console.log("Header HTML injecté. Mise à jour de la bulle de notification.");
                mettreAJourBulleDemandes(); // Appeler APRÈS que le header soit injecté
                
                // Gestion des liens actifs du menu (copié de galerie.html, bonne pratique)
                const path = location.pathname.split("/").pop();
                const links = document.querySelectorAll("nav a");
                links.forEach(link => {
                    // Si l'index est la page d'accueil (vide ou index.html)
                    if (path === "" || path === "index.html") {
                        if (link.getAttribute("href") === "index.html") {
                            link.classList.add("active");
                        }
                    } else if (link.getAttribute("href") === path) {
                        link.classList.add("active");
                    }
                });

                document.body.style.opacity = "1"; // Rendre la page visible
            })
            .catch(error => {
                console.error("Erreur critique lors du chargement du header sur index.html:", error);
                document.getElementById("header-placeholder").innerHTML =
                    "<p style='color:white;text-align:center'>Erreur de chargement du menu</p>";
                document.body.style.opacity = "1"; // S'assurer que le body est visible même en cas d'erreur
                mettreAJourBulleDemandes(); // Tenter de la mettre à jour même si le header n'a pas chargé correctement
            });
    });


    async function envoyer() {
      const userMessage = document.getElementById("user-input").value;
      document.getElementById("reponse").textContent = "Chargement..."; // Afficher un message de chargement

      const response = await fetch("/.netlify/functions/chat-clean", { // Assurez-vous que cette fonction existe et est déployée
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userMessage })
      });

      const text = await response.text();
      let data;

      try {
        data = JSON.parse(text);
      } catch (e) {
        document.getElementById("reponse").textContent = "❌ Erreur : réponse non JSON\n" + text;
        console.error("Erreur de parsing JSON de la réponse de chat-clean:", e, text);
        return;
      }

      if (data.error) {
        document.getElementById("reponse").textContent = `❌ Erreur API : ${data.error}`;
        console.error("Erreur renvoyée par l'API chat-clean:", data.error);
      } else {
        document.getElementById("reponse").textContent = data.reply || "✅ Pas de réponse générée.";
        console.log("Réponse de chat-clean reçue:", data.reply);
      }
    }
  </script>
</body>
</html>
