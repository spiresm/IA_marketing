<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Demande IA - Espace IA</title>
    <style>
        /* CSS INT√âGR√â DIRECTEMENT ICI POUR ASSURER SA PR√âSENCE */
        body {
            opacity: 0;
            margin: 0;
            font-family: sans-serif;
            background-color: #f0f2f5;
            transition: opacity 0.3s ease-in;
        }
        main {
            display: none; /* Cache le contenu principal au chargement, le JS le rend visible */
        }
        .flex-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            padding: 40px 20px;
            flex-wrap: wrap;
        }
        .container {
            flex: 1 1 600px;
            max-width: 700px;
            background: white;
            padding: 40px 35px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        }
        form label {
            display: block;
            margin-top: 20px;
            font-weight: 600;
            color: #444;
        }
        form input, form select, form textarea {
            width: 100%;
            padding: 12px 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1em;
            margin-top: 6px;
            background-color: #f9fafb;
            box-sizing: border-box; /* S'assure que padding est inclus dans la largeur */
        }
        input[name="emailPrefix"], input[name="date"] {
            max-width: 200px;
        }
        .email-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        button {
            background-color: #0077b6;
            color: white;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #005f8a;
        }
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        .recap {
            flex: 0 1 320px;
            background: rgb(0, 119, 182); /* Couleur de fond du r√©capitulatif */
            padding: 20px;
            border-radius: 14px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            max-height: 90vh;
            overflow-y: auto;
            position: relative; /* Pour positionner le loading text */
        }
        .recap h3 {
            margin-top: 0;
            color: #ffffff; /* Texte en blanc */
            margin-bottom: 10px;
        }
        #recapList {
            margin-top: 20px;
            min-height: 50px; /* Pour √©viter le saut quand les tickets chargent */
        }
        .ticket {
            position: relative;
            background: white;
            padding: 12px 14px;
            margin-bottom: 12px;
            border-left: 4px solid #0077b6;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            font-size: 0.95em;
            display: flex;
            flex-direction: column;
            gap: 6px;
            cursor: pointer; /* Indique que c'est cliquable */
        }
        .ticket span {
            display: block;
            line-height: 1.4em;
        }
        #modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 25px 35px;
            /* --- MODIFICATIONS ICI pour r√©duire globalement de 10% --- */
            width: 81%; /* 90% de la largeur d'origine (90% * 0.9 = 81%) */
            max-width: 405px; /* 450px d'origine * 0.9 = 405px */
            max-height: 81vh; /* 90vh d'origine * 0.9 = 81vh */
            /* --- FIN DES MODIFICATIONS --- */
            position: relative;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            font-size: 0.95em;
            overflow-y: auto; /* Permet le d√©filement si le contenu d√©passe */
        }
        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        .modal-title {
            color: #0077b6;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }
        .modal-info-line {
            display: flex;
            margin-bottom: 10px;
            line-height: 1.4;
            flex-wrap: wrap;
        }
        .modal-info-line strong {
            color: #0077b6;
            min-width: 90px;
            margin-right: 10px;
        }
        .modal-info-line span {
            flex: 1;
            word-break: break-word;
        }
        .modal-info-line.description {
            flex-direction: column;
        }
        .modal-info-line.description strong {
            margin-bottom: 5px;
        }

        /* Styles pour la bulle de notification */
        .notification-bubble {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff0000;
            color: white;
            border-radius: 50%;
            padding: 2px 7px;
            font-size: 0.75em;
            font-weight: bold;
            display: none;
            line-height: 1;
        }

        /* Styles pour les messages Toast */
        #toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none; /* Permet de cliquer √† travers */
        }
        .toast-message {
            background-color: rgba(51, 51, 51, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            transform: translateY(20px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            min-width: 250px;
            text-align: center;
            font-weight: bold;
        }
        .toast-message.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast-message.success {
            background-color: rgba(40, 167, 69, 0.9); /* Vert */
        }
        .toast-message.error {
            background-color: rgba(220, 53, 69, 0.9); /* Rouge */
        }

        /* Styles pour l'√©tat de chargement des tickets */
        .loading-text {
            color: white;
            text-align: center;
            padding: 15px;
            font-style: italic;
        }

        /* Styles pour la modale d'information (MODIFI√âS) */
        #infoModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6); /* Fond sombre */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Assurez-vous qu'elle est au-dessus de tout le reste */
            animation: fadeIn 0.3s ease-out;
            /* Ajout pour le d√©filement sur les petits √©crans */
            overflow-y: auto;
            padding: 20px 0; /* Ajoute un peu de padding vertical pour que le contenu ne touche pas les bords */
            box-sizing: border-box; /* Inclure le padding dans la hauteur/largeur */
        }

        #infoModal.hidden {
            display: none;
        }

        .info-modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px 25px; /* R√©duction du padding */
            width: 90%;
            max-width: 400px; /* R√©duction de la largeur maximale */
            max-height: 85vh; /* Nouvelle propri√©t√©: hauteur maximale √† 85% de la hauteur de la vue */
            overflow-y: auto; /* Permet le d√©filement si le contenu d√©passe la hauteur max */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            transform: scale(0.9);
            animation: scaleIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            position: relative; /* Pour le positionnement du bouton "Compris" si n√©cessaire */
        }

        .info-modal-content h2 {
            color: #0077b6;
            margin-top: 0;
            margin-bottom: 15px; /* Ajustement de la marge */
            font-size: 1.6em; /* L√©g√®rement r√©duit */
        }

        .info-modal-content p {
            font-size: 1em; /* L√©g√®rement r√©duit */
            line-height: 1.5;
            margin-bottom: 20px; /* Ajustement de la marge */
            color: #333;
        }

        .info-modal-content p strong {
            color: #0077b6; /* Pour le texte "type de contenu" */
        }

        .info-modal-content p em {
            color: #e60000; /* Pour le texte "RTBF" */
            font-weight: bold;
            font-style: normal;
        }

        .info-modal-content button {
            background-color: #0077b6;
            color: white;
            padding: 10px 20px; /* L√©g√®rement r√©duit */
            border: none;
            border-radius: 8px;
            font-size: 1em; /* L√©g√®rement r√©duit */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            margin-top: 15px; /* Assure un espace au-dessus du bouton */
        }

        .info-modal-content button:hover {
            background-color: #005f8a;
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Styles sp√©cifiques pour le filtre du r√©cap (si besoin de styles sp√©cifiques en plus des inputs g√©n√©raux) */
        #filtreDemandeur {
            margin-bottom: 8px; /* Un peu plus de marge sous le filtre */
        }

        /* Styles pour masquer/afficher les conteneurs de champs */
        .form-field-group {
            display: block; /* Par d√©faut, les groupes sont visibles */
        }
        .form-field-group.hidden {
            display: none; /* Masque les groupes de champs */
        }

    </style>
</head>
<body>
    <div id="infoModal">
        <div class="info-modal-content">
            <h2>Bienvenue sur la page de Demande IA !</h2>
            <p>Ce formulaire vous permet de soumettre vos demandes de productions bas√©es sur l'Intelligence Artificielle. Remplissez les champs requis (votre nom, email, le type et le support de la demande, la cha√Æne, la dur√©e souhait√©e et un briefing d√©taill√©) pour que notre √©quipe puisse traiter votre requ√™te efficacement.</p>
            <p>Sur la droite, vous trouverez un <strong>r√©capitulatif</strong> de toutes les demandes en cours et trait√©es, que vous pouvez filtrer par demandeur ou par cha√Æne. Vous pouvez √©galement marquer une demande comme trait√©e ou la supprimer si n√©cessaire.</p>
            <button id="comprendaBtn">Compris !</button>
        </div>
    </div>

    <div id="header-placeholder"></div>

    <main>
        <div class="flex-wrapper">
            <div class="container">
                <h2 style="text-align:center; color:#0077b6; margin-top: 0;">Formulaire de demande de production IA</h2>
                <form id="demandeIA">
                    <label for="nom">Nom :</label>
                    <select name="nom" id="nom" required>
                        <option value="">-- S√©lectionner --</option>
                        </select>

                    <label for="emailPrefix">Email :</label>
                    <div class="email-container">
                        <input type="text" name="emailPrefix" placeholder="initiales" required />
                        <span>@rtbf.be</span>
                    </div>

                    <label for="besoin">Besoin :</label>
                    <select name="besoin" id="besoin" required>
                        <option value="">-- S√©lectionner --</option>
                        <option value="production">Production</option>
                        <option value="formation">Formation</option>
                    </select>

                    <div id="typeContenu-group" class="form-field-group">
                        <label for="typeContenu">Type de contenu :</label>
                        <select name="typeContenu" id="typeContenu" required>
                            <option value="">-- S√©lectionner --</option>
                            <option value="vid√©o">Vid√©o</option>
                            <option value="audio">Audio</option>
                            <option value="image">Image</option>
                            <option value="voix off IA">Voix off IA</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>

                    <div id="support-chaine-group" class="form-field-group">
                        <label for="support">Support :</label>
                        <select name="support" id="support" required>
                            <option value="">-- S√©lectionner --</option>
                            <option value="TV">TV</option>
                            <option value="Radio">Radio</option>
                            <option value="Web">Web</option>
                            <option value="RS">R√©seaux sociaux</option>
                            <option value="autre">Autre</option>
                        </select>

                        <label for="chaine">Chaine :</label>
                        <select name="chaine" id="chaine" required>
                            <option value="">-- S√©lectionner --</option>
                            <option value="La Une">La Une</option>
                            <option value="Tipik">Tipik</option>
                            <option value="La Trois">La Trois</option>
                            <option value="La premi√®re">La premi√®re</option>
                            <option value="Classic 21">Classic 21</option>
                            <option value="vivacit√©">vivacit√©</option>
                            <option value="Musiq3">Musiq3</option>
                            <option value="Auvio">Auvio</option>
                            <option value="Auvio Kids">Auvio Kids</option>
                        </select>
                    </div>

                    <div id="outils-group" class="form-field-group hidden">
                        <label for="outils">Outils :</label>
                        <select name="outils" id="outils" multiple required>
                            </select>
                        <small style="display: block; margin-top: 5px; color: #666;">Maintenez Ctrl/Cmd pour s√©lectionner plusieurs outils.</small>
                    </div>

                    <label for="duree">Dur√©e :</label>
                    <select name="duree" id="duree"></select>

                    <label for="date">Date :</label>
                    <input type="date" name="date" required />

                    <label for="description">Briefing :</label>
                    <textarea name="description" rows="4" required></textarea>

                    <button type="submit" id="submitBtn">Envoyer</button>
                </form>
            </div>

            <div class="recap">
                <h3>R√©capitulatif des demandes</h3>
                <select id="filtreDemandeur" style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #ccc;">
                    <option value="">Filtrer par demandeur</option>
                    </select>

                <select id="filtreBesoin" style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #ccc;">
                    <option value="">Filtrer par besoin</option>
                    <option value="production">Production</option>
                    <option value="formation">Formation</option>
                </select>

                <select id="filtreParChaine" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;"></select>
                <div id="recapList"></div>
            </div>
        </div>
    </main>

    <div id="modal">
        <div class="modal-content">
            <button class="close-modal" title="Fermer">&times;</button>
            <h4 class="modal-title">D√©tails de la demande</h4>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // D√©finitions des URL pour les fonctions Netlify
        const PROXY_URL = "/.netlify/functions/proxy";
        const SEND_REQUEST_URL = "/.netlify/functions/sendrequest";

        // Tableau des profils qui alimentera les filtres et champs de nom
        const allProfiles = [
            // P√¥le cr√©a. (existants et ajout√©s)
            { "id": "_tfzo5ckx8", "name": "Steeve PIRES MADEIRA", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/image_compress√©e (2).jpeg", "tools": ["ChatGPT", "Claude", "Midjourney", "Stable Diffusion", "Firefly", "Gemini", "Copilot", "Sora", "ElevenLabs"], "note": "ajouter staff aux √©quipes + lier profil aux demandeurs IA" },
            { "id": "_a0617pogh", "name": "Sabrina LECLERCQ", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/sabrina.png", "tools": ["ChatGPT", "Claude", "Midjourney", "DALL¬∑E", "Stable Diffusion", "Firefly", "Runway ML"], "note": "" },
            { "id": "_zsdjsgpxk", "name": "Jeremy DEHERTOGH", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/Captain_America_Shield.webp", "tools": ["ChatGPT", "Midjourney", "Stable Diffusion", "Firefly", "Runway ML", "Gemini", "Copilot", "Sora"], "note": "" },
            { "id": "_xz380lwlz", "name": "Dominique LEFEVRE", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_th5j1y1ak", "name": "Joel VAN HOEF", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/joel.png", "tools": ["ChatGPT", "Midjourney", "Stable Diffusion", "Firefly", "Runway ML"], "note": "Hello Steeve,\nvoici mes suggestions :\nsignaler quelle est la limite maximale de poids du fichier √† compresser.\ndonner la possibilit√©, dans la galerie, de mettre un commentaire\nrenommer \"Cas d'usage\" et \"tip\" en \"workflow\"\nMerci √† toi\nJo√´l" },
            { "id": "_ko4axa9sq", "name": "Isabelle MARCHAL", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/isa.png", "tools": ["ChatGPT", "Midjourney", "Stable Diffusion", "Firefly"], "note": "" },
            { "id": "_170aetvaf", "name": "Susana GONCALVES VALERIO", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/susana.png", "tools": ["ChatGPT", "Midjourney", "Stable Diffusion", "Firefly"], "note": "" },
            { "id": "_qn2zeaz2v", "name": "Jimmy DEGREVE", "pole": "P√¥le cr√©a.", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/jimmy.png", "tools": ["ChatGPT", "Claude", "Midjourney", "Stable Diffusion", "Firefly"], "note": "" },
            { "id": "_25wpgzuws", "name": "Anne-Fran√ßoise LELEUX", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_8gnzie9nj", "name": "Baptiste TARTAS", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_gg0q68jwl", "name": "B√©atrice MARLIER", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_m22sh68c7", "name": "Boris TEIRLYNCK", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_orwk7irk3", "name": "Charlotte DELWARTE", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_x5k53iyde", "name": "Delphine BENROUBI", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_a3pnsl406", "name": "Faiza BOUMEDIAN", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_padq9zuin", "name": "Genevi√®ve DE BEAUFFORT", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_amq5aady5", "name": "Giovanni CASCONE", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_dny2qkk6g", "name": "Gregory KEPPENS", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_hi9o01e2o", "name": "Isabelle VERTUONGEN", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_2z5msputn", "name": "Jonathan LACROIX", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_gpn16nj1s", "name": "Jose ROJO", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_xc6h2qggw", "name": "Jose-Luis PENAFUERTE", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_01jyr1k2x", "name": "Mehdi HUSAIN", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_604cq06kb", "name": "Michael EVRARD", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_k6ukaf261", "name": "Nathalie AUBRY", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_di6y4hwzc", "name": "Patricia DAVIA", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_xlafbddqb", "name": "Pierre LERMIER", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_n9jr6sxvw", "name": "Pierre-Jean GILOUX", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_oo5nnduh6", "name": "Tyan HOOGSTOEL", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_cuhli6ncd", "name": "Vinciane LE MEN", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },
            { "id": "_w8aar4jmc", "name": "Virginie LONGE", "pole": "P√¥le cr√©a.", "photo": "", "tools": [], "note": "" },

            // CRM (existants et ajout√©s)
            { "id": "_k8lx8629j", "name": "Yasmine AIT MASKOUR", "pole": "CRM", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/image_compress√©e (8).jpeg", "tools": ["ChatGPT", "Claude", "Perplexity", "Gemini", "Copilot", "Bard"], "note": "" },
            { "id": "_totdkatk7", "name": "Fr√©d√©ric CARTON", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_9t6zyl805", "name": "In√®s BERNOUX", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_w5fx89vnx", "name": "No√©mie ROSSEY", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_meltem", "name": "Meltem SIVLIN", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_nadia", "name": "Nadia CURTO", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_noemie", "name": "Noemie GORISSEN", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_olivier", "name": "Olivier LEIDGENS", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_pierre", "name": "Pierre DUBOIS", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_romain", "name": "Romain DELECOUR", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_vincent", "name": "Vincent CRABBE", "pole": "CRM", "photo": "", "tools": [], "note": "" },
            { "id": "_new_id_vitold", "name": "Vitold GRAND'HENRY", "pole": "CRM", "photo": "", "tools": [], "note": "" },


            // Communication (existants et ajout√©s)
            { "id": "_xhfs9gepa", "name": "Elvis TCHANA", "pole": "Communication", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/test.jpeg", "tools": ["ChatGPT", "Claude"], "note": "" },
            { "id": "_c6418iedx", "name": "Aurore CRABBE", "pole": "Communication", "photo": "", "tools": [], "note": "" },
            { "id": "_ehc0rencs", "name": "Fabienne CULLUS", "pole": "Communication", "photo": "", "tools": [], "note": "" },
            { "id": "_ozmia7jjb", "name": "Marie NAUWELAERTS", "pole": "Communication", "photo": "", "tools": [], "note": "" },
            { "id": "_ixvy7pgyf", "name": "R√©gine CARPENTIER", "pole": "Communication", "photo": "", "tools": [], "note": "" },

            // Partenariats (existants et ajout√©s)
            { "id": "_bkd9howgm", "name": "Na√Øm EL BOHALI", "pole": "Partenariats", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/image_compress√©e.jpeg", "tools": ["ChatGPT", "Midjourney", "Firefly", "Bard"], "note": "" },
            { "id": "_ws6aofg2t", "name": "Alinoe VANHAUDENHUYSE", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_ftr3a9zbv", "name": "Catherine CARA", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_p9lgsl1s3", "name": "Dominique CAFFIERS", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_l7evb4oy8", "name": "Fiona KOPEINIG", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_iq4c1roj2", "name": "Isabelle DELENS", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_rxbx2f6ru", "name": "Laura DONATELLO", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_b70wfmd1y", "name": "Marie-Rose ANGE", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },
            { "id": "_wuny9uyhe", "name": "Nathalie DE RIJCKE", "pole": "Partenariats", "photo": "", "tools": [], "note": "" },

            // Marketing digital (existants et ajout√©s)
            { "id": "_fx585h9tt", "name": "Elise FONCK", "pole": "Marketing digital", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/image_compress√©e (9).jpeg", "tools": ["ChatGPT", "Claude", "Gemini", "Copilot"], "note": "" },
            { "id": "_mxb2zohnn", "name": "Ga√´lle DEGEYE", "pole": "Marketing digital", "photo": "", "tools": [], "note": "" },
            { "id": "_t5siihk1m", "name": "Mathilde ARMILLAC", "pole": "Marketing digital", "photo": "", "tools": [], "note": "" },
            { "id": "_j7cl9l5ew", "name": "Morgane CARLY", "pole": "Marketing digital", "photo": "", "tools": [], "note": "" },
            { "id": "_infrhxcz2", "name": "Yasmine GHAZOUANE", "pole": "Marketing digital", "photo": "", "tools": [], "note": "" },
            { "id": "_0ifx4haae", "name": "Sara GARCIA", "pole": "Marketing digital", "photo": "", "tools": [], "note": "" },

            // Positionnement (existants et ajout√©s)
            { "id": "_69pk2wxd2", "name": "Philippe BLANJEAN", "pole": "Positionnement", "photo": "https://raw.githubusercontent.com/spiresm/IA_marketing/main/uploads/image_compress√©e (1).jpeg", "tools": ["ChatGPT", "Midjourney", "DALL¬∑E", "Firefly", "Runway ML", "Gemini"], "note": "" },
            { "id": "_w97whz7qy", "name": "Amelie DE LANGE", "pole": "Positionnement", "photo": "", "tools": [], "note": "" },
            { "id": "_9nvt36jt5", "name": "Samuel LALOUX", "pole": "Positionnement", "photo": "", "tools": [], "note": "" }
        ];

        // Liste des outils disponibles pour le filtre "Outils"
        const allTools = [
            "ChatGPT", "Claude", "Midjourney", "Stable Diffusion", "DALL¬∑E", "Firefly",
            "Runway ML", "Gemini", "Copilot", "Sora", "ElevenLabs",
            "Adobe Premiere Pro", "Audacity", "Photoshop", "Illustrator", "Figma"
        ].sort(); // Trie les outils alphab√©tiquement

        // Fonction pour s'assurer que le parent de la bulle de notification a une position relative
        function ensureNotifParentPosition() {
            const demandeLink = document.querySelector("a.demandes");
            if (demandeLink) {
                const style = getComputedStyle(demandeLink);
                if (style.position === "static" || !style.position) {
                    demandeLink.style.position = "relative";
                }
            }
        }

        // Fonction pour afficher un message toast
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast-message ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);

            // Force reflow pour l'animation
            void toast.offsetWidth;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove(), { once: true });
            }, 3000); // Dispara√Æt apr√®s 3 secondes
        }

        // Chargement de l'en-t√™te
        fetch("header.html")
            .then(res => {
                if (!res.ok) {
                    console.error('Erreur lors du chargement de header.html:', res.status, res.statusText);
                    document.getElementById("header-placeholder").innerHTML = '<p style="color: red;">Erreur: header.html non trouv√© ou inaccessible.</p>';
                    showToast('Erreur de chargement de l\'en-t√™te.', 'error');
                    throw new Error('header.html not found');
                }
                return res.text();
            })
            .then(data => {
                document.getElementById("header-placeholder").innerHTML = data;
                ensureNotifParentPosition();
                document.body.style.opacity = "1";
                document.querySelector("main").style.display = "block";
                mettreAJourBulleDemandes();
            })
            .catch(error => {
                console.error("√âchec du chargement de l'en-t√™te:", error);
                document.body.style.opacity = "1";
                document.querySelector("main").style.display = "block";
            });

        const couleursParChaine = {
            'Classic 21': 'purple',
            'La Une': 'red',
            'Tipik': 'green',
            'La Trois': 'mediumorchid',
            'La premi√®re': 'blue',
            'Auvio': 'black',
            'vivacit√©': 'orange',
            'Musiq3': 'hotpink',
            'Auvio Kids': 'navy'
        };

        async function mettreAJourBulleDemandes() {
            const notif = document.getElementById("notif-count");
            if (!notif) {
                console.warn("√âl√©ment 'notif-count' non trouv√©. Assurez-vous qu'il est dans header.html.");
                return;
            }
            try {
                // Utilise le proxy pour obtenir les demandes IA
                const res = await fetch(`${PROXY_URL}?action=getDemandesIA`);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const responseData = await res.json();

                const demandes = responseData.data;

                const demandesNonTraitees = demandes.filter(d => !d.traite);

                notif.textContent = demandesNonTraitees.length;
                notif.style.display = demandesNonTraitees.length > 0 ? "inline-block" : "none";
            } catch (e) {
                console.error("Erreur lors de la r√©cup√©ration du compteur de demandes :", e);
                notif.style.display = "none";
            }
        }

        // Fonction pour remplir le select des outils
        function populateToolsSelect() {
            const outilsSelect = document.getElementById('outils');
            outilsSelect.innerHTML = ''; // Vide les options existantes
            allTools.forEach(tool => {
                const option = document.createElement('option');
                option.value = tool;
                option.textContent = tool;
                outilsSelect.appendChild(option);
            });
        }

        // Fonction pour cacher/afficher les champs Support/Chaine/Outils bas√©s sur le Besoin
        function toggleFieldsBasedOnBesoin() {
            const besoinSelect = document.getElementById('besoin');
            const typeContenuGroup = document.getElementById('typeContenu-group');
            const supportChaineGroup = document.getElementById('support-chaine-group');
            const outilsGroup = document.getElementById('outils-group');

            if (besoinSelect.value === 'formation') {
                typeContenuGroup.classList.add('hidden'); // Masquer le type de contenu si c'est une formation
                supportChaineGroup.classList.add('hidden');
                outilsGroup.classList.remove('hidden'); // Afficher les outils
                
                // Rendre les champs cach√©s non requis et les champs visibles requis
                document.getElementById('typeContenu').removeAttribute('required');
                document.getElementById('support').removeAttribute('required');
                document.getElementById('chaine').removeAttribute('required');
                document.getElementById('outils').setAttribute('required', 'true');
            } else {
                typeContenuGroup.classList.remove('hidden'); // Afficher le type de contenu si ce n'est pas une formation
                supportChaineGroup.classList.remove('hidden');
                outilsGroup.classList.add('hidden'); // Masquer les outils

                // Rendre les champs visibles requis et les champs cach√©s non requis
                document.getElementById('typeContenu').setAttribute('required', 'true');
                document.getElementById('support').setAttribute('required', 'true');
                document.getElementById('chaine').setAttribute('required', 'true');
                document.getElementById('outils').removeAttribute('required');
            }
        }

        async function afficherDemandes() {
            const recapList = document.getElementById("recapList");
            const filtreDemandeurSelect = document.getElementById("filtreDemandeur");
            const filtreBesoinSelect = document.getElementById("filtreBesoin");
            const filtreParChaineSelect = document.getElementById("filtreParChaine");
            // NOTE: Pour les outils, le filtrage serait plus complexe car c'est un champ multiple,
            // pour l'instant, on se concentre sur l'affichage et l'envoi.

            recapList.innerHTML = '<p class="loading-text">Chargement des demandes...</p>';

            let demandes = [];
            try {
                const res = await fetch(`${PROXY_URL}?action=getDemandesIA`);
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                const responseData = await res.json();

                if (responseData.success && Array.isArray(responseData.data)) {
                    demandes = responseData.data;
                } else {
                    console.warn("La r√©ponse de l'API n'est pas un tableau valide ou succ√®s: false. Affichage des demandes vide.");
                    demandes = [];
                }
            } catch (err) {
                console.error("Erreur lors de la r√©cup√©ration des demandes :", err);
                recapList.innerHTML = '<p style="color: red; text-align: center;">Erreur lors du chargement des demandes. V√©rifiez la console.</p>';
                showToast('Erreur lors du chargement des demandes.', 'error');
                return;
            }

            // Peupler le filtre "Demandeur" (c√¥t√© r√©cap)
            const demandeursUniquesRecap = [...new Set(allProfiles.map(p => p.name).filter(name => name && name.trim() !== ''))].sort((a, b) => a.localeCompare(b));
            filtreDemandeurSelect.innerHTML = '<option value="">Filtrer par demandeur</option>';
            demandeursUniquesRecap.forEach(nom => {
                const option = document.createElement('option');
                option.value = nom;
                option.textContent = nom;
                filtreDemandeurSelect.appendChild(option);
            });
            const currentFiltreDemandeur = filtreDemandeurSelect.dataset.currentValue || '';
            if (currentFiltreDemandeur) {
                filtreDemandeurSelect.value = currentFiltreDemandeur;
            }

            // Peupler le filtre par Besoin (nouveau)
            const besoinsDisponibles = ["production", "formation"].sort();
            filtreBesoinSelect.innerHTML = '<option value="">Filtrer par besoin</option>';
            besoinsDisponibles.forEach(besoin => {
                const option = document.createElement('option');
                option.value = besoin;
                option.textContent = besoin.charAt(0).toUpperCase() + besoin.slice(1);
                filtreBesoinSelect.appendChild(option);
            });
            const currentFiltreBesoin = filtreBesoinSelect.dataset.currentValue || '';
            if (currentFiltreBesoin) {
                filtreBesoinSelect.value = currentFiltreBesoin;
            }


            // Peupler le filtre par cha√Æne (liste compl√®te des options de cha√Æne)
            const chainesDisponibles = [
                "La Une", "Tipik", "La Trois", "La premi√®re", "Classic 21", "vivacit√©", "Musiq3", "Auvio", "Auvio Kids"
            ].sort();

            filtreParChaineSelect.innerHTML = '<option value="">Filtrer par cha√Æne</option>';
            chainesDisponibles.forEach(chaine => {
                const option = document.createElement('option');
                option.value = chaine;
                option.textContent = chaine;
                filtreParChaineSelect.appendChild(option);
            });
            const currentFiltreParChaine = filtreParChaineSelect.dataset.currentValue || '';
            if (currentFiltreParChaine) {
                filtreParChaineSelect.value = currentFiltreParChaine;
            }

            const selectedFiltreDemandeur = filtreDemandeurSelect.value;
            const selectedFiltreBesoin = filtreBesoinSelect.value;
            const selectedFiltreParChaine = filtreParChaineSelect.value;

            let demandesFiltrees = demandes;

            // Appliquer les filtres
            if (selectedFiltreDemandeur) {
                demandesFiltrees = demandesFiltrees.filter(d => d.nom === selectedFiltreDemandeur);
            }
            if (selectedFiltreBesoin) {
                demandesFiltrees = demandesFiltrees.filter(d => d.besoin === selectedFiltreBesoin);
            }
            if (selectedFiltreParChaine) {
                demandesFiltrees = demandesFiltrees.filter(d => d.chaine === selectedFiltreParChaine);
            }
            demandesFiltrees.sort((a, b) => new Date(b.date) - new Date(a.date));


            recapList.innerHTML = "";

            if (demandesFiltrees.length === 0) {
                recapList.innerHTML = '<p style="text-align: center; color: #777;">Aucune demande trouv√©e avec ces crit√®res.</p>';
                return;
            }

            demandesFiltrees.forEach(d => {
                const couleur = couleursParChaine[d.chaine] || "#0077b6";
                const div = document.createElement("div");
                div.className = "ticket";
                div.style.borderLeftColor = couleur;
                
                let typeOuBesoinDisplay = d.besoin === 'formation' ? 
                                          `<span style="font-size:1.1em; font-weight: bold;">${d.besoin.charAt(0).toUpperCase() + d.besoin.slice(1) || 'N/A'}</span>` : 
                                          `<span style="font-size:1.1em; font-weight: bold;">${d.typeContenu || 'N/A'}</span>`; // Afficher le type de contenu si production

                let detailsComplementaires = d.besoin === 'formation' ? 
                                            `<span style="color:${couleur}; font-weight: bold">Outils: ${Array.isArray(d.outils) ? d.outils.join(', ') : (d.outils || 'N/A')}</span>` : 
                                            `<span style="color:${couleur}; font-weight: bold">${d.chaine || 'N/A'}</span>`;


                div.innerHTML = `
                    <div style="display:flex; justify-content: space-between; align-items:center">
                        <span><strong>${d.nom || 'N/A'}</strong></span>
                        <div style="display:flex; align-items:center; gap:12px;">
                            ${typeOuBesoinDisplay}
                            <span>${d.duree || 'N/A'}</span>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
                        ${detailsComplementaires}
                        <small style="color:#666;">üìÖ ${d.date ? new Date(d.date).toLocaleDateString('fr-BE') : 'N/A'}</small>
                    </div>
                    <div style="display:flex; justify-content: space-between; align-items: center; margin-top: 6px;">
                        <div>${d.traite ? '<span style="color:green">‚úÖ Trait√©</span>' : '<span style="color:#999">‚è≥ En attente</span>'}</div>
                        <div>
                            ${d.traite ? '' : `<button title="Marquer comme trait√©" data-id="${d.id}" class="btn-traite" style="background:none; border:none; font-size:1.1em; cursor:pointer; padding:4px;">‚úîÔ∏è</button>`}
                            <button title="Supprimer" data-id="${d.id}" class="btn-supprimer" style="background:none; border:none; font-size:1.1em; cursor:pointer; padding:4px;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;

                div.querySelector(".btn-supprimer")?.addEventListener("click", async e => {
                    e.stopPropagation();
                    if (confirm("√ätes-vous s√ªr de vouloir supprimer cette demande ?")) {
                        await supprimerDemande(d.id);
                    }
                });

                div.querySelector(".btn-traite")?.addEventListener("click", async e => {
                    e.stopPropagation();
                    await marquerTraite(d.id);
                });

                div.addEventListener("click", () => {
                    const modal = document.getElementById("modal");
                    const modalBody = document.getElementById("modal-body");

                    const formattedDate = d.date ? new Date(d.date).toLocaleDateString('fr-BE', { year: 'numeric', month: 'long', day: 'numeric' }) : 'N/A';

                    // Adapter l'affichage de la modale en fonction du besoin
                    let modalBesoinInfo = `
                        <div class="modal-info-line"><strong>Besoin :</strong> <span>${d.besoin || 'N/A'}</span></div>
                    `;
                    if (d.besoin === 'formation') {
                        modalBesoinInfo += `
                            <div class="modal-info-line"><strong>Outils :</strong> <span>${Array.isArray(d.outils) ? d.outils.join(', ') : (d.outils || 'N/A')}</span></div>
                        `;
                    } else { // production ou autre
                        modalBesoinInfo += `
                            <div class="modal-info-line"><strong>Type de contenu :</strong> <span>${d.typeContenu || 'N/A'}</span></div>
                            <div class="modal-info-line"><strong>Support :</strong> <span>${d.support || 'N/A'}</span></div>
                            <div class="modal-info-line"><strong>Cha√Æne :</strong> <span>${d.chaine || 'N/A'}</span></div>
                        `;
                    }


                    modalBody.innerHTML = `
                        <div class="modal-info-line"><strong>Nom :</strong> <span>${d.nom || 'N/A'}</span></div>
                        <div class="modal-info-line"><strong>Email :</strong> <span>${d.email || 'N/A'}</span></div>
                        ${modalBesoinInfo}
                        <div class="modal-info-line"><strong>Dur√©e :</strong> <span>${d.duree || 'N/A'}</span></div>
                        <div class="modal-info-line"><strong>Date :</strong> <span>${formattedDate}</span></div>
                        <div class="modal-info-line description"><strong>Briefing :</strong> <span>${d.description || 'N/A'}</span></div>
                        `;
                    modal.style.display = "flex";
                });

                recapList.appendChild(div);
            });
        }

        // Fonction pour supprimer une demande via le proxy
        async function supprimerDemande(id) {
            try {
                const response = await fetch(PROXY_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        action: "deleteDemande", // Frontend envoie "deleteDemande"
                        id: id
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast(result.message || "Demande supprim√©e avec succ√®s !", 'success');
                    afficherDemandes();
                    mettreAJourBulleDemandes();
                } else {
                    console.error("√âchec de la suppression (r√©ponse backend) :", result.message);
                    showToast(`√âchec de la suppression : ${result.message || "Erreur inconnue."}`, 'error');
                }
            } catch(e) {
                console.error("Erreur lors de la suppression de la demande c√¥t√© client :", e);
                showToast("Erreur lors de la suppression. V√©rifiez la console pour plus de d√©tails.", 'error');
            }
        }

        // Fonction pour marquer une demande comme trait√©e via le proxy
        async function marquerTraite(id) {
            try {
                const response = await fetch(PROXY_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        action: "updateDemandeIA",
                        id: id,
                        traite: true
                    })
                });

                const updateResult = await response.json();
                if (updateResult.success) {
                    showToast(updateResult.message || "Demande marqu√©e comme trait√©e avec succ√®s !", 'success');
                    afficherDemandes();
                    mettreAJourBulleDemandes();
                } else {
                    console.error("Erreur lors de la mise √† jour du statut (r√©ponse backend) :", updateResult.message);
                    showToast(`√âchec de la mise √† jour : ${updateResult.message || "Erreur inconnue."}`, 'error');
                }
            } catch(e) {
                console.error("Erreur lors du marquage comme trait√© :", e);
                showToast("Erreur lors du marquage. Voir la console pour plus de d√©tails.", 'error');
            }
        }

        // √âv√©nements DOMContentLoaded
        document.addEventListener("DOMContentLoaded", () => {
            // Remplir le select des dur√©es
            const dureeSelect = document.getElementById("duree");
            for (let i = 0; i <= 60; i++) {
                const opt = document.createElement("option");
                opt.value = `${i} sec`;
                opt.textContent = `${i} sec`;
                dureeSelect.appendChild(opt);
            }
            const defaultOptDuree = document.createElement("option");
            defaultOptDuree.value = "";
            defaultOptDuree.textContent = "-- S√©lectionner --";
            dureeSelect.prepend(defaultOptDuree);
            dureeSelect.value = "";

            // Peupler le SELECT du champ "Nom" du formulaire principal
            const nomSelect = document.getElementById("nom");
            const tousLesNoms = [...new Set(allProfiles.map(p => p.name).filter(Boolean))].sort();
            tousLesNoms.forEach(nom => {
                const option = document.createElement('option');
                option.value = nom;
                option.textContent = nom;
                nomSelect.appendChild(option);
            });

            // Remplir le select des outils (initialisation)
            populateToolsSelect();


            // Gestion de la soumission du formulaire
            document.getElementById("demandeIA").addEventListener("submit", async e => {
                e.preventDefault();
                const data = new FormData(e.target);
                const besoin = data.get("besoin"); // R√©cup√©rer le besoin

                const demande = {
                    id: "_" + Math.random().toString(36).substr(2, 9),
                    nom: data.get("nom"),
                    email: `${data.get("emailPrefix")}@rtbf.be`,
                    besoin: besoin, // Inclure le besoin
                    duree: data.get("duree"),
                    date: data.get("date"),
                    description: data.get("description"),
                    traite: false
                };

                // Ajouter conditionnellement les champs bas√©s sur le besoin
                if (besoin === 'formation') {
                    // Pour les outils, r√©cup√©rer toutes les options s√©lectionn√©es
                    const outilsSelect = document.getElementById('outils');
                    const selectedTools = Array.from(outilsSelect.selectedOptions).map(option => option.value);
                    demande.outils = selectedTools.join(','); // Stocker comme une cha√Æne s√©par√©e par des virgules
                } else { // Production (ou autre type de contenu)
                    demande.typeContenu = data.get("typeContenu");
                    demande.support = data.get("support");
                    demande.chaine = data.get("chaine");
                }


                const submitBtn = document.getElementById("submitBtn");
                const originalBtnText = submitBtn.textContent;
                submitBtn.textContent = "Envoi en cours...";
                submitBtn.disabled = true;

                try {
                    // Appel direct √† sendrequest.js pour l'envoi du formulaire et de l'e-mail
                    const response = await fetch(SEND_REQUEST_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(demande)
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`Erreur HTTP: ${response.status} ${response.statusText}`, errorText);
                        showToast(`Erreur lors de l'envoi de la demande: ${response.status} ${response.statusText}`, 'error');
                        return;
                    }

                    const result = await response.json();

                    if (result.success) {
                        showToast(result.message || "Demande envoy√©e avec succ√®s !", 'success');
                        e.target.reset(); // R√©initialise le formulaire
                        // R√©initialise les s√©lecteurs dynamiques apr√®s reset du formulaire
                        document.getElementById('besoin').value = ''; 
                        document.getElementById('typeContenu').value = '';
                        document.getElementById('support').value = '';
                        document.getElementById('chaine').value = '';
                        document.getElementById('outils').value = ''; // R√©initialise le multi-select
                        toggleFieldsBasedOnBesoin(); // R√©applique la logique de visibilit√©
                        afficherDemandes(); // Met √† jour la liste des demandes
                        mettreAJourBulleDemandes(); // Met √† jour le compteur
                    } else {
                        console.error("√âchec de l'envoi (r√©ponse backend) :", result.message);
                        showToast(`√âchec de l'envoi : ${result.message || "Erreur inconnue."}`, 'error');
                    }
                } catch (e) {
                    console.error("Erreur lors de l'envoi de la demande c√¥t√© client :", e);
                    showToast("Erreur lors de l'envoi. V√©rifiez la console pour plus de d√©tails.", 'error');
                } finally {
                    submitBtn.textContent = originalBtnText;
                    submitBtn.disabled = false;
                }
            });

            // Initialisation de l'affichage des demandes et des filtres
            afficherDemandes();

            // Gestion des changements de filtre (pour le r√©capitulatif de droite)
            document.getElementById("filtreDemandeur").addEventListener("change", afficherDemandes);
            document.getElementById("filtreBesoin").addEventListener("change", afficherDemandes); // Nouveau gestionnaire de filtre pour besoin
            document.getElementById("filtreParChaine").addEventListener("change", afficherDemandes);

            // Gestion de la modale d'information
            const infoModal = document.getElementById("infoModal");
            const comprenezBtn = document.getElementById("comprendaBtn");

            // Afficher la modale uniquement si elle n'a pas √©t√© vue (via localStorage)
            if (!localStorage.getItem('infoModalViewed')) {
                infoModal.classList.remove('hidden');
                infoModal.style.display = "flex";
            } else {
                infoModal.style.display = "none";
                infoModal.classList.add('hidden');
            }

            // Fermer la modale et enregistrer le fait qu'elle a √©t√© vue
            comprenezBtn.addEventListener("click", () => {
                infoModal.classList.add('hidden');
                infoModal.style.display = "none";
                localStorage.setItem('infoModalViewed', 'true');
            });

            // Fermer la modale des d√©tails de la demande
            document.querySelector("#modal .close-modal").addEventListener("click", () => {
                document.getElementById("modal").style.display = "none";
            });

            // Fermer la modale si on clique en dehors du contenu
            document.getElementById("modal").addEventListener("click", (e) => {
                if (e.target.id === "modal") {
                    document.getElementById("modal").style.display = "none";
                }
            });

            // Appeler la fonction de bascule au chargement initial et lors du changement du champ "Besoin"
            toggleFieldsBasedOnBesoin(); // Pour d√©finir l'√©tat initial
            document.getElementById('besoin').addEventListener('change', toggleFieldsBasedOnBesoin);
        });
    </script>
</body>
</html>
