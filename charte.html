<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Droit à l'image et Intelligence Artificielle</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      opacity: 0;
      transition: opacity 0.3s ease-in;
      margin: 0;
      font-family: sans-serif;
      background: #f0f4f8;
    }
    main {
      display: none;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }
    .tabs {
      display: flex;
      margin-bottom: 20px;
      cursor: pointer;
      border-bottom: 1px solid #ccc;
    }
    .tab {
      flex: 1;
      padding: 15px;
      background: #e0e0e0;
      text-align: center;
      border: 1px solid #ccc;
      border-bottom: none;
      font-weight: bold;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    .tab.active {
      background: white;
      border-bottom: 1px solid white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .vignette {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 5px solid #0077b6;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .vignette h2 {
      color: #0077b6;
      margin-top: 0;
    }
    .vignette p, .vignette ul {
      margin: 10px 0;
    }
    .vignette ul li {
      margin-bottom: 6px;
    }
    .meta {
      font-size: 0.9em;
      color: #555;
      margin-bottom: 20px;
    }

    /* Style pour le carré rosé */
    .notif-carré {
      position: absolute;
      top: -10px;
      right: -10px;
      width: 24px;
      height: 24px;
      background-color: #ff66b2;
      color: white;
      font-size: 0.75rem;
      border-radius: 50%;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="header-placeholder" style="position: relative;"></div>

  <main>
    <div class="container">
      <div class="tabs">
        <div class="tab active" onclick="switchTab('rtbf')">RTBF</div>
        <div class="tab" onclick="switchTab('europe')">EUROPE</div>
      </div>

      <div id="rtbf" class="tab-content active">
        <div class="vignette">
          <h2>Contexte</h2>
          <p class="meta">Publié le 23 février 2024</p>
          <p>Les IA génératives comme ChatGPT, DALL·E ou Midjourney permettent de créer des textes, images ou sons très réalistes. Leur utilisation devient courante, y compris à la RTBF.</p>
          <p>Nous devons respecter trois principes fondamentaux : <strong>transparence</strong>, <strong>responsabilité</strong> et <strong>valeurs de service public</strong>.</p>
        </div>
        <!-- autres blocs RTBF... -->
      </div>

      <div id="europe" class="tab-content">
        <div class="vignette">
          <h2>Le Règlement sur l'IA (AI Act)</h2>
          <p class="meta">Entrée en vigueur : 1er août 2024</p>
          <p>L'Union européenne a récemment adopté le <strong>Règlement sur l'intelligence artificielle (AI Act)</strong>. Il établit un cadre juridique pour le développement et l'utilisation de l'IA dans l'UE, en garantissant le respect des droits fondamentaux, y compris le droit à l'image.</p>
        </div>
        <!-- autres blocs EUROPE... -->
      </div>
    </div>
  </main>

  <script>
    const PROXY_URL = "/.netlify/functions/proxy";

    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.querySelector('.tab[onclick*="' + tabId + '"]').classList.add('active');
      document.getElementById(tabId).classList.add('active');
    }

    async function mettreAJourBulleDemandes() {
      const notif = document.getElementById("notif-count");
      if (!notif) return;
      try {
        const res = await fetch(`${PROXY_URL}?action=getDemandesIA`);
        const demandes = await res.json();
        notif.textContent = demandes.length;
        notif.style.display = demandes.length > 0 ? "inline-flex" : "none";
      } catch (e) {
        console.error("Erreur notification :", e);
      }
    }

    fetch("header.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("header-placeholder").innerHTML = data;

        const lienDemande = document.querySelector("a.demandes");
        if (lienDemande) {
          lienDemande.style.position = "relative";
          const notif = document.createElement("div");
          notif.id = "notif-count";
          notif.className = "notif-carré";
          notif.textContent = "0";
          lienDemande.appendChild(notif);
        }
      })
      .catch(() => {
        document.getElementById("header-placeholder").innerHTML =
          "<p style='color:red;text-align:center'>Erreur de chargement du menu</p>";
      })
      .finally(() => {
        document.body.style.opacity = "1";
        document.querySelector("main").style.display = "block";
        mettreAJourBulleDemandes();
      });
  </script>
</body>
</html>
